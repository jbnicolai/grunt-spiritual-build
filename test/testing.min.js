!function(i){"use strict";gui=gui.Object.extend(gui,{MODE_ROBOT:"robot",MODE_HUMAN:"human",MODE_FUNNY:"funny",BROADCAST_KICKSTART:"gui-broadcast-kickstart",BROADCAST_WILL_SPIRITUALIZE:"gui-broadcast-will-spiritualize",BROADCAST_DID_SPIRITUALIZE:"gui-broadcast-did-spiritualize",ACTION_DOC_ONSPIRITUALIZED:"gui-action-document-spiritualized",$ACTION_XFRAME_VISIBILITY:"gui-action-xframe-visibility",LIFE_CONSTRUCT:"gui-life-construct",LIFE_CONFIGURE:"gui-life-configure",LIFE_ENTER:"gui-life-enter",LIFE_ATTACH:"gui-life-attach",LIFE_READY:"gui-life-ready",LIFE_DETACH:"gui-life-detach",LIFE_EXIT:"gui-life-exit",LIFE_ASYNC:"gui-life-async",LIFE_DESTRUCT:"gui-life-destruct",LIFE_VISIBLE:"gui-life-visible",LIFE_INVISIBLE:"gui-life-invisible",LIFE_RENDER:"gui-life-render",LIFE_IFRAME_CONSTRUCT:"gui-life-iframe-construct",LIFE_IFRAME_DOMCONTENT:"gui-life-iframe-domcontent",LIFE_IFRAME_SPIRITUALIZED:"gui-life-iframe-spiritualized",LIFE_IFRAME_ONLOAD:"gui-life-iframe-onload",LIFE_IFRAME_ONHASH:"gui-life-iframe-onhash",LIFE_IFRAME_UNLOAD:"gui-life-iframe-unload",$TICK_INSIDE:"gui-tick-spirits-inside",$TICK_OUTSIDE:"gui-tick-spirits-outside",CRAWLER_SPIRITUALIZE:"gui-crawler-spiritualize",CRAWLER_MATERIALIZE:"gui-crawler-materialize",CRAWLER_DETACH:"gui-crawler-detach",CRAWLER_DISPOSE:"gui-crawler-dispose",CRAWLER_ACTION:"gui-crawler-action",CRAWLER_VISIBLE:"gui-crawler-visible",CRAWLER_INVISIBLE:"gui-crawler-invisible",CLASS_NOSPIRITS:"gui-nospirits",CLASS_INVISIBLE:"_gui-invisible",CLASS_HIDDEN:"_gui-hidden",spiritualized:!1,attributes:["gui"],spiritualize:function(i){gui.Guide.$spiritualize(i||document)},spiritualizeSub:function(i){gui.Guide.$spiritualizeSub(i||document)},spiritualizeOne:function(i){gui.Guide.$spiritualizeOne(i||document)},materialize:function(i){gui.Guide.$materialize(i||document)},materializeSub:function(i){gui.Guide.$materializeSub(i||document)},materializeOne:function(i){gui.Guide.$materializeOne(i||document)},suspend:function(i){return gui.DOMObserver.suspend(function(){return gui.Guide.suspend(i)})},start:function(){return this._oninit(),this._gone=!0,this._then=new gui.Then,this._todochannels&&(this._channelAll(this._todochannels),this._todochannels=null),this._pingpong||(gui.Tick.add([gui.$TICK_INSIDE,gui.$TICK_OUTSIDE],this,this.$contextid),this._then.now()),this._then},kickstart:function(){switch(document.readyState){case"interactive":case"complete":gui.Broadcast.dispatchGlobal(gui.BROADCAST_KICKSTART)}},get:function(i){var t,e,n=document;switch(gui.Type.of(i)){case"string":if(gui.KeyMaster.isKey(i)&&(t=this._spirits.inside[i]),!t)try{e=n.querySelector(i)||n.querySelector("#"+i)}catch(r){}finally{t=e?e.spirit:null}break;case"function":var u,s=this._spirits.inside;gui.Type.isSpiritConstructor(i)&&Object.keys(this._spirits.inside).some(function(e){return(u=s[e]).constructor===i?(t=u,!0):void 0});break;default:if(!gui.Type.isElement(i))throw new TypeError("gui.get("+i+")");t=i.spirit||null}return t||null},getAll:function(){console.error("TODO: gui.getAll")},channel:function(){switch(gui.Type.of(arguments[0])){case"string":this._channelOne.apply(this,arguments);break;case"array":this._channelAll.apply(this,arguments)}},channels:function(){console.error("Deprecated API is deprecated: gui.channels()")},hasChannels:function(){return this._channels&&gui._channels.length},evaluate:function(i){var t=null;if(i.nodeType===Node.ELEMENT_NODE){var e=i.ownerDocument,n=e.defaultView;n.gui&&n.gui.attributes.every(function(e){return t=this._evaluateinline(i,n,e),null===t},this)&&gui.hasChannels()&&n.gui._channels.every(function(e){var n=e[0],r=e[1];return gui.CSSPlugin.matches(i,n)&&(t=r),null===t},this)}return t},debugchannels:function(){var i=location.toString();this._channels.forEach(function(t){i+="\n"+t[0]+" : "+t[1]}),console.log(i+"\n\n")},destruct:function(i){var t=this._spirits,e=i.$instanceid;delete t.inside[e],delete t.outside[e],this._jensen(i)},inside:function(i){var t=this._spirits,e=i.$instanceid;t.inside[e]||(t.outside[e]&&delete t.outside[e],t.inside[e]=i,t.incoming.push(i),gui.Tick.dispatch(gui.$TICK_INSIDE,4,this.$contextid))},outside:function(i){var t=this._spirits,e=i.$instanceid;t.outside[e]||(t.inside[e]&&(delete t.inside[e],this._jensen(i)),t.outside[e]=i,gui.Tick.dispatch(gui.$TICK_OUTSIDE,0,this.$contextid))},_jensen:function(i){var t=this._spirits.incoming;if(t.length){var e=t.indexOf(i);e>-1&&gui.Array.remove(t,e)}},ontick:function(i){var t;switch(i.type){case gui.$TICK_INSIDE:gui.Guide.$goasync(this._spirits.incoming),this._spirits.incoming=[];break;case gui.$TICK_OUTSIDE:t=gui.Object.each(this._spirits.outside,function(i,t){return t}),t.forEach(function(i){gui.Spirit.$destruct(i)}),t.forEach(function(i){gui.Spirit.$dispose(i)}),this._spirits.outside=Object.create(null)}},_spirits:null,_channels:null,_todochannels:null,_initspirits:function(){return this._arrivals=Object.create(null),this._channels=[],this._spaces=["gui"],this._spirits={incoming:[],inside:Object.create(null),outside:Object.create(null)},this},_channelOne:function(i,t){var e;this._gone?(e="string"==typeof t?gui.Object.lookup(t):t,!gui.debug||gui.Type.isSpiritConstructor(e)?this._channels.unshift([i,e]):console.error('Bad spirit for selector "'+i+'": '+e)):(this._todochannels=this._todochannels||[],this._todochannels.push([i,t]))},_channelAll:function(i){this._gone?i.forEach(function(i){this._channelOne(i[0],i[1])},this):(this._todochannels=this._todochannels||[],this._todochannels=this._todochannels.concat(i.reverse()))},_evaluateinline:function(i,t,e){var n=null,r=i.getAttribute(e);return gui.Type.isString(r)&&!r.startsWith("[")&&(""!==r?(n=gui.Object.lookup(r,t),n||console.error(r+" is not defined.")):n=!1),n}}._initspirits()),gui.Module.mixin({plugin:null,mixin:null,channel:null,onbeforespiritualize:function(){},onafterspiritualize:function(){},$onconstruct:function(){["channels","mixins","plugins"].forEach(function(i){this[i]&&console.error("Deprecated API is deprecated: "+i)},this),gui.Type.isObject(this.mixin)&&gui.Spirit.mixin(this.mixin),gui.Type.isObject(this.plugin)&&gui.Object.each(this.plugin,function(i,t){gui.Type.isDefined(t)?gui.Spirit.plugin(i,t):console.error("Undefined plugin for prefix: "+i)}),gui.Type.isArray(this.channel)&&gui.channel(this.channel),gui.Type.isFunction(this.oncontextinitialize)&&this.oncontextinitialize(i),this._monitorspirits()},_monitorspirits:function(){var t=this,e=gui.BROADCAST_WILL_SPIRITUALIZE,n=gui.BROADCAST_DID_SPIRITUALIZE;gui.Broadcast.addGlobal([e,n],{onbroadcast:function(r){if(r.data===gui.$contextid)switch(gui.Broadcast.removeGlobal(r.type,this),r.type){case e:gui.Type.isFunction(t.onbeforespiritualize)&&t.onbeforespiritualize(i);break;case n:gui.Type.isFunction(t.onafterspiritualize)&&t.onafterspiritualize(i)}}})}}),gui.ActionPlugin=function(i,t){return gui.Tracker.extend({type:null,data:null,add:i("array|string","(object|function)")(t(function(i,t){t=t?t:this.spirit,gui.Interface.validate(gui.Action.IActionHandler,t)&&gui.Array.make(i).forEach(function(i){this._addchecks(i,[t,this._global])},this)})),remove:i("array|string","(object|function)")(t(function(i,t){t=t?t:this.spirit,gui.Interface.validate(gui.Action.IActionHandler,t)&&gui.Array.make(i).forEach(function(i){this._removechecks(i,[t,this._global])},this)})),addGlobal:function(i,t){return this._globalize(function(){return this.add(i,t)})},removeGlobal:function(i,t){return this._globalize(function(){return this.remove(i,t)})},dispatch:i("string","(*)")(function(i,t){return gui.Action.dispatch(this.spirit,i,t)}),ascend:i("string","(*)")(function(i,t){return gui.Action.ascend(this.spirit,i,t)}),descend:i("string","(*)")(function(i,t){return gui.Action.descend(this.spirit,i,t)}),dispatchGlobal:i("string","(*)")(function(i,t){return gui.Action.dispatchGlobal(this.spirit,i,t)}),ascendGlobal:i("string","(*)")(function(i,t){return gui.Action.ascendGlobal(this.spirit,i,t)}),descendGlobal:i("string","(*)")(function(i,t){return gui.Action.descendGlobal(this.spirit,i,t)}),_cleanup:function(i,t){var e=t[0],n=t[1];n?this.removeGlobal(i,e):this.remove(i,e)},$handleownaction:!1,$onaction:function(i){var t=this._trackedtypes[i.type];t&&t.forEach(function(t){var e=t[0],n=t[1]===i.global,r=e===this.spirit&&this.$handleownaction;n&&(e!==i.target||r)&&e.onaction(i)},this)}})}(gui.Arguments.confirmed,gui.Combo.chained),gui.BroadcastPlugin=function(i,t){return gui.Tracker.extend({add:t("string|array")(i(function(i,t){t=t?t:this.spirit;var e=this._global?null:this._sig;gui.Array.make(i).forEach(function(i){this._addchecks(i,[t,this._global])&&(this._global?gui.Broadcast.addGlobal(i,t):gui.Broadcast.add(i,t,e))},this)})),remove:t("string|array")(i(function(i,t){t=t?t:this.spirit;var e=this._global?null:this._sig;gui.Array.make(i).forEach(function(i){this._removechecks(i,[t,this._global])&&(this._global?gui.Broadcast.removeGlobal(i,t):gui.Broadcast.remove(i,t,e))},this)})),dispatch:t("string|array")(function(i,t){var e=null,n=this._global,r=n?null:this._sig;return this._global=!1,gui.Array.make(i).forEach(function(i){gui.Broadcast.$target=this.spirit,e=n?gui.Broadcast.dispatchGlobal(i,t):gui.Broadcast.dispatch(i,t,r)},this),e}),addGlobal:function(i,t){return this._globalize(function(){return this.add(i,t)})},removeGlobal:function(i,t){return this._globalize(function(){return this.remove(i,t)})},shiftGlobal:function(i,t,e){return this._globalize(function(){return this.shift(i,t,e)})},dispatchGlobal:function(i,t){return this._globalize(function(){return this.dispatch(i,t)})},_cleanup:function(i,t){var e=t[0],n=t[1];n?gui.Broadcast.removeGlobal(i,e):gui.Broadcast.remove(i,e,this._sig)}})}(gui.Combo.chained,gui.Arguments.confirmed),gui.TickPlugin=function(i){return gui.Tracker.extend({add:i(function(i,t){t=t?t:this.spirit,gui.Interface.validate(gui.ITickHandler,t)&&gui.Array.make(i).forEach(function(i){this._addchecks(i,[t,this._global])&&this._add(i,t,!1)},this)}),remove:i(function(i,t){t=t?t:this.spirit,gui.Interface.validate(gui.ITickHandler,t)&&gui.Array.make(i).forEach(function(i){this._removechecks(i,[t,this._global])&&this._remove(i,t)},this)}),one:i(function(i,t){this.add(i,t,!0)}),next:i(function(i,t){gui.Tick.next(i,t||this.spirit)}),nextFrame:function(i,t){return gui.Tick.nextFrame(i,t||this.spirit)},cancelFrame:i(function(i){gui.Tick.cancelFrame(i)}),time:function(i,t,e){return gui.Tick.time(i,t,e||this.spirit)},cancelTime:i(function(i){gui.Tick.cancelTime(i)}),start:i(function(i){gui.Tick.start(i)}),stop:i(function(i){gui.Tick.stop(i)}),dispatch:function(i,t){return this._dispatch(i,t||0)},_global:!1,_add:function(i,t,e){var n=this.spirit.$contextid;e?this._global?gui.Tick.oneGlobal(i,t):gui.Tick.one(i,t,n):this._global?gui.Tick.addGlobal(i,t):gui.Tick.add(i,t,n)},_remove:function(i,t){var e=this.spirit.$contextid;this._global?gui.Tick.removeGlobal(i,t):gui.Tick.remove(i,t,e)},_dispatch:function(i,t){var e,n=this.spirit.$contextid;return e=this._global?gui.Tick.dispatchGlobal(i,t):gui.Tick.dispatch(i,t,n)},_cleanup:function(i,t){var e=t[0],n=t[1];this._remove(i,[e])&&(n?gui.Tick.removeGlobal(i,e):gui.Tick.remove(i,e,this.$contextid))}})}(gui.Combo.chained),gui.ITickHandler={toString:function(){return"[object ITickHandler]"},ontick:function(){}},gui.Life=function(i,t){this.target=i,this.type=t},gui.Life.prototype={target:null,type:null,toString:function(){return"[object gui.Life]"}},gui.LifePlugin=gui.Tracker.extend({constructed:!1,configured:!1,entered:!1,attached:!1,detached:!0,ready:!1,async:!1,exited:!1,destructed:!1,visible:void 0,rendered:!1,plugins:null,onconstruct:function(){gui.Tracker.prototype.onconstruct.call(this),this._handlers=Object.create(null),this.plugins=Object.create(null)},add:function(i,t){return t=t?t:this.spirit,gui.Array.make(i).forEach(function(i){this._addchecks(i,[t])&&(this._handlers[i]||(this._handlers[i]=[]),this._handlers[i].push(t))},this),this.spirit},remove:function(i,t){return t=t?t:this.spirit,gui.Array.make(i).forEach(function(i){if(this._removechecks(i,[t])&&this._handlers[i]){var e=this._handlers[i].indexOf(i);gui.Array.remove(this._handlers[i],e),0===this._handlers[i].length&&delete this._handlers[i]}},this),this.spirit},dispatch:function(i){var t=this._handlers[i];if(t){var e=new gui.Life(this.spirit,i);switch(t.forEach(function(i){i.onlife(e)}),i){case gui.LIFE_CONSTRUCT:case gui.LIFE_CONFIGURE:case gui.LIFE_ENTER:case gui.LIFE_READY:case gui.LIFE_DETACH:case gui.LIFE_EXIT:case gui.LIFE_DESTRUCT:delete this._handlers[i]}}},_handlers:null,_cleanup:function(i,t){var e=t[0];this.remove(i,e)}}),gui.ConfigPlugin=gui.Plugin.extend({configureall:function(){var i=this.spirit.element.attributes;Array.forEach(i,function(i){this.configureone(i.name,i.value)},this)},onlife:function(){for(var i;i=this._onready.shift();)i()},configureone:function(i,t){var e,n=this.spirit.window.gui;n.attributes.every(function(n){return(e=i.startsWith(n+"."))&&this._evaluate(i,t,n),!e},this)},_onready:null,_evaluate:function(i,t,e){var n=this.spirit,r=!0,u=null,s=null;i=u=i.split(e+".")[1],i.indexOf(".")>-1&&(s=i.split("."),s.forEach(function(i,t){gui.Type.isDefined(n)?t<s.length-1?n=n[i]:u=i:r=!1})),r&&gui.Type.isDefined(n[u])?this._schedule(n,u,this._revaluate(t)):console.error('No definition for "'+i+'" in '+this.spirit.toString())},_schedule:function(i,t,e){gui.Type.isFunction(i[t])?this.spirit.life.ready?i[t](e):(this.spirit.life.add(gui.LIFE_READY,this),this._onready=this._onready||[],this._onready.push(function(){i[t](e)})):i[t]=e},_revaluate:function(t){return gui.Type.isString(t)&&(gui.hasModule("edb@wunderbyte.com")&&t.startsWith("edb.$get")?t=i.edb.$get(gui.KeyMaster.extractKey(t)[0]):(t=gui.Type.cast(t),gui.Type.isString(t)&&(t=this._jsonvaluate(t)))),t},_jsonvaluate:function(i){if([["%5B","%5D"],["%7B","%7D"]].some(function(t){return i.startsWith(t[0])&&i.endsWith(t[1])}))try{i=JSON.parse(decodeURIComponent(i))}catch(t){i=null,console.error(this+": Bad JSON: "+t.message)}return i}},{lazy:!1}),gui.Att=function(i,t){this.value=gui.Type.cast(t),this.name=this.type=i},gui.Att.prototype={name:null,type:null,value:null},gui.AttPlugin=function(i,t){return gui.Tracker.extend({get:function(i){return gui.AttPlugin.get(this.spirit.element,i)},set:t(function(i,t){this.$suspended||gui.AttPlugin.set(this.spirit.element,i,t)}),has:function(i){return gui.AttPlugin.has(this.spirit.element,i)},del:t(function(i){this.$suspended||gui.AttPlugin.del(this.spirit.element,i)}),all:function(){return gui.AttPlugin.all(this.spirit.element)},shift:i("boolean","string")(t(function(i,t,e){if(i){if(void 0===e)throw new TypeError('Missing value for "'+t+'"');this.set(t,e)}else this.del(t)})),getmap:function(){return gui.AttPlugin.getmap(this.spirit.element)},setmap:function(i){gui.AttPlugin.setmap(this.spirit.element,i)},add:i("array|string","(object|function)")(t(function(i,t){t=t?t:this.spirit,gui.Interface.validate(gui.IAttHandler,t)&&gui.Array.make(i).forEach(function(i){this._addchecks(i,[t]),this._onadd(i)},this)})),remove:i("array|string","(object|function)")(t(function(i,t){t=t?t:this.spirit,gui.Interface.validate(gui.IAttHandler,t)&&gui.Array.make(i).forEach(function(i){this._removechecks(i,[t])},this)})),$suspended:!1,$suspend:function(i){this.$suspended=!0;var t=i();return this.$suspended=!1,t},$onatt:function(i,t){var e,n,r,u,s=!gui.attributes.every(function(e){return(u=i.startsWith(e))&&this.spirit.config.configureone(i,t),!u},this);!s&&(e=this._trackedtypes[i])&&(n=new gui.Att(i,t),e.forEach(function(i){r=i[0],r.onatt(n)},this))},_onadd:function(i){if(this.has(i)){var t=this.get(i);i.startsWith(gui.ConfigPlugin.PREFIX)?this.spirit.config.configureone(i,t):this.$onatt(i,t)}}},{},{get:function(i,t){return gui.Type.cast(i.getAttribute(t))},set:t(function(i,t,e){var n=i.spirit,r=!1;this._ischecked(i,t)?(r=i.checked!==e,i.checked="false"===String(e)?!1:null!==e,r&&n.att.$onatt(t,e)):this._isvalue(i,t)?(r=i.value!==String(e),r&&(i.value=String(e),n.att.$onatt(t,e))):null===e?this.del(i,t):(e=String(e),i.getAttribute(t)!==e&&(n?(n.att.$suspend(function(){i.setAttribute(t,e)}),n.att.$onatt(t,e)):i.setAttribute(t,e)))}),_ischecked:function(i,t){return i.type&&void 0!==i.checked&&"checked"===t},_isvalue:function(i,t){return void 0!==i.value&&"value"===t},has:function(i,t){return i.hasAttribute(t)},del:t(function(i,t){var e=i.spirit;this._ischecked(i,t)?i.checked=!1:this._isvalue(i,t)?i.value="":e?(e.att.$suspend(function(){i.removeAttribute(t)}),e.config.configureone(t,null)||e.att.$onatt(t,null)):i.removeAttribute(t)}),all:function(i){return gui.Array.from(i.attributes)},getmap:function(i){var t=Object.create(null);return this.all(i).forEach(function(i){t[i.name]=gui.Type.cast(i.value)}),t},setmap:t(function(i,t){gui.Object.each(t,function(t,e){this.set(i,t,e)},this)})})}(gui.Arguments.confirmed,gui.Combo.chained),gui.IAttHandler={toString:function(){return"[object IAttHandler]"},onatt:function(){}},gui.BoxPlugin=gui.Plugin.extend({width:0,height:0,localX:0,localY:0,pageX:0,pageY:0,clientX:0,clientY:0,_scrollroot:function(){return function(i){return"html"===gui.Client.scrollRoot.localName?i.documentElement:i.body}(this.spirit.document)}}),Object.defineProperties(gui.BoxPlugin.prototype,{width:{get:function(){return this.spirit.element.offsetWidth}},height:{get:function(){return this.spirit.element.offsetHeight}},localX:{get:function(){return this.spirit.element.offsetLeft}},localY:{get:function(){return this.spirit.element.offsetTop}},pageX:{get:function(){return this.clientX+this._scrollroot().scrollLeft}},pageY:{get:function(){return this.clientY+this._scrollroot().scrollTop}},clientX:{get:function(){return this.spirit.element.getBoundingClientRect().left}},clientY:{get:function(){return this.spirit.element.getBoundingClientRect().top}}}),gui.CSSPlugin=function(i,t){return gui.Plugin.extend({add:t("string|array")(i(function(i){var t=this.spirit.element;gui.Array.make(i).forEach(function(i){gui.CSSPlugin.add(t,i)})})),remove:t("string|array")(i(function(i){var t=this.spirit.element;gui.Array.make(i).forEach(function(i){gui.CSSPlugin.remove(t,i)})})),toggle:t("string|array")(i(function(i){var t=this.spirit.element;gui.Array.make(i).forEach(function(i){gui.CSSPlugin.toggle(t,i)})})),shift:t("boolean","string|array")(i(function(i,t){var e=this.spirit.element;gui.Array.make(t).forEach(function(t){gui.CSSPlugin.shift(e,i,t)})})),contains:t("string")(function(i){return gui.CSSPlugin.contains(this.spirit.element,i)}),set:i(function(i,t){gui.CSSPlugin.set(this.spirit.element,i,t)}),style:i(function(i){gui.CSSPlugin.style(this.spirit.element,i)}),get:function(i){return gui.CSSPlugin.get(this.spirit.element,i)},compute:function(i){return gui.CSSPlugin.compute(this.spirit.element,i)},name:i(function(i){var t=this.spirit.element.className;return void 0!==i&&(this.spirit.element.className=i,t=this.spirit),t}),matches:function(i){return gui.CSSPlugin.matches(this.spirit.element,i)}},{},{add:i(function(i,t){if(gui.Type.isString(t))if(t.indexOf(" ")>-1&&(t=t.split(" ")),gui.Type.isArray(t))t.forEach(function(t){this.add(i,t)},this);else if(this._supports)i.classList.add(t);else{var e=i.className.split(" ");-1===e.indexOf(t)&&(e.push(t),i.className=e.join(" "))}}),remove:i(function(i,t){if(gui.Type.isString(t))if(t=t||"",t.indexOf(" ")>-1&&(t=t.split(" ")),gui.Type.isArray(t))t.forEach(function(t){this.remove(i,t)},this);else if(this._supports)i.classList.remove(t);else{var e=i.className.split(" "),n=e.indexOf(t);n>-1&&gui.Array.remove(e,n),i.className=e.join(" ")}}),toggle:i(function(i,t){gui.Type.isString(t)&&(this._supports?i.classList.toggle(t):this.contains(i,t)?this.remove(i,t):this.add(i,t))}),shift:i(function(i,t,e){gui.Type.isBoolean(t)?t?this.add(i,e):this.remove(i,e):console.error("Deprecated API is deprecated")}),contains:function(i,t){if(this._supports)return i.classList.contains(t);var e=i.className.split(" ");return e.indexOf(t)>-1},set:i(function(i,t,e){gui.Type.isNumber(e)&&(e=(this._shorthands[t]||"@").replace("@",e)),e=String(e),"float"===t?t="cssFloat":(e=this.jsvalue(e),t=this.jsproperty(t)),i.style[t]=e}),get:function(i,t){return t=this.jsproperty(t),this.jsvalue(i.style[t])},style:function(i,t){var e=i instanceof gui.Spirit?i.element:i;return gui.Object.each(t,function(i,t){this.set(e,i,t)},this),i},compute:function(i,t){var e=i instanceof gui.Spirit?i.element:i,n=e.ownerDocument,r=n.defaultView;return t=this._standardcase(this.jsproperty(t)),r.getComputedStyle(e,null).getPropertyValue(t)},matches:function(i,t){return i[this._matchmethod](t)},jsproperty:function(i){var t=this._vendors,e=i,n=document.documentElement;return i=String(i),i.startsWith("-beta-")?t.every(function(t){var r=this._camelcase(i.replace("-beta-",t));return void 0!==n.style[r]?(e=r,!1):!0},this):e=this._camelcase(e),e},jsvalue:function(i){var t=this._vendors,e=document.documentElement;if(i=String(i),i&&i.contains("-beta-")){var n=[];i.split(", ").forEach(function(i){(i=i.trim()).startsWith("-beta-")?t.every(function(t){var r=this._camelcase(i.replace("-beta-",t));return void 0!==e.style[r]?(n.push(i.replace("-beta-",t)),!1):!0},this):n.push(i)},this),i=n.join(",")}return i},cssproperty:function(i){return this._standardcase(this.jsproperty(i))},cssvalue:function(i){return this._standardcase(this.jsvalue(i))},_vendors:["","-webkit-","-moz-","-ms-","-o-"],_supports:void 0!==document.documentElement.classList,_camelcase:function(i){return i.replace(/-([a-z])/gi,function(i,t){return t.toUpperCase()})},_standardcase:function(i){return i.replace(/[A-Z]/g,function(t,e){return"-"+i.charAt(e).toLowerCase()})},_shorthands:{top:"@px",right:"@px",bottom:"@px",left:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",textIndent:"@px",margin:"@px",marginTop:"@px",marginRight:"@px",marginBottom:"@px",marginLeft:"@px",padding:"@px",paddingTop:"@px",paddingRight:"@px",paddingBottom:"@px",paddingLeft:"@px",fontWeight:"@",opacity:"@",zIndex:"@",position:"@",display:"@",visibility:"@"},_matchmethod:function(){var i=null,t=document.documentElement;return["mozMatchesSelector","webkitMatchesSelector","msMatchesSelector","oMatchesSelector","matchesSelector"].every(function(e){return gui.Type.isDefined(t[e])&&(i=e),null===i}),i}()})}(gui.Combo.chained,gui.Arguments.confirmed),function(){function i(i){Object.defineProperty(gui.CSSPlugin.prototype,i,{enumerable:!0,configurable:!0,get:function(){return this.spirit?parseInt(this.get(i),10):void 0},set:function(t){this.set(i,t)}})}var t=gui.CSSPlugin._shorthands;for(var e in t)t.hasOwnProperty(e)&&i(e)}(),gui.DOMPlugin=function(i){return gui.Plugin.extend({id:i(function(i){return i?void(this.spirit.element.id=i):this.spirit.element.id||null}),title:i(function(i){var t=this.spirit.element;return gui.Type.isDefined(i)?void(t.title=i?i:""):t.title}),html:i(function(i,t){return gui.DOMPlugin.html(this.spirit.element,i,t)}),outerHtml:i(function(i){return gui.DOMPlugin.outerHtml(this.spirit.element,i)}),text:i(function(i){return gui.DOMPlugin.text(this.spirit.element,i)}),empty:i(function(){this.html("")}),hide:i(function(){this.spirit.css.contains(gui.CLASS_HIDDEN)||(this.spirit.css.add(gui.CLASS_HIDDEN),gui.hasModule("gui-layout@wunderbyte.com")&&this.spirit.visibility&&this.spirit.visibility.off())}),show:i(function(){this.spirit.css.contains(gui.CLASS_HIDDEN)&&(this.spirit.css.remove(gui.CLASS_HIDDEN),gui.hasModule("gui-layout@wunderbyte.com")&&this.spirit.visibility&&this.spirit.visibility.on())}),tag:function(){return this.spirit.element.localName},embedded:function(){return gui.DOMPlugin.embedded(this.spirit.element)},remove:function(){var i=this.spirit.element.parentNode;i.removeChild(this.spirit.element)},clone:function(){return this.spirit.element.cloneNode(!0)},ordinal:function(){return gui.DOMPlugin.ordinal(this.spirit.element)},compare:function(i){return gui.DOMPlugin.compare(this.spirit.element,i)},parseToNode:function(i){return gui.DOMPlugin.parseToNode(i)},parseToNodes:function(i){return gui.DOMPlugin.parseToNodes(i)}},{},{html:function(i,t,e){return gui.Type.isString(t)?e?i.insertAdjacentHTML(e,t):void(gui.mode===gui.MODE_ROBOT?(gui.materializeSub(i),gui.suspend(function(){i.innerHTML=t}),gui.spiritualizeSub(i)):i.innerHTML=t):i.innerHTML},outerHtml:function(i,t){return gui.Type.isString(t)?void(gui.mode===gui.MODE_ROBOT?(gui.materialize(i),gui.suspend(function(){i.outerHTML=t}),gui.spiritualize(i)):i.outerHTML=t):i.outerHTML},text:function(i,t){var e=gui.Guide;return gui.Type.isString(t)?void(gui.mode===gui.MODE_ROBOT?(e.materializeSub(i),gui.suspend(function(){i.textContent=t})):i.textContent=t):i.textContent},ordinal:function(i){var t=0,e=i.parentNode;if(e)for(var n=e.firstElementChild;n&&n!==i;)n=n.nextElementSibling,t++;return t},compare:function(i,t){return i=i instanceof gui.Spirit?i.element:i,t=t instanceof gui.Spirit?t.element:t,i.compareDocumentPosition(t)},contains:function(i,t){var e=Node.DOCUMENT_POSITION_CONTAINS+Node.DOCUMENT_POSITION_PRECEDING;return this.compare(t,i)===e},follows:function(i,t){return this.compare(t,i)===Node.DOCUMENT_POSITION_FOLLOWING},precedes:function(i,t){return this.compare(t,i)===Node.DOCUMENT_POSITION_PRECEDING},embedded:function(i){return i=i instanceof gui.Spirit?i.element:i,this.contains(i.ownerDocument,i)},group:function(i){function t(i,t){return t.some(function(t){return gui.DOMPlugin.contains(t,i)})}for(var e,n=[];e=i.pop();)t(e,i)||n.push(e);return n},q:function(i,t,e){var n=null;return this._qualify(i,t)(function(i,t){if(e)n=this.qall(i,t,e)[0]||null;else try{n=i.querySelector(t)}catch(r){throw console.error("Dysfunctional selector: "+t),r}return n})},qall:function(i,t,e){var n=[];return this._qualify(i,t)(function(i,t){return n=gui.Array.from(i.querySelectorAll(t)),e&&(n=n.filter(function(i){return i.spirit&&i.spirit instanceof e}).map(function(i){return i.spirit})),n})},qdoc:function(i,t){return this.q(document,i,t)},qdocall:function(i,t){return this.qall(document,i,t)},_qualify:function(i,t){var e,n=!0,r=this._thiskeyword;return i.nodeType===Node.ELEMENT_NODE&&r.test(t)&&(n=i.id,e=i.id=i.id||gui.KeyMaster.generateKey(),t=t.replace(r,"#"+e),i=i.ownerDocument),function(e){var r=e.call(gui.DOMPlugin,i,t);return n||(i.id=""),r}},_thiskeyword:/^this|,this/g})}(gui.Combo.chained,gui.Guide,gui.DOMObserver),gui.Object.bindall(gui.DOMPlugin),gui.DOMPlugin.mixin(gui.Object.map({q:function(i,t){return gui.DOMPlugin.q(this.spirit.element,i,t)},qall:function(i,t){return gui.DOMPlugin.qall(this.spirit.element,i,t)},qdoc:function(i,t){return gui.DOMPlugin.qdoc(i,t)},qdocall:function(i,t){return gui.DOMPlugin.qdocall(i,t)}},function(i,t){return function(){var e=arguments[0],n=arguments[1];if(gui.Type.isString(e)){if(1===arguments.length||gui.Type.isFunction(n))return t.apply(this,arguments);throw n=gui.Type.of(n),new TypeError("Unknown spirit for query: "+i+"("+e+","+n+")")}throw new TypeError("Bad selector for query: "+i+"("+e+")")}})),gui.DOMPlugin.mixin(gui.Object.map({next:function(i){var t=null,e=null,n=this.spirit.element;if(i){for(;null!==(n=n.nextElementSibling);)if(e=n.spirit,null!==e&&e instanceof i){t=e;break}}else t=n.nextElementSibling;return t},previous:function(i){var t=null,e=null,n=this.spirit.element;if(i){for(;null!==(n=n.previousElementSibling);)if(e=n.spirit,null!==e&&e instanceof i){t=e;break}}else t=n.previousElementSibling;return t},first:function(i){var t=null,e=null,n=this.spirit.element.firstElementChild;if(i)for(;null===t&&null!==n;)e=n.spirit,null!==e&&e instanceof i&&(t=e),n=n.nextElementSibling;else t=n;return t},last:function(i){var t=null,e=null,n=this.spirit.element.lastElementChild;if(i)for(;null===t&&null!==n;)e=n.spirit,null!==e&&e instanceof i&&(t=e),n=n.previoustElementSibling;else t=n;return t},parent:function(i){var t=this.spirit.element.parentNode;if(i){var e=t.spirit;t=e&&e instanceof i?e:null}return t},child:function(i){var t=this.spirit.element.firstElementChild;return i&&(t=this.children(i)[0]||null),t},children:function(i){var t=gui.Array.from(this.spirit.element.children);return i&&(t=t.filter(function(t){return t.spirit&&t.spirit instanceof i}).map(function(i){return i.spirit})),t},ancestor:function(i){var t=this.parent();return i&&(t=null,(new gui.Crawler).ascend(this.spirit.element,{handleSpirit:function(e){return e instanceof i?(t=e,gui.Crawler.STOP):void 0}})),t},ancestors:function(i){var t=[],e=new gui.Crawler;return i?e.ascend(this.element,{handleSpirit:function(e){e instanceof i&&t.push(e)}}):e.ascend(this.element,{handleElement:function(i){t.push(i)}}),t},descendant:function(i){var t=this.child(),e=this.spirit.element;return i&&(new gui.Crawler).descend(e,{handleSpirit:function(n){return n instanceof i&&n.element!==e?(t=n,gui.Crawler.STOP):void 0}}),t},descendants:function(i){var t=[],e=this.spirit.element;return(new gui.Crawler).descend(e,{handleElement:function(n){i||n===e||t.push(n)},handleSpirit:function(n){i&&n instanceof i&&n.element!==e&&t.push(n)}}),t},following:function(i){for(var t,e=[],n=this.spirit.element;n=n.nextElementSibling;)i&&(t=n.spirit)?t instanceof i&&e.push(t):e.push(n);return e},preceding:function(i){for(var t,e=[],n=this.spirit.element;n=n.previousElementSibling;)i&&(t=n.spirit)?t instanceof i&&e.push(t):e.push(n);return e}},function(i,t){return function(e){if(!gui.Type.isDefined(e)||gui.Type.isFunction(e))return t.apply(this,arguments);throw new TypeError("Unknown spirit for query: "+i+"("+gui.Type.of(e)+")")}})),function(){function i(i){gui.mode!==gui.MODE_ROBOT&&gui.spiritualize(i)}gui.DOMPlugin.mixin({appendTo:function(t){var e=this.spirit.element;return gui.Type.isSpirit(t)?t.dom.append(e):gui.Type.isElement(t)&&(t.appendChild(e),i(t)),this},parseToNode:function(i,t){return gui.HTMLParser.parseToNode(i,t)},parseToNodes:function(i,t){return gui.HTMLParser.parseToNodes(i,t)}})}(),function(){function i(i){gui.mode!==gui.MODE_ROBOT&&gui.spiritualize(i)}gui.DOMPlugin.mixin(gui.Object.map({append:function(t){var e=t,n=this.spirit.element;e.forEach(function(t){n.appendChild(t),i(t)})},prepend:function(t){var e=t,n=this.spirit.element,r=n.firstChild;e.reverse().forEach(function(t){n.insertBefore(t,r),i(t)})},before:function(t){var e=t,n=this.spirit.element,r=n.parentNode;e.reverse().forEach(function(t){r.insertBefore(t,n),i(t)})},after:function(t){var e=t,n=this.spirit.element,r=n.parentNode;e.forEach(function(t){r.insertBefore(t,n.nextSibling),i(t)})},replace:function(i){this.after(i),this.remove()}},function(i,t){return function(i){var e=Array.map(gui.Array.make(i),function(i){return i&&i instanceof gui.Spirit?i.element:i}).filter(function(i){return i&&gui.Type.isNumber(i.nodeType)});return e.length&&t.call(this,e),i}}))}(),gui.EventPlugin=function(t){return gui.Tracker.extend({add:t(function(i,t,e,n){if(t=t?t:this.spirit.element,t=t instanceof gui.Spirit?t.element:t,!t.nodeType&&!gui.Type.isWindow(t))throw new TypeError("Invalid target: "+t+" ("+this.spirit.$classname+")");if(e=e?e:this.spirit,n=n?n:!1,gui.Interface.validate(gui.IEventHandler,e)){var r=[t,e,n];gui.Array.make(i).forEach(function(i){this._addchecks(i,r)&&this._addEventListener(!0,t,i,e,n)},this)}}),remove:t(function(i,t,e,n){if(t=t?t:this.spirit.element,t=t instanceof gui.Spirit?t.element:t,!t.nodeType&&!gui.Type.isWindow(t))throw new TypeError("Invalid target: "+t+" ("+this.spirit.$classname+")");if(e=e?e:this.spirit,n=n?n:!1,gui.Interface.validate(gui.IEventHandler,e)){var r=[t,e,n];gui.Array.make(i).forEach(function(i){this._removechecks(i,r)&&this._addEventListener(!1,t,i,e,n)},this)}}),toggle:t(function(i,t,e,n){t=t?t:this.spirit.element,e=e?e:this.spirit,n=n?n:!1,t instanceof gui.Spirit&&(t=t.element);var r=[t,e,n];gui.Array.make(i).forEach(function(i){this._contains(i,r)?this.add(i,t,e,n):this.remove(i,t,e,n)},this)}),dispatch:function(t,e){var n=this.spirit.element,r=null;return i.CustomEvent&&!gui.Client.isExplorer?r=new CustomEvent(t,e):(e=e||{bubbles:!1,cancelable:!1,detail:void 0},r=document.createEvent("HTMLEvents"),r.initEvent(t,e.bubbles,e.cancelable)),r.eventName=t,n.dispatchEvent?n.dispatchEvent(r):n[t]?n[t]():n["on"+t]?n["on"+t]():void 0
},_addEventListener:function(i,t,e,n,r){var u=i?"addEventListener":"removeEventListener";t[u](e,n,r)},_cleanup:function(i,t){var e=t[0],n=t[1],r=t[2];this.remove(i,e,n,r)},_breakdown:function(i){return gui.Tracker.prototype._breakdown.call(this,i).map(function(i){return"transitionend"===i?this._transitionend():i},this)},_transitionend:function(){var i,t=this.spirit.document.createElement("fakeelement"),e={transition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(i in e)if(void 0!==t.style[i])return e[i]}})}(gui.Combo.chained),gui.IEventHandler={toString:function(){return"[object IEventHandler]"},handleEvent:function(){},onevent:function(){}},gui.SpritePlugin=gui.Plugin.extend({x:{getter:function(){return this._pos.x},setter:function(i){this._pos.x=i,this._apply()}},y:{getter:function(){return this._pos.y},setter:function(i){this._pos.y=i,this._apply()}},z:{getter:function(){return this._pos.z},setter:function(i){this._pos.z=i,this._apply()}},onconstruct:function(){gui.Plugin.prototype.onconstruct.call(this),this._pos=new gui.Position},reset:function(){this.spirit.css.set("-beta-transform","")},_pos:null,_apply:function(){var i=this._pos,t=[i.x,i.y,i.z].map(Math.round);this.spirit.css.set("-beta-transform","translate3d("+t.join("px,")+"px)")}}),gui.Spirit=gui.Class.create(Object.prototype,{$instanceid:null,$contextid:null,$destructed:!1,element:null,document:null,window:null,toString:function(){return"[object gui.Spirit]"},onconstruct:function(){},onconfigure:function(){},onenter:function(){},onattach:function(){},onready:function(){},oninit:function(){},ondetach:function(){},onexit:function(){},ondestruct:function(){},onasync:function(){},oncrawler:function(){},$onconstruct:function(i,t,e,n){this.element=i,this.document=t,this.window=e,this.$contextid=n,gui.Spirit.$construct(this)},$ondestruct:function(){},$pluginplugins:function(){var i,t=this.constructor.$plugins;this.life=new gui.LifePlugin(this),this.config=new gui.ConfigPlugin(this),Object.keys(t).filter(function(i){return"life"!==i&&"config"!==i}).sort().forEach(function(e){i=t[e],(this.life.plugins[e]=!i.lazy)?gui.Plugin.$assign(this,e,new i(this)):gui.Plugin.$prepare(this,e,i)},this)},$debug:function(i){if(gui.debug){var t,e=this.element,n=gui.attributes[0];i?gui.attributes.every(function(i){return!e.hasAttribute(i)})&&(t="["+this.constructor.$classname+"]",e.setAttribute(n,t)):(t=e.getAttribute(n),t&&t.startsWith("[")&&e.removeAttribute(n))}}},{portals:!0,summon:function(i){return this.possess((i||document).createElement("div"))},possess:function(i){return gui.Guide.possess(i,this)},extend:function(){var i,t=[],e=gui.Class.breakdown(arguments);["name","protos","recurring","statics"].forEach(function(n){(i=e[n])&&t.push(i)},this);var n=gui.Class.extend.apply(this,t);n.$plugins=gui.Object.copy(this.$plugins);var r=gui.Class.breakdown(arguments);return gui.Object.each(n.$plugins,function(i,t){var e=r.protos[i];switch(gui.Type.of(e)){case"object":var u=t.extend(e);n.plugin(i,u,!0);break;case"undefined":break;default:throw new TypeError(n+": Bad definition for "+i+": "+e)}},this),n},plugin:function(i,t,e){var n=this.$plugins,r=this.prototype;!r.hasOwnProperty(i)||null===r.prefix||e?(!n[i]||e)&&(n[i]=t,r.prefix=null,gui.Class.children(this,function(n){n.plugin(i,t,e)})):console.error("Plugin naming crash in "+this+": "+i)},$plugins:Object.create(null)},{$construct:function(i){i.$pluginplugins(),i.$debug(!0),i.life.constructed=!0,i.onconstruct(),i.life.dispatch(gui.LIFE_CONSTRUCT)},$configure:function(i){i.config.configureall(),i.life.configured=!0,i.onconfigure(),i.life.dispatch(gui.LIFE_CONFIGURE)},$enter:function(i){i.window.gui.inside(i),i.life.entered=!0,i.onenter(),i.life.dispatch(gui.LIFE_ENTER)},$attach:function(i){i.window.gui.inside(i),i.life.attached=!0,i.onattach(),i.life.dispatch(gui.LIFE_ATTACH)},$ready:function(i){i.life.ready=!0,i.onready(),i.life.dispatch(gui.LIFE_READY)},$detach:function(i){i.window.gui.outside(i),i.life.detached=!0,i.life.visible=!1,i.life.dispatch(gui.LIFE_DETACH),i.life.dispatch(gui.LIFE_INVISIBLE),i.ondetach()},$exit:function(i){i.life.exited=!0,i.life.dispatch(gui.LIFE_EXIT),i.onexit()},$async:function(i){i.life.async=!0,i.onasync(),i.life.dispatch(gui.LIFE_ASYNC)},$destruct:function(i){i.$debug(!1),i.life.destructed=!0,i.life.dispatch(gui.LIFE_DESTRUCT),i.ondestruct()},$dispose:function(i){i.$ondestruct(),i.$destructed=!0,gui.destruct(i),gui.GreatSpirit.$meet(i)},$oninit:function(i){i.life.initialized=!0,i.life.dispatch("life-initialized"),i.oninit()}}),gui.DocumentSpirit=gui.Spirit.extend({onready:function(){gui.Spirit.prototype.onready.call(this),(this.waiting=gui.hosted)&&this.action.addGlobal(gui.$ACTION_XFRAME_VISIBILITY),this.action.dispatchGlobal(gui.ACTION_DOC_ONSPIRITUALIZED)},onaction:function(i){switch(gui.Spirit.prototype.onaction.call(this,i),this.action.$handleownaction=!1,i.type){case gui.$ACTION_XFRAME_VISIBILITY:this._waiting=!1,gui.hasModule("gui-layout@wunderbyte.com")&&(i.data===!0?this.visibility.on():this.visibility.off()),i.consume()}},oncrawler:function(i){var t=gui.Spirit.prototype.oncrawler.call(this,i);if(t===gui.Crawler.CONTINUE)switch(i.type){case gui.CRAWLER_VISIBLE:case gui.CRAWLER_INVISIBLE:this._waiting&&(t=gui.Crawler.STOP)}return t},onvisible:function(){this.css.remove(gui.CLASS_INVISIBLE),gui.Spirit.prototype.onvisible.call(this)},oninvisible:function(){this.css.add(gui.CLASS_INVISIBLE),gui.Spirit.prototype.oninvisible.call(this)},_loaded:!1,_waiting:!1,_timeout:null}),gui.IframeSpirit=gui.Spirit.extend({spiritualized:!1,fit:!1,xguest:null,contentWindow:{getter:function(){return this.element.contentWindow}},contentDocument:{getter:function(){return this.element.contentDocument}},contentLocation:null,onconstruct:function(){gui.Spirit.prototype.onconstruct.call(this),this.event.add("message",this.window),this._postbox=[]},onenter:function(){gui.Spirit.prototype.onenter.call(this),this.event.add("load"),this.action.addGlobal([gui.ACTION_DOC_ONDOMCONTENT,gui.ACTION_DOC_ONLOAD,gui.ACTION_DOC_ONHASH,gui.ACTION_DOC_ONSPIRITUALIZED,gui.ACTION_DOC_UNLOAD]),this.fit&&(this.css.height=0);var i=this.element.src;i&&i!==gui.IframeSpirit.SRC_DEFAULT&&(i.startsWith("blob:")||this._setupsrc(i))},onaction:function(i){gui.Spirit.prototype.onaction.call(this,i),this.action.$handleownaction=!1;var t;switch(i.type){case gui.ACTION_DOC_ONDOMCONTENT:this.contentLocation=new gui.URL(document,i.data),this.life.dispatch(gui.LIFE_IFRAME_DOMCONTENT),this.action.remove(i.type),i.consume();break;case gui.ACTION_DOC_ONLOAD:this.contentLocation=new gui.URL(document,i.data),this.life.dispatch(gui.LIFE_IFRAME_ONLOAD),this.action.remove(i.type),i.consume();break;case gui.ACTION_DOC_ONHASH:t=this.contentLocation.href.split("#")[0],this.contentLocation=new gui.URL(document,t+i.data),this.life.dispatch(gui.LIFE_IFRAME_ONHASH),i.consume();break;case gui.ACTION_DOC_ONSPIRITUALIZED:this._onspiritualized(),this.life.dispatch(gui.LIFE_IFRAME_SPIRITUALIZED),this.action.remove(i.type),i.consume();break;case gui.ACTION_DOC_UNLOAD:this._onunload(),this.life.dispatch(gui.LIFE_IFRAME_UNLOAD),this.action.add([gui.ACTION_DOC_ONCONSTRUCT,gui.ACTION_DOC_ONDOMCONTENT,gui.ACTION_DOC_ONLOAD,gui.ACTION_DOC_ONSPIRITUALIZED]),i.consume()}},onevent:function(i){switch(gui.Spirit.prototype.onevent.call(this,i),i.type){case"message":this._onmessage(i.data,i.origin,i.source);break;case"load":}},onvisible:function(){gui.Spirit.prototype.onvisible.call(this),this.spiritualized&&this._visibility()},oninvisible:function(){gui.Spirit.prototype.oninvisible.call(this),this.spiritualized&&this._visibility()},src:function(i){return i&&(this._setupsrc(i),this.element.src=i),this.element.src},url:function(i,t){return t&&this._setupsrc(t),i&&(this.element.src=i),this.contentLocation.href},postMessage:function(i){this.spiritualized?this.contentWindow.postMessage(i,"*"):this._postbox.push(i)},_setupsrc:function(i){var t=document;this.contentLocation=new gui.URL(t,i),this.xguest=function(e){if(e)return"*";if(gui.URL.external(i,t)){var n=new gui.URL(t,i);return n.protocol+"//"+n.host}return null}(this._sandboxed())},_onspiritualized:function(){for(this.spiritualized=!0;this._postbox.length;)this.postMessage(this._postbox.shift());this._visibility()},_onfit:function(i){this.fit&&(this.css.height=i,this.action.dispatchGlobal(gui.ACTION_DOC_FIT))},_onunload:function(){this.spiritualized=!1,this.fit&&(this.css.height=0)},_onmessage:function(i,t,e){if(e===this.contentWindow&&i.startsWith("spiritual-action:")){var n=gui.Action.parse(i);n.direction===gui.Action.ASCEND&&(this.action.$handleownaction=!0,this.action.ascendGlobal(n.type,n.data))}},_sandboxed:function(){var i=this.element.sandbox;return i&&i.length},_visibility:function(){gui.hasModule("gui-layout@wunderbyte.com")&&gui.Type.isDefined(this.life.visible)&&this.action.descendGlobal(gui.$ACTION_XFRAME_VISIBILITY,this.life.visible)}},{summon:function(i,t){var e=i.createElement("iframe"),n=this.possess(e);if(n.css.add("gui-iframe"),t){if(gui.URL.external(t,i)){var r=new gui.URL(i,t);n.xguest=r.protocol+"//"+r.host}}else t=this.SRC_DEFAULT;return e.src=t,n}},{SRC_DEFAULT:"javascript:void(false);"}),gui.Position=function(i,t,e){this.x=i||0,this.y=t||0,this.z=e||0},gui.Position.prototype={x:0,y:0,z:0,toString:function(){return"[object gui.Position]"},clone:function(){return new gui.Position(this.x,this.y,this.z)}},gui.Position.isEqual=function(i,t){return i.x===t.x&&i.y===t.y},gui.Dimension=function(i,t){this.w=i||0,this.h=t||0},gui.Dimension.prototype={w:0,h:0,toString:function(){return"[object gui.Dimension]"}},gui.Dimension.isEqual=function(i,t){return i.w===t.w&&i.h===t.h},gui.Geometry=function(i,t,e,n){this.x=i||0,this.y=t||0,this.w=e||0,this.h=n||0},gui.Geometry.prototype={x:0,y:0,w:0,h:0,toString:function(){return"[object gui.Geometry]"},hitTest:function(i){return gui.Geometry.hitTest(this,i)}},gui.Geometry.isEqual=function(i,t){return i.x===t.x&&i.y===t.y&&i.w===t.w&&i.h===t.h},gui.Geometry.hitTest=function(i,t){function e(i,t){return i.x>=t.x&&i.x<=t.x+t.w}function n(i,t){return i.y>=t.y&&i.y<=t.y+t.h}var r=e(i,t)||e(t,i),u=n(i,t)||n(t,i);return r&&u},gui.DOMChanger={setup:function(i){var t=i.Element.prototype;if(gui.Type.isDefined(t.spirit))throw new Error("Spiritual loaded twice?");t.spirit=null},change:function(i){this.upgrade(i,gui.DOMCombos)},upgrade:function(i,t){this._change(i,t)},_change:function(i,t){this._canchange(Element.prototype,i,t)||i.HTMLElement&&this._canchange(HTMLElement.prototype,i)||this._changeoldgecko(i,t)},_changeoldgecko:function(t,e){var n=[];this._tags().forEach(function(t){var r=document.createElement(t),u=r.constructor.prototype;u!==Object.prototype&&-1===n.indexOf(u)&&(this._dochange(u,i,e),n.push(u))},this)},_tags:function(){return"a abbr address area article aside audio b base bdi bdo blockquote body br button canvas caption cite code col colgroup command datalist dd del details device dfn div dl dt em fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins kbd keygen label legend li link main map menu meta meter nav noscript ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strong style submark summary sup table tbody td textarea tfoot th thead time title tr track ul unknown var video wbr".split(" ")},_canchange:function(i,t,e){var n=!1,r="it appears to work",u=i.hasChildNodes;i.hasChildNodes=function(){return r};var s=t.document.documentElement;return s.hasChildNodes()===r&&(i.hasChildNodes=u,this._dochange(i,t,e),n=!0),n},_dochange:function(i,t,e){var n=t.document.documentElement;gui.Object.each(e,function(t,e){this._docombo(i,t,e,n)},this)},_docombo:function(i,t,e,n){this._ismethod(t)?this._domethod(i,t,e):gui.Client.isGecko?this._dogecko(i,t,e,n):gui.Client.isExplorer&&this._doie(i,t,e)},_ismethod:function(i){var t=!1;switch(i){case"appendChild":case"removeChild":case"insertBefore":case"replaceChild":case"setAttribute":case"removeAttribute":case"insertAdjecantHTML":t=!0}return t},_domethod:function(i,t,e){var n=i[t];i[t]=e(function(){return n.apply(this,arguments)})},_doie:function(i,t,e){var n=Object.getOwnPropertyDescriptor(i,t);Object.defineProperty(i,t,{get:function(){return n.get.call(this)},set:e(function(){n.apply(this,arguments)})})},_dogecko:function(i,t,e,n){var r=n.__lookupGetter__(t),u=n.__lookupSetter__(t);r&&(i.__defineGetter__(t,function(){return r.apply(this,arguments)}),i.__defineSetter__(t,e(function(){u.apply(this,arguments)})))}},gui.DOMCombos=function(){var i=gui.Combo,t=i.before,e=i.after,n=i.around,r=i.provided,u=r(function(){return gui.DOMPlugin.embedded(this)}),s=r(function(){return!gui.Type.isNull(this.spirit)}),o=e(function(i){gui.spiritualize(i)}),a=e(function(i){gui.spiritualize(i)}),c=t(function(i,t){gui.materialize(t)}),l=t(function(i){gui.Guide.detach(i)}),h=t(function(i,t){this.spirit.att.set(i,t)}),g=t(function(i){this.spirit.att.del(i)}),d=n(function(i){return gui.DOMObserver.observes?gui.DOMObserver.suspend(function(){return i()}):i()}),f=t(function(){gui.materializeSub(this)}),p=e(function(){gui.spiritualizeSub(this)}),m=null,_=t(function(){m=this.parentNode,gui.materialize(this)}),v=e(function(){gui.spiritualize(m)}),b=e(function(){}),y=r(function(){var i=this.ownerDocument.defaultView;return i?i.gui.mode!==gui.MODE_HUMAN:!1}),E=r(function(){var i=this.ownerDocument.defaultView;return i?i.gui.mode!==gui.MODE_FUNNY:!1}),T=function(i){return i};return{appendChild:function(i){return y(E(u(o(d(i)),T(i)),T(i)),T(i))},insertBefore:function(i){return y(E(u(o(d(i)),T(i)),T(i)),T(i))},replaceChild:function(i){return y(u(c(E(a(d(i)),T(d(i)))),T(i)),T(i))},insertAdjecantHTML:function(i){return y(u(E(b(d(i)),T(d(i)))),T(i)),T(i)},removeChild:function(i){return y(u(l(d(i)),T(i)),T(i))},setAttribute:function(i){return y(u(s(h(i),T(i)),T(i)),T(i))},removeAttribute:function(i){return y(u(s(g(i),T(i)),T(i)),T(i))},innerHTML:function(i){return y(u(f(p(d(i))),T(i)),T(i))},outerHTML:function(i){return y(u(_(v(d(i))),T(i)),T(i))},textContent:function(i){return y(u(f(d(i)),T(i)),T(i))}}}(),gui.DOMObserver={observes:!1,observe:function(){if(!gui.Client.hasMutations)throw new Error("MutationObserver no such thing");if(!this._observer){var i=this._mutationobserver();this._observer=new i(function(i){i.forEach(function(i){gui.DOMObserver._handleMutation(i)})})}this._connect(!0),this.observes=!0},suspend:function(i,t){var e;return this.observes&&1===++this._suspend&&this._connect(!1),gui.Type.isFunction(i)&&(e=i.call(t)),this.observes&&this.resume(),e},resume:function(){this.observes&&0===--this._suspend&&this._connect(!0)},_suspend:0,_observer:null,_mutationobserver:function(){return i.MutationObserver||i.WebKitMutationObserver||i.MozMutationObserver},_connect:function(i){var t=this._observer;t&&(i?t.observe(document,{childList:!0,subtree:!0}):t.disconnect())},_handleMutation:function(i){Array.forEach(i.removedNodes,function(i){i.nodeType===Node.ELEMENT_NODE&&gui.materialize(i)},this),Array.forEach(i.addedNodes,function(i){i.nodeType===Node.ELEMENT_NODE&&gui.spiritualize(i)},this)}},gui.Guide={toString:function(){return"[object gui.Guide]"},setup:function(){gui.Broadcast.addGlobal(gui.BROADCAST_KICKSTART,this);var t=gui.Client.isExplorer?"loading":document.readyState;switch(t){case"loading":document.addEventListener("DOMContentLoaded",this,!1),i.addEventListener("load",this,!1);break;case"interactive":this._ondom(),i.addEventListener("load",this,!1);break;case"complete":}},handleEvent:function(i){switch(i.currentTarget.removeEventListener(i.type,this,!1),i.type){case"DOMContentLoaded":this._ondom();break;case"load":}},onbroadcast:function(t){switch(t.type){case gui.BROADCAST_KICKSTART:gui.Broadcast.removeGlobal(t.type,this),this._step1(i,document)}},detach:function(i){this._maybedetach(i)},possess:function(i,t){var e=i.ownerDocument,n=e.defaultView,r=n.gui.$contextid;if(i.spirit)throw new Error("Cannot repossess element with spirit "+i.spirit+" (exorcise first)");if(gui.debug&&!gui.Type.isSpiritConstructor(t))throw new Error("Not a spirit constructor ("+gui.Type.of(t)+")");return i.spirit=new t(i,e,n,r),i.spirit},exorcise:function(i){i.life.destructed||(gui.Spirit.$destruct(i),gui.Spirit.$dispose(i))},suspend:function(i,t){this._suspended=!0;var e=i.call(t);return this._suspended=!1,e},$spiritualize:function(i){i=i instanceof gui.Spirit?i.element:i,this._maybespiritualize(i,!1,!1)},$spiritualizeSub:function(i){this._maybespiritualize(i,!0,!1)},$spiritualizeOne:function(i){this._maybespiritualize(i,!1,!0)},$materialize:function(i){this._maybematerialize(i,!1,!1)},$materializeSub:function(i){this._maybematerialize(i,!0,!1)},$materializeOne:function(i){this._maybematerialize(i,!1,!0)},$shutdown:function(){gui.Broadcast.dispatch(gui.BROADCAST_WILL_UNLOAD),gui.Broadcast.dispatch(gui.BROADCAST_UNLOAD),this.$materialize(document)},_suspended:!1,_handles:function(i){return i&&!this._suspended&&gui.DOMPlugin.embedded(i)&&i.nodeType===Node.ELEMENT_NODE},_ondom:function(){if(gui.autostart){var t=document.querySelector('meta[name="gui.autostart"]');t&&gui.Type.cast(t.getAttribute("content"))===!1||this._step1(i,document)}},_step1:function(i,t){gui.Broadcast.removeGlobal(gui.BROADCAST_KICKSTART,this),gui.start().then(function(){this._step2(i,t)},this)},_step2:function(i,t){var e=i.gui.$contextid;gui.DOMChanger.setup(i),gui.broadcastGlobal(gui.BROADCAST_WILL_SPIRITUALIZE,e),this._step3(i,t),gui.broadcastGlobal(gui.BROADCAST_DID_SPIRITUALIZE,e)},_step3:function(i,t){var e=t.documentElement;gui.spiritualizeOne(e),gui.mode!==gui.MODE_HUMAN&&(gui.DOMChanger.change(i),gui.Client.isWebKit&&gui.DOMObserver.observe(i),gui.debugmutations&&console.warn("Deprecated API is deprecated: gui.debugmutations"),gui.spiritualizeSub(e),gui.$onready())},_collect:function(i,t,e){var n=[];return new gui.Crawler(e).descend(i,{handleSpirit:function(e){t&&e.element===i||e.life.destructed||n.push(e)}}),n},_maybespiritualize:function(i,t,e){i=i instanceof gui.Spirit?i.element:i,i=i.nodeType===Node.DOCUMENT_NODE?i.documentElement:i,this._handles(i)&&this._spiritualize(i,t,e)},_spiritualize:function(i,t,e){t=!1;var n="gui-spiritualizing";if(!i.hasAttribute(n)){var r,u=[];i.setAttribute(n,"true"),new gui.Crawler(gui.CRAWLER_SPIRITUALIZE).descend(i,{handleElement:function(s){if(s!==i&&s.hasAttribute(n))return e?gui.Crawler.STOP:gui.Crawler.SKIP_CHILDREN;if(t&&s===i||(r=s.spirit,r||(r=gui.Guide._evaluate(s)),r&&(r.life.attached||u.push(r))),e)return gui.Crawler.STOP;if(!s.childElementCount)return gui.Crawler.SKIP_CHILDREN;switch(s.localName){case"pre":case"code":return gui.Crawler.SKIP_CHILDREN}return gui.Crawler.CONTINUE}}),i.removeAttribute(n),this._sequence(u)}},_sequence:function(){function i(i){return i.life.configured||gui.Spirit.$configure(i),i}function t(i){return i.life.entered||gui.Spirit.$enter(i),i}function e(i){return gui.Spirit.$attach(i),i}function n(i){i.life.ready||gui.Spirit.$ready(i)}return function(r){r.map(i).map(t).map(e).reverse().forEach(n)}}(),_maybematerialize:function(i,t,e,n){i=i instanceof gui.Spirit?i.element:i,i=i.nodeType===Node.DOCUMENT_NODE?i.documentElement:i,(n||this._handles(i))&&(i.setAttribute("gui-matarializing","true"),this._materialize(i,t,e),i.removeAttribute("gui-matarializing"))},_materialize:function(i,t){this._collect(i,t,gui.CRAWLER_MATERIALIZE).reverse().filter(function(i){return i.life.attached&&!i.life.destructed?(gui.Spirit.$destruct(i),!0):!1}).forEach(function(i){gui.Spirit.$dispose(i)})},_maybedetach:function(i){i=i instanceof gui.Spirit?i.element:i,this._handles(i)&&this._collect(i,!1,gui.CRAWLER_DETACH).forEach(function(i){gui.Spirit.$detach(i)})},_evaluate:function(i){if(!i.spirit){var t=i.ownerDocument,e=t.defaultView,n=e.gui.evaluate(i);n&&this.possess(i,n)}return i.spirit},_visibility:function(i){gui.hasModule("gui-layout@wunderbyte.com")&&gui.DOMPlugin.group(i).forEach(function(i){gui.VisibilityPlugin.$init(i)},this)},$goasync:function(i){if(i.forEach(function(i){gui.Spirit.$async(i)}),gui.hosted){var t=gui.get("html");if(void 0===t.life.visible)return}this._visibility(i)}},function(){gui.Guide.setup()}(),gui.module("gui-spirits@wunderbyte.com",{channel:[["html",gui.DocumentSpirit],[".gui-iframe",gui.IframeSpirit],[".gui-spirit",gui.Spirit]],plugin:{action:gui.ActionPlugin,broadcast:gui.BroadcastPlugin,tick:gui.TickPlugin,att:gui.AttPlugin,config:gui.ConfigPlugin,box:gui.BoxPlugin,css:gui.CSSPlugin,dom:gui.DOMPlugin,event:gui.EventPlugin,life:gui.LifePlugin,sprite:gui.SpritePlugin},mixin:{onaction:function(){},onbroadcast:function(){},ontick:function(){},onatt:function(){},onevent:function(){},onlife:function(){},handleEvent:function(i){"webkitTransitionEnd"===i.type&&(i={type:"transitionend",target:i.target,propertyName:i.propertyName,elapsedTime:i.elapsedTime,pseudoElement:i.pseudoElement}),this.onevent(i)},$ondestruct:gui.Combo.before(function(){this.handleEvent=function(){}})(gui.Spirit.prototype.$ondestruct)}})}(self);