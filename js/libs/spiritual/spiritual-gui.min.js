!function(t){"use strict";t.gui={version:"0.1.6",portals:!0,debug:!1,MODE_ROBOT:"robot",MODE_HUMAN:"human",MODE_FUNNY:"funny",PARAM_CONTEXTID:"gui-contextid",PARAM_XHOST:"gui-xhost",BROADCAST_KICKSTART:"gui-broadcast-kickstart",BROADCAST_WILL_SPIRITUALIZE:"gui-broadcast-will-spiritualize",BROADCAST_DID_SPIRITUALIZE:"gui-broadcast-did-spiritualize",BROADCAST_MOUSECLICK:"gui-broadcast-mouseevent-click",BROADCAST_MOUSEMOVE:"gui-broadcast-mouseevent-mousemove",BROADCAST_MOUSEDOWN:"gui-broadcast-mouseevent-mousedown",BROADCAST_MOUSEUP:"gui-broadcast-mouseevent-mouseup",BROADCAST_SCROLL:"gui-broadcast-window-scroll",BROADCAST_RESIZE:"gui-broadcast-window-resize",BROADCAST_RESIZE_END:"gui-broadcast-window-resize-end",BROADCAST_POPSTATE:"gui-broadcast-window-popstate",BROADCAST_HASHCHANGE:"gui-broadcast-window-hashchange",BROADCAST_ORIENTATIONCHANGE:"gui-broadcast-orientationchange",BROADCAST_LOADING_CHANNELS:"gui-broadcast-loading-channels",BROADCAST_CHANNELS_LOADED:"gui-broadcast-channels-loaded",BROADCAST_TWEEN:"gui-broadcast-tween",BROADCAST_WILL_UNLOAD:"gui-broadcast-will-unload",BROADCAST_UNLOAD:"gui-broadcast-unload",BROADCAST_ATTENTION_ENTER:"gui-broadcast-attention-enter",BROADCAST_ATTENTION_EXIT:"gui-broadcast-attention-exit",BROADCAST_ATTENTION_MOVE:"gui-broadcast-attention-move",ACTION_DOC_ONDOMCONTENT:"gui-action-document-domcontent",ACTION_DOC_ONLOAD:"gui-action-document-onload",ACTION_DOC_ONHASH:"gui-action-document-onhash",ACTION_DOC_ONSPIRITUALIZED:"gui-action-document-spiritualized",ACTION_DOC_UNLOAD:"gui-action-document-unload",$ACTION_XFRAME_VISIBILITY:"gui-action-xframe-visibility",ACTION_WINDOW_LOADING:"gui-action-window-loading",ACTION_WINDOW_LOADED:"gui-action-window-loaded",LIFE_CONSTRUCT:"gui-life-construct",LIFE_CONFIGURE:"gui-life-configure",LIFE_ENTER:"gui-life-enter",LIFE_ATTACH:"gui-life-attach",LIFE_READY:"gui-life-ready",LIFE_DETACH:"gui-life-detach",LIFE_EXIT:"gui-life-exit",LIFE_ASYNC:"gui-life-async",LIFE_DESTRUCT:"gui-life-destruct",LIFE_VISIBLE:"gui-life-visible",LIFE_INVISIBLE:"gui-life-invisible",LIFE_RENDER:"gui-life-render",LIFE_IFRAME_CONSTRUCT:"gui-life-iframe-construct",LIFE_IFRAME_DOMCONTENT:"gui-life-iframe-domcontent",LIFE_IFRAME_SPIRITUALIZED:"gui-life-iframe-spiritualized",LIFE_IFRAME_ONLOAD:"gui-life-iframe-onload",LIFE_IFRAME_ONHASH:"gui-life-iframe-onhash",LIFE_IFRAME_UNLOAD:"gui-life-iframe-unload",TICK_DOC_FIT:"gui-tick-document-fit",$TICK_INSIDE:"gui-tick-spirits-inside",$TICK_OUTSIDE:"gui-tick-spirits-outside",$TICK_DESTRUCT:"gui-tick-spirits-destruct",CRAWLER_SPIRITUALIZE:"gui-crawler-spiritualize",CRAWLER_MATERIALIZE:"gui-crawler-materialize",CRAWLER_DETACH:"gui-crawler-detach",CRAWLER_DISPOSE:"gui-crawler-dispose",CRAWLER_ACTION:"gui-crawler-action",CRAWLER_VISIBLE:"gui-crawler-visible",CRAWLER_INVISIBLE:"gui-crawler-invisible",CLASS_NOSPIRITS:"gui-nospirits",CLASS_INVISIBLE:"_gui-invisible",CLASS_HIDDEN:"_gui-hidden",CLASS_COVER:"_gui-cover",TIMEOUT_RESIZE_END:250,orientation:0,ORIENTATION_PORTRAIT:0,ORIENTATION_LANDSCAPE:1},gui.URL=function(t,i){if(!t||t.nodeType!==Node.DOCUMENT_NODE)throw new TypeError("Document expected");var e,n=gui.URL._createLink(t,i);Object.keys(gui.URL.prototype).forEach(function(t){gui.Type.isString(e=n[t])&&("pathname"!==t||e.startsWith("/")||(e="/"+e),this[t]=e)},this),this.id=this.hash?this.hash.substring(1):null,this.external=this.href.split("#")[0]!==t.URL.split("#")[0]},gui.URL.prototype={hash:null,host:null,hostname:null,href:null,pathname:null,port:null,protocol:null,search:null,id:null,external:!1,toString:function(){return this.href}},gui.URL.absolute=function(t,i){if(i=i||"",t.nodeType===Node.DOCUMENT_NODE)return new gui.URL(t,i).href;if("string"==typeof t){var e=t.split("/"),n=i.split("/");return e.pop(),n.forEach(function(t){"."!==t&&(".."===t?e.pop():e.push(t))}),e.join("/")}},gui.URL.external=function(t,i){i=i||document;var e=new gui.URL(i,t);return e.host!==i.location.host||e.port!==i.location.port},gui.URL.getParam=function(t,i){i=i.replace(/(\[|\])/g,"\\$1");var e=new RegExp("[\\?&]"+i+"=([^&#]*)").exec(t);return null===e?null:e[1]},gui.URL.setParam=function(t,i,e){var n,r=[],o=-1,u=t.split("#")[0],s=t.split("#")[1];return u.indexOf("?")>-1&&(n=u.split("?"),u=n[0],r=n[1].split("&"),r.every(function(t,n){var u=t.split("=");return u[0]===i&&(o=n,null!==e&&(u[1]=e,r[n]=u.join("="))),0>o})),null===e?o>-1&&r.remove(o,o):0>o&&(r[r.length]=[i,e].join("=")),r=r.length>0?"?"+r.join("&"):"",u+r+(s?"#"+s:"")},gui.URL.parametrize=function(t,i){return gui.Type.isObject(i)&&gui.Object.each(i,function(i,e){switch(t+=t.contains("?")?"&":"?",gui.Type.of(e)){case"array":t+=e.map(function(t){return i+"="+String(t)}).join("&");break;default:t+=i+"="+String(e)}}),t},gui.URL.origin=function(t){var i=t.location;return i.origin||i.protocol+"//"+i.host},gui.URL._createLink=function(t,i){var e=t.createElement("a");if(e.href=i||"",gui.Client.isExplorer){var n=gui.URL.parseUri(e.href);Object.keys(n).forEach(function(t){e[t]||(e[t]=n[t])})}return e},gui.URL.parseUri=function(t){for(var i=gui.URL.parseOptions,e=i.parser[i.strictMode?"strict":"loose"].exec(t),n={},r=14;r--;)n[i.key[r]]=e[r]||"";return n[i.q.name]={},n[i.key[12]].replace(i.q.parser,function(t,e,r){e&&(n[i.q.name][e]=r)}),n},gui.URL.parseOptions={strictMode:!0,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},gui.KeyMaster={generateKey:function(t){t="key";var i=Math.random().toString(),e=(t||"key")+i.slice(2,11);return this._keys[e]?e=this.generateKey(t):this._keys[e]=!0,e},generateGUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=16*Math.random()|0,e="x"===t?i:3&i|8;return e.toString(16)}).toLowerCase()},isKey:function(t){var i=null,e=!1;return gui.Type.isString(t)&&(i=this.extractKey(t),e=i&&i[0]===t),e},extractKey:function(t){return/key\d{9}/.exec(t)},_keys:Object.create(null)},gui.SpiritualAid={polyfill:function(t,i){this._strings(t),this._arrays(t),this._functions(t),this._globals(t),this._extras(t),i||this._effects(t)},_extend:function(t,i){Object.keys(i).forEach(function(e){var n=i[e];void 0===t[e]&&(n.get&&n.set||(t[e]=n))})},_strings:function(t){this._extend(t.String.prototype,{trim:function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")},repeat:function(i){return new t.Array(i+1).join(this)},startsWith:function(t){return 0===this.indexOf(t)},endsWith:function(t){t=String(t);var i=this.lastIndexOf(t);return i>=0&&i===this.length-t.length},contains:function(t){return this.indexOf(t)>-1},toArray:function(){return this.split("")}})},_arrays:function(t){this._extend(t.Array,{every:function(t,i,e){for(var n=!0,r=t.length>>>0,o=0;r>o;o++)if(void 0!==t[o]&&!i.call(e,t[o],o,t)){n=!1;break}return n},forEach:function(t,i,e){for(var n=t.length>>>0,r=0;n>r;r++)void 0!==t[r]&&i.call(e,t[r],r,t)},map:function(t,i,e){for(var n=[],r=t.length>>>0,o=0;r>o;o++)void 0!==t[o]&&n.push(i.call(e,t[o],o,t));return n},filter:function(t,i,e){return Array.prototype.filter.call(t,i,e)},isArray:function(i){return"[object Array]"===t.Object.prototype.toString.call(i)},concat:function(t,i){function e(t){return t}return this.map(t,e).concat(this.map(i,e))}})},_functions:function(t){this._extend(t.Function.prototype,{bind:function(i){if("function"!=typeof this)throw new t.TypeError("Function bind not callable");var e=t.Array.prototype.slice,n=e.call(arguments,1),r=this,o=function(){},u=function(){return r.apply(this instanceof o?this:i||t,n.concat(e.call(arguments)))};return o.prototype=this.prototype,u.prototype=new o,u}})},_globals:function(t){this._extend(t,{console:{log:function(){},debug:function(){},warn:function(){},error:function(){}},Map:function(){function t(){this._map=Object.create(null)}return t.prototype={isNative:!1,get:function(t){return this._map[t]},set:function(t,i){this._map[t]=i},has:function(t){return void 0!==this._map[t]},"delete":function(t){delete this._map[t]},size:function(){return Object.keys(this._map).length}},t}(),Set:function(){function t(){this._map=Object.create(null)}return t.prototype={isNative:!1,add:function(t){this._map[t]=!0},has:function(t){return this._map[t]===!0},"delete":function(t){delete this._map[t]},size:function(){return Object.keys(this._map).length}},t}(),WeakMap:function(){function i(){function t(t){return e(t)&&(a.splice(n,1),c.splice(n,1)),n>-1}function i(t,i){return e(t)?c[n]:i}function e(t){return n=s.call(a,t),n>-1}function r(t,i){e(t)?c[n]=i:c[a.push(t)-1]=i}var a=[],c=[];return u(o,{isNative:{value:!1},"delete":{value:t},del:{value:t},get:{value:i},has:{value:e},set:{value:r}})}function e(){}var n,r=t.Object,o=i.prototype,u=r.create,s=[].indexOf;return i.prototype=e.prototype=o=new i,i}()})},_effects:function(i){this._extend(i,{requestAnimationFrame:function(){var e=i.requestAnimationFrame||i.webkitRequestAnimationFrame||i.mozRequestAnimationFrame||i.oRequestAnimationFrame||i.msRequestAnimationFrame||function(){var i=0;return function(e){var n=(new Date).getTime(),r=Math.max(0,16-(n-i)),o=t.setTimeout(function(){e(n+r)},r);return i=n+r,o}}();return e}(),cancelAnimationFrame:function(){return i.cancelAnimationFrame||i.webkitCancelAnimationFrame||i.mozCancelAnimationFrame||i.oCancelAnimationFrame||i.msCancelAnimationFrame||clearTimeout}(),setImmediate:function(){var t=[],e=1,n="spiritual:emulated:setimmediate";return i.addEventListener("message",function(e){e.data===n&&t.length&&(t.shift().apply(i),e.stopPropagation())},!1),function(r){return t.push(r),i.postMessage(n,"*"),e++}}()})},_extras:function(t){this._extend(t.Map.prototype,{del:function(t){return this["delete"](t)}}),this._extend(t.Set.prototype,{del:function(t){return this["delete"](t)}}),this._extend(t.console,{debug:t.console.log}),this._extend(XMLHttpRequest.prototype,{overrideMimeType:function(){}}),this._extend(t.XMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4})}},function(){function i(t,i){e.push(this),this.$ns=t,i&&Object.keys(i).forEach(function(t){Object.defineProperty(this,t,Object.getOwnPropertyDescriptor(i,t))},this)}var e=[];i.prototype={$ns:null,toString:function(){return"[namespace "+this.$ns+"]"},spacename:function(){return this._spacename(this,this.$ns),this},_spacename:function(t,i){gui.Object.each(t,function(t,e){"$superclass"!==t&&gui.Type.isConstructor(e)&&e.$classname===gui.Class.ANONYMOUS&&(Object.defineProperty(e,"$classname",{value:i+"."+t,enumerable:!0,writable:!1}),this._spacename(e,i+"."+t))},this)}};var n={};Object.keys(gui).forEach(function(t){n[t]=gui[t]}),t.gui=new i("gui",{Namespace:i,$contextid:null,context:null,window:null,document:null,mode:"robot",autostart:!0,hosted:!1,portalled:!1,xhost:null,initialized:!1,spiritualized:!1,attributes:["gui"],unloading:!1,start:function(){return this._oninit(),this._gone=!0,this._then=new gui.Then,this._todochannels&&(this._channelAll(this._todochannels),this._todochannels=null),this._pingpong||(this._spinatkrampe(),this._then.now()),this._then},kickstart:function(){switch(document.readyState){case"interactive":case"complete":gui.Broadcast.dispatchGlobal(gui.BROADCAST_KICKSTART)}},get:function(t){var i,e,n=document;switch(gui.Type.of(t)){case"string":if(gui.KeyMaster.isKey(t)&&(i=this._spirits.inside[t]),!i)try{e=n.querySelector(t)||n.querySelector("#"+t)}catch(r){}finally{i=e?e.spirit:null}break;case"function":var o,u=this._spirits.inside;gui.Type.isSpiritConstructor(t)&&Object.keys(this._spirits.inside).some(function(e){return(o=u[e]).constructor===t?(i=o,!0):void 0});break;default:if(!gui.Type.isElement(t))throw new TypeError("gui.get("+t+")");i=t.spirit||null}return i||null},init:function(t,i){var e=this.initialized;return arguments.length&&(e?t.call(i):(this._oninits=this._oninits||[],this._oninits.push(function(){if(gui.debug)try{t.call(i)}catch(e){throw console.error(t.toString()),e}else t.call(i)}))),e},ready:function(t,i){var e=this.spiritualized;return arguments.length&&(e?t.call(i):(this._onreadys=this._onreadys||[],this._onreadys.push(function(){if(gui.debug)try{t.call(i)}catch(e){throw console.error(t.toString()),e}else t.call(i)}))),e},getAll:function(){console.error("TODO: gui.getAll")},spiritualize:function(t){gui.Guide.$spiritualize(t||document)},spiritualizeSub:function(t){gui.Guide.$spiritualizeSub(t||document)},spiritualizeOne:function(t){gui.Guide.$spiritualizeOne(t||document)},materialize:function(t){gui.Guide.$materialize(t||document)},materializeSub:function(t){gui.Guide.$materializeSub(t||document)},materializeOne:function(t){gui.Guide.$materializeOne(t||document)},suspend:function(t){return gui.Observer.suspend(function(){return gui.Guide.suspend(t)})},module:function(t,i){if(!gui.Type.isString(t))throw new Error("Module requires a name");return i=this._modules[t]=new(gui.Module.extend(t,i))(this.context)},hasModule:function(t){return gui.Type.isDefined(this._modules[t])},getModule:function(){console.error("TODO: gui.getModule(name)")},channel:function(){switch(gui.Type.of(arguments[0])){case"string":this._channelOne.apply(this,arguments);break;case"array":this._channelAll.apply(this,arguments)}},channels:function(){console.error("Deprecated API is deprecated: gui.channels()")},hasChannels:function(){return this._channels&&gui._channels.length},namespaces:function(){return e.map(function(t){return t.$ns})},spacenames:function(){e.forEach(function(t){t.spacename()})},namespace:function(t,i){var e,n=this._spaces;if(!gui.Type.isString(t))throw new TypeError("Expected a namespace string");return e=gui.Object.lookup(t),e||(e=new gui.Namespace(t),e=gui.Object.assert(t,e),n.push(t)),gui.Object.extend(e,i||{})},evaluate:function(t){var i=null;if(t.nodeType===Node.ELEMENT_NODE){var e=t.ownerDocument,n=e.defaultView;n.gui&&n.gui.attributes.every(function(e){return i=this._evaluateinline(t,n,e),null===i},this)&&gui.hasChannels()&&n.gui._channels.every(function(e){var n=e[0],r=e[1];return gui.CSSPlugin.matches(t,n)&&(i=r),null===i},this)}return i},broadcastGlobal:function(t,i){gui.Type.isEvent(i)&&(i=new gui.EventSummary(i)),gui.Broadcast.dispatchGlobal(t,i)},debugchannels:function(){var t=location.toString();this._channels.forEach(function(i){t+="\n"+i[0]+" : "+i[1]}),console.log(t+"\n\n")},destruct:function(t){var i=this._spirits,e=t.$instanceid;delete i.inside[e],delete i.outside[e],this._jensen(t)},inside:function(t){var i=this._spirits,e=t.$instanceid;i.inside[e]||(i.outside[e]&&delete i.outside[e],i.inside[e]=t,i.incoming.push(t),gui.Tick.dispatch(gui.$TICK_INSIDE,4,this.$contextid))},outside:function(t){var i=this._spirits,e=t.$instanceid;i.outside[e]||(i.inside[e]&&(delete i.inside[e],this._jensen(t)),i.outside[e]=t,gui.Tick.dispatch(gui.$TICK_OUTSIDE,0,this.$contextid))},_jensen:function(t){var i=this._spirits.incoming;if(i.length){var e=i.indexOf(t);e>-1&&gui.Array.remove(i,e)}},ontick:function(t){var i;switch(t.type){case gui.$TICK_INSIDE:gui.Guide.$goasync(this._spirits.incoming),this._spirits.incoming=[];break;case gui.$TICK_OUTSIDE:i=gui.Object.each(this._spirits.outside,function(t,i){return i}),i.forEach(function(t){gui.Spirit.$destruct(t)}),i.forEach(function(t){gui.Spirit.$dispose(t)}),this._spirits.outside=Object.create(null)}},$shutdown:function(){this.unloading=!0,gui.hasModule("spirits@wunderbyte.com")&&gui.Guide.$shutdown()},_channels:null,_inlines:null,_spaces:null,_gone:!1,_todochannels:null,_modules:null,_spirits:null,_oninits:null,_onreadys:null,_initializeAllTheThings:function(i){var e=t.chrome;e&&e.app&&e.runtime||t.addEventListener("unload",this,!0),gui.SpiritualAid.polyfill(i),this.context=i,this.window=i.document?i:null,this.hosted=this.window&&this.window!==this.window.parent,this.$contextid=gui.KeyMaster.generateKey(),this._inlines=Object.create(null),this._modules=Object.create(null),this._arrivals=Object.create(null),this._channels=[],this._spaces=["gui"],this._spirits={incoming:[],inside:Object.create(null),outside:Object.create(null)},this.hosted&&(this.xhost="*")},_channelOne:function(t,i){var e;this._gone?(e="string"==typeof i?gui.Object.lookup(i):i,!gui.debug||gui.Type.isSpiritConstructor(e)?this._channels.unshift([t,e]):console.error('Bad spirit for selector "'+t+'": '+e)):(this._todochannels=this._todochannels||[],this._todochannels.push([t,i]))},_channelAll:function(t){this._gone?t.forEach(function(t){this._channelOne(t[0],t[1])},this):(this._todochannels=this._todochannels||[],this._todochannels=this._todochannels.concat(t.reverse()))},handleEvent:function(t){switch(t.type){case"unload":this.$shutdown();break;case"message":var i=this.window.parent;t.source===i&&this._gotponged(t.data)&&this.window.removeEventListener("message",this)}},_gotponged:function(t){var i="spiritual-pong:",e=this.window.location,n=e.origin||e.protocol+"//"+e.host;if("string"==typeof t&&t.startsWith(i)){var r=t.slice(i.length);return r!==n&&(this.xhost=r),this._spinatkrampe(),this._pingpong=!1,this._then&&this._then.now(),!0}return!1},_evaluateinline:function(t,i,e){var n=null,r=t.getAttribute(e);return gui.Type.isString(r)&&!r.startsWith("[")&&(""!==r?(n=i.gui._inlines[r],gui.Type.isDefined(n)||(n=gui.Object.lookup(r,i)),n?i.gui._inlines[r]=n:console.error(r+" is not defined.")):n=!1),n},_index:function(t,i,e){function n(n){switch(n){case"$contextid":case"context":break;default:var o=i[n]=t[n];gui.Type.isSpiritConstructor(o)&&o.portals&&e.forEach(function(t,i){t[1]===o&&r.push(i)})}}var r=[];for(var o in t)this.constructor.prototype.hasOwnProperty(o)||o.startsWith("_")||n(o);return r},$onready:function(){this.spiritualized=!0,this._onready()},_onready:function(){var t=this._onreadys;if(t){for(;t.length;)t.shift()();this._onreadys=null}},_oninit:function(){this.initialized=!0;var t=this._oninits;if(t){for(;t.length;)t.shift()();this._oninits=null}},_spinatkrampe:function(){gui.Tick.add([gui.$TICK_INSIDE,gui.$TICK_OUTSIDE],this,this.$contextid)}}),Object.keys(n).forEach(function(t){gui[t]=n[t]}),t.gui._initializeAllTheThings(t)}(),gui.Object={create:function(t,i){var e={};return Object.keys(i).forEach(function(t){e[t]={value:i[t],writable:!0,enumerable:!0,configurable:!0}}),Object.create(t,e)},extend:function(t,i,e){var n=this._hiding;if(!gui.Type.isObject(i))throw new TypeError("Expected object, got "+gui.Type.of(i));return Object.keys(i).forEach(function(r){if(!e||!gui.Type.isDefined(t[r])){var o=Object.getOwnPropertyDescriptor(i,r);o=n?gui.Object._hide(o):o,Object.defineProperty(t,r,o)}},this),t},extendmissing:function(t,i){return this.extend(t,i,!0)},copy:function(t){try{return this.extend({},t)}catch(i){throw new TypeError("Could not object-copy "+gui.Type.of(t))}},each:function(t,i,e){return Object.keys(t).map(function(n){return i.call(e,n,t[n])}).filter(function(t){return void 0!==t})},all:function(t,i,e){var n=[];for(var r in t)n.push(i.call(e,r,t[r]));return n.filter(function(t){return void 0!==t})},map:function(t,i,e){var n,r={};return this.each(t,function(t,o){n=i.call(e,t,o),void 0!==n&&(r[t]=n)}),r},lookup:function(t,i){var e,n=i||self;if(!gui.Type.isString(t))throw new TypeError("Expected string, got "+gui.Type.of(t));if(t.contains(".")){var r=t.split(".");r.every(function(t){return n=n[t],gui.Type.isDefined(n)}),e=n}else e=n[t];return e},assert:function(t,i,e){var n,r=e||self;if(t.contains(".")){var o=t.split(".");n=o.pop(),o.forEach(function(t){r=r[t]||(r[t]={})})}else n=t;return r&&(r[n]=i),i},methods:function(t){var i,e,n,r=t,o=[];for(i in t){for(;!(n=Object.getOwnPropertyDescriptor(r,i));)r=Object.getPrototypeOf(r);"function"==typeof n.value&&(e=t[i],gui.Type.isMethod(e)&&o.push(i))}return o},ownmethods:function(t){return Object.keys(t).filter(function(i){return gui.Type.isMethod(t[i])}).map(function(t){return t})},nonmethods:function(t){var i=[];for(var e in t)gui.Type.isFunction(t[e])||i.push(e);return i},bindall:function(t){var i=Array.prototype.slice.call(arguments).slice(1);return i.length||(i=gui.Object.ownmethods(t).filter(function(t){return"_"!==t[0]})),i.forEach(function(i){t[i]=t[i].bind(t)}),t},hidden:function(t){return gui.Object._hiding=!0,t.$hidden=!0,t},_hiding:!1,_hide:function(t){return t.value&&gui.Type.isFunction(t.value)&&t.value.$hidden&&t.configurable&&(t.enumerable=!1),t}},gui.Type={of:function(t){var i={}.toString.call(t).match(this._typeexp)[1].toLowerCase();return"domwindow"===i&&"undefined"===String(typeof t)&&(i="undefined"),i},isDefined:function(t){return"undefined"!==this.of(t)},isComplex:function(t){switch(this.of(t)){case"undefined":case"boolean":case"number":case"string":case"null":return!1}return!0},isWindow:function(t){return t&&t.document&&t.location&&t.alert&&t.setInterval},isEvent:function(t){return this.of(t).endsWith("event")&&this.isDefined(t.type)},isElement:function(t){return this.of(t).endsWith("element")&&t.nodeType===Node.ELEMENT_NODE},isMethod:function(t){return t&&this.isFunction(t)&&!this.isConstructor(t)&&!String(t).contains("[native code]")},isSpirit:function(t){return t&&t instanceof gui.Spirit},isConstructor:function(t){return this.isFunction(t)&&this.isObject(t.prototype)&&Object.keys(t.prototype).length},isGuiClass:function(t){return this.isConstructor(t)&&t.$classname},isSpiritConstructor:function(t){return this.isFunction(t)&&this.isFunction(t.summon)},isArrayLike:function(t){return"0"in t&&!this.isArray(t)},cast:function(t){var i=String(t);switch(i){case"null":i=null;break;case"true":case"false":i="true"===i;break;default:String(parseInt(i,10))===i?i=parseInt(i,10):String(parseFloat(i))===i&&(i=parseFloat(i))}return i},_typeexp:/\s([a-zA-Z]+)/},function(){["array","function","object","string","number","boolean","null","arguments","file"].forEach(function(t){this["is"+t[0].toUpperCase()+t.slice(1)]=function(i){return this.of(i)===t}},this)}.call(gui.Type),gui.Object.bindall(gui.Type),gui.Array={of:function(){return Array.of||function(){return Array.prototype.slice.call(arguments)}}(),from:function(){return Array.from||function(t){for(var i=[],e=Object(t),n=e.length>>>0,r=0;n>r;)r in e&&(i[r]=e[r]),r++;return i}}(),make:function(t){switch(gui.Type.of(t)){case"string":return t.split(" ");case"array":return this.from(t);default:return gui.Type.isArrayLike(t)?this.from(t):[t]}},remove:function(t,i,e){return isNaN(i)?this.remove(t,t.indexOf(i),t.indexOf(e)):(t.splice(i,!e||1+e-i+(!(0>e^i>=0)&&(0>e||-1)*t.length)),t.length)}},gui.Arguments={provided:function(){var t=gui.Array.from(arguments);return function(i){return function(){return gui.Arguments._match(arguments,t)?i.apply(this,arguments):void 0}}},confirmed:function(){var t=gui.Array.from(arguments);return function(i){return function(){return gui.Arguments._validate(arguments,t)?i.apply(this,arguments):void gui.Arguments._abort(this)}}},_validating:!1,_bugsummary:null,_match:function(t,i){return i.every(function(i,e){return this._matches(i,t[e],e)},this)},_validate:function(t,i){this._validating=!0;var e=this._match(t,i);return this._validating=!1,e},_xtract:function(t,i){return i?t.slice(1,-1):t},_matches:function(t,i,e){var n=!t.startsWith("("),r=this._xtract(t,!n).split("|"),o=gui.Type.of(i),u="*"===t||"node"===t&&i&&i.nodeType||"element"===t&&i&&i.nodeType===Node.ELEMENT_NODE||"spirit"===t&&i&&i.$instanceid&&i.element||!n&&"undefined"===o||!n&&r.indexOf("*")>-1||r.indexOf(o)>-1;return!u&&this._validating&&("string"===o&&(i='"'+i+'"'),this._bugsummary=[e,t,o,i]),u},_abort:function(t){var i=this._bugsummary,e=t.constructor.$classname||String(t);console.error(["Bad argument "+i.shift(),"for "+e+":","Expected "+i.shift()+",","got "+i.shift()+":",i.shift()].join(" "))}},gui.Function={create:function(t,i,e,n){var r=n?n.Function:Function;return t=this.safename(t),i=i?i.join(","):"",e=e||"",new r("return function "+t+" ( "+i+" ) {"+e+"}")()},decorateBefore:gui.Arguments.confirmed("object|function","string","function")(function(t,i,e){return this._decorate("before",t,i,e)}),decorateAfter:gui.Arguments.confirmed("object|function","string","function")(function(t,i,e){return this._decorate("after",t,i,e)}),decorateAround:function(){throw new Error("TODO")},safename:function(t){return t&&t.contains(".")&&(t=t.split(".").pop()),t||""},_decorate:function(t,i,e,n){return i[e]=gui.Combo[t](n)(i[e]),i}},gui.NamespaceXXX=function(t,i){gui.NamespaceXXX._spaces.push(this),this.$context=i,this.$ns=t},gui.NamespaceXXX.prototype={portals:!1,toString:function(){return"[namespace "+this.$ns+"]"},spacename:function(){return this._spacename(this,this.$ns),this},_spacename:function(t,i){gui.Object.each(t,function(t,e){"$superclass"!==t&&gui.Type.isConstructor(e)&&e.$classname===gui.Class.ANONYMOUS&&(Object.defineProperty(e,"$classname",{value:i+"."+t,enumerable:!0,writable:!1}),this._spacename(e,i+"."+t))},this)},$ns:null,$context:null},gui.NamespaceXXX._spaces=[],gui.NamespaceXXX.spacenames=function(){this._spaces.forEach(function(t){t.spacename()})},gui.Class={create:function(){var t=this._breakdown_base(arguments),i=this._createclass(null,t.proto,t.name);return gui.Object.extend(i.prototype,t.protos),gui.Object.extend(i,t.statics),gui.Property.extendall(t.protos,i.prototype),t.recurring&&gui.Object.each(t.recurring,function(t,e){var n=Object.getOwnPropertyDescriptor(i,t);(!n||n.writable)&&(i[t]=i.$recurring[t]=e)}),i},breakdown:function(t){return this._breakdown_subs(t)},$constructor:function(){var i=this.$onconstruct||this.onconstruct,e=gui.Property.nonenumerable,n=this;return t.Object.defineProperties(this,{$instanceid:e({value:gui.KeyMaster.generateKey()}),displayName:e({value:this.constructor.displayName,writable:!0})}),gui.Type.isFunction(i)&&(n=i.apply(this,arguments)),n||this},_classes:Object.create(null),ANONYMOUS:"Anonymous",_BODY:function(t){var i=t.toString().trim();return i.slice(i.indexOf("{")+1,-1)}(function i(){return this instanceof i?gui.Class.$constructor.apply(this,arguments):i.extend.apply(i,arguments)}),_breakdown_base:function(t){var i=gui.Type.isString(t[0]);return{name:i?t[0]:null,proto:t[i?1:0]||Object.create(null),protos:t[i?2:1]||Object.create(null),recurring:t[i?3:2]||Object.create(null),statics:t[i?4:3]||Object.create(null)}},_breakdown_subs:function(t){var i=gui.Type.isString(t[0]);return{name:i?t[0]:null,protos:t[i?1:0]||Object.create(null),recurring:t[i?2:1]||Object.create(null),statics:t[i?3:2]||Object.create(null)}},_createclass:function(t,i,e){e=e||gui.Class.ANONYMOUS;var n=function r(){return this instanceof r?gui.Class.$constructor.apply(this,arguments):r.extend.apply(r,arguments)};return n.$classid=gui.KeyMaster.generateKey("class"),n.prototype=Object.create(i||null),n.prototype.constructor=n,n=this._internals(n,t),n=this._interface(n),n=this._classname(n,e)},_createsubclass:function(t,i){return i=this.breakdown(i),t.$super=t.$super||new gui.Super(t),this._extend_fister(t,i.protos,i.recurring,i.statics,i.name)},_extend_fister:function(t,i,e,n,r){var o=this._createclass(t,t.prototype,r);return gui.Object.extend(o,n),gui.Object.extend(o.$recurring,e),gui.Object.each(o.$recurring,function(t,i){var e=Object.getOwnPropertyDescriptor(o,t);(!e||e.writable)&&(o[t]=i)}),gui.Property.extendall(i,o.prototype),gui.Super.support(t,o,i),o=this._classname(o,r)},_internals:function(t,i){return t.$super=null,t.$subclasses=[],t.$superclass=i||null,t.$recurring=i?gui.Object.copy(i.$recurring):Object.create(null),i&&i.$subclasses.push(t),t},_interface:function(t){return["extend","mixin","is"].forEach(function(i){t[i]=this[i]},this),t},_classname:function(t,i){return t.$classname=i||gui.Class.ANONYMOUS,Object.defineProperty(t.prototype,"$classname",{enumerable:!1,configurable:!0,get:function(){return this.constructor.$classname}}),t.toString=function(){return"[function "+this.$classname+"]"},t.prototype.toString=function(){return"[object "+this.constructor.$classname+"]"},t},_namedbody:function(t){return this._BODY.replace(new RegExp("\\$name","gm"),gui.Function.safename(t))}},gui.Object.extend(gui.Class,{extend:function(){return gui.Class._createsubclass(this,arguments)},mixin:function(){return Array.forEach(arguments,function(t,i){t&&gui.Object.each(t,function(t,e){0===i?(this.prototype[t]=e,gui.Class.descendantsAndSelf(this,function(i){i.$super&&gui.Super.generateStub(i.$super,i.prototype,t)})):gui.Class.descendantsAndSelf(this,function(i){i.$recurring[t]=e,i[t]=e})},this)},this),this},is:function(t){return gui.Type.isObject(t)&&t instanceof this},isInstance:function(){console.error("Deprecated API is derecated")}}),gui.Object.extend(gui.Class,{children:function(t,i,e){var n=[];return i=i||gui.Combo.identity,t.$subclasses.forEach(function(t){n.push(i.call(e,t))},e),n},descendants:function(t,i,e,n){return n=n||[],i=i||gui.Combo.identity,t.$subclasses.forEach(function(t){n.push(i.call(e,t)),gui.Class.descendants(t,i,e,n)},e),n},descendantsAndSelf:function(t,i,e){var n=[];return i=i||gui.Combo.identity,n.push(i.call(e,t)),this.descendants(t,i,e,n)},parent:function(t,i,e){return t&&t.$superclass?(i=i||gui.Combo.identity,i.call(e,t.$superclass)):null},ancestors:function(t,i,e,n){return n=n||[],i=i||gui.Combo.identity,t.$superclass&&(n.push(i.call(e,t.$superclass)),gui.Class.ancestors(t.$superclass,i,e,n)),n},ancestorsAndSelf:function(t,i,e){var n=[];return i=i||gui.Combo.identity,n.push(i.call(e,t)),this.ancestors(t,i,e,n)},family:function(t,i,e){var n=this.ancestorsAndSelf(t).concat(this.descendants(t));return i&&(n=n.map(function(t){return i.call(e,t)})),n}}),gui.Property={extendall:function(t,i){return Object.keys(t).forEach(function(e){this.extend(t,i,e)},this),i},extend:function(t,i,e){var n=Object.getOwnPropertyDescriptor(t,e);return n=this._accessor(i,e,n),Object.defineProperty(i,e,n),i},nonenumerable:function(t){return gui.Object.extendmissing({configurable:!0,enumerable:!1},t)},accessor:function(t,i,e){if(this._isaccessor(e))return Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:e.getter||this._NOGETTER,set:e.setter||this._NOSETTER});throw new TypeError("Expected getter and/or setter method")},_isaccessor:function(t){return Object.keys(t).every(function(i){var e=!1;switch(i){case"getter":case"setter":e=gui.Type.isFunction(t[i])}return e})},_accessor:function(t,i,e){var n=e.value;return gui.Type.isObject(n)&&(n.getter||n.setter)&&this._isactive(n)&&(e=this._activeaccessor(t,i,n)),e},_isactive:function(t){return Object.keys(t).every(function(i){var e=!1;switch(i){case"getter":case"setter":e=gui.Type.isFunction(t[i])}return e})},_activeaccessor:function(t,i,e){var n;return["getter","setter"].forEach(function(r,o){for(;t&&t[i]&&!gui.Type.isDefined(e[r]);)t=Object.getPrototypeOf(t),n=Object.getOwnPropertyDescriptor(t,i),n&&(e[r]=n[o?"set":"get"])}),{enumerable:!0,configurable:!0,get:e.getter||this._NOGETTER,set:e.setter||this._NOSETTER}},_NOGETTER:function(){throw new Error("Getting a property that has only a setter")},_NOSETTER:function(){throw new Error("Setting a property that has only a getter")}},gui.Object.bindall(gui.Property),gui.Interface={validate:function(t,i){var e=!0,n=t.toString(),r=gui.Type.of(i);switch(r){case"null":case"string":case"number":case"boolean":case"undefined":throw new Error("Expected "+n+", got "+r+": "+i);default:try{var o=null,u=null;if(e=Object.keys(t).every(function(e){return o=e,u=gui.Type.of(t[e]),gui.Type.of(i[e])===u}),!e)throw new Error("Expected "+n+". A required "+r+' "'+o+'" is missing')}catch(s){throw new Error("Expected "+n)}}return e}},gui.Combo={before:function(t){return function(i){return function(){return t.apply(this,arguments),i.apply(this,arguments)}}},after:function(t){return function(i){return function(){var e=i.apply(this,arguments);return t.apply(this,arguments),e}}},around:function(t){var i=[].slice;return function(e){return function(){var n,r,o,u=this;
return n=1<=arguments.length?i.call(arguments,0):[],o=void 0,r=function(){return o=e.apply(u,n)},t.apply(this,[r].concat(n)),o}}},provided:function(t){return function(i,e){return function(){return t.apply(this,arguments)?i.apply(this,arguments):e?e.apply(this,arguments):void 0}}},chained:function(t){return function(){var i=t.apply(this,arguments);return void 0===i?this:i}},identity:function(t){return t}},gui.Super=function(t){gui.Super.generateStubs(this,t.prototype)},gui.Super.prototype=Object.create(null),gui.Object.extend(gui.Super,{$subject:null,toString:function(){return"[function gui.Super]"},generateStubs:function(t,i){gui.Object.methods(i).forEach(function(e){gui.Super.generateStub(t,i,e)},this)},generateStub:function(t,i,e){var n=t[e]=function(){return i[e].apply(gui.Super.$subject,arguments)};n.displayName=e},support:function(t,i,e){var n=i.prototype,r=this._decorator(t);gui.Object.each(e,function(t,i){gui.Type.isMethod(i)&&"$of"!==t&&(n[t]=r(i),gui.debug&&(n[t].toString=function(){var t=i.toString().replace(/\t/g,"  ");return gui.Super._DISCLAIMER+t}))},this)},_DISCLAIMER:"/**\n  * Method was mutated by the framework. \n  * This is an approximation of the code. \n  */\n",_ERROR:"Lost 'this' in call to 'this._super'.",_decorator:function(t){return function(i){return function(){return gui.Super._supercall(this,i,arguments,t)}}},_supercall:function(t,i,e,n){var r,o=gui.Super.$subject;if(!t)throw new ReferenceError(gui.Super._ERROR);return gui.Super.$subject=t,t._super=n.$super,r=i.apply(t,e),gui.Super.$subject=o,r}}),gui.Position=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0},gui.Position.prototype={x:0,y:0,z:0,toString:function(){return"[object gui.Position]"},clone:function(){return new gui.Position(this.x,this.y,this.z)}},gui.Position.isEqual=function(t,i){return t.x===i.x&&t.y===i.y},gui.Dimension=function(t,i){this.w=t||0,this.h=i||0},gui.Dimension.prototype={w:0,h:0,toString:function(){return"[object gui.Dimension]"}},gui.Dimension.isEqual=function(t,i){return t.w===i.w&&t.h===i.h},gui.Geometry=function(t,i,e,n){this.x=t||0,this.y=i||0,this.w=e||0,this.h=n||0},gui.Geometry.prototype={x:0,y:0,w:0,h:0,toString:function(){return"[object gui.Geometry]"},hitTest:function(t){return gui.Geometry.hitTest(this,t)}},gui.Geometry.isEqual=function(t,i){return t.x===i.x&&t.y===i.y&&t.w===i.w&&t.h===i.h},gui.Geometry.hitTest=function(t,i){function e(t,i){return t.x>=i.x&&t.x<=i.x+i.w}function n(t,i){return t.y>=i.y&&t.y<=i.y+i.h}var r=e(t,i)||e(i,t),o=n(t,i)||n(i,t);return r&&o},gui.Then=function(t,i){t&&this.then(t,i)},gui.Then.prototype={toString:function(){return"[object gui.Then]"},then:function(t,i){this._callback=t?t:null,this._pointer=i?i:null,this._now&&this.now()},now:function(){var t=this._callback,i=this._pointer;t?(this.then(null,null),t.apply(i,arguments)):this._now=!0},_callback:null,_pointer:null,_now:!1},gui.HTMLParser={toString:function(){return"[object gui.HTMLParser]"},parse:function(t,i){return this.parseAll(t,i)[0]||null},parseAll:function(t,i){return this.parseToNodes(t,i).filter(function(t){return t.nodeType===Node.ELEMENT_NODE})},parseToNode:function(t,i){return this.parseToNodes(t,i)[0]||null},parseToNodes:function(t,i){var e,n=this._document||(this._document=document.implementation.createHTMLDocument(""));return gui.Guide.suspend(function(){return n.body.innerHTML=this._insaneitize(t),e=n.querySelector("."+this._classname)||n.body,Array.map(e.childNodes,function(t){return(i||document).importNode(t,!0)})},this)},parseToDocument:function(t){return t=t||"",gui.Guide.suspend(function(){var i=document.implementation.createHTMLDocument("");if(t.toLowerCase().contains("<!doctype"))try{i.documentElement.innerHTML=t}catch(e){i=new ActiveXObject("htmlfile"),i.open(),i.write(t),i.close()}else i.body.innerHTML=t;return i})},_classname:"_gui-htmlparser",_comments:/<!--[\s\S]*?-->/g,_firsttag:/^<([a-z]+)/i,_document:null,_insaneitize:function(t){var i,e;return t=t.trim().replace(this._comments,""),(i=t.match(this._firsttag))&&(e=this._fixes[i[1]])&&(t=e.replace("${class}",this._classname).replace("${markup}",t)),t},_fixes:function(){var t={td:'<table><tbody><tr class="${class}">${markup}</tr></tbody></table>',tr:'<table><tbody class="${class}">${markup}</tbody></table>',tbody:'<table class="${class}">${markup}</table>',col:'<table><colgroup class="${class}">${markup}</colgroup></table>',option:'<select class="${class}"><option>a</option>${markup}</select>'};return t.th=t.td,["thead","tfoot","caption","colgroup"].forEach(function(i){t[i]=t.tbody}),t}()},gui.FileLoader=gui.Class.create(Object.prototype,{onconstruct:function(t){this._cache=gui.FileLoader._cache,this._document=t},load:function(t,i,e){var n=new gui.URL(this._document,t);this._cache.has(n.location)?this._cached(n,i,e):this._request(n,i,e)},onload:function(t,i,e,n){e.call(n,t)},_cache:null,_document:null,_request:function(t,i,e){this._cache.set(t.location,null),new gui.Request(t.href).acceptText().get().then(function(n,r){this.onload(r,t,i,e),this._cache.set(t.location,r),gui.FileLoader.unqueue(t.location)},this)},_cached:function(t,i,e){var n=this._cache.get(t.location);if(null!==n)this.onload(n,t,i,e);else{var r=this;gui.FileLoader.queue(t.location,function(n){r.onload(n,t,i,e)})}},$onconstruct:function(t){if(!t||t.nodeType!==Node.DOCUMENT_NODE)throw new TypeError("Document expected");this.onconstruct(t)}},{},{_cache:new Map,_queue:new Map,queue:function(t,i){this._queue[t]=this._queue[t]||[],this._queue[t].push(i)},unqueue:function(t){var i=this._cache.get(t);if(this._queue[t])for(;this._queue[t][0];)this._queue[t].shift()(i)}}),gui.BlobLoader={toString:function(){return"[object gui.BlobLoader]"},base64toBlob:function(t,i,e){i=i||"",e=e||512;for(var n=atob(t),r=[],o=0;o<n.length;o+=e){for(var u=n.slice(o,o+e),s=new Array(u.length),a=0;a<u.length;a++)s[a]=u.charCodeAt(a);var c=new Uint8Array(s);r.push(c)}return new Blob(r,{type:i})},stringToBlob:function(t,i){return new Blob([t],{type:i})},loadScript:function(t,i){var e=new gui.Then,n=this.stringToBlob(i,"text/javascript"),r=t.createElement("script");r.src=this._URL.createObjectURL(n);var o=t.querySelector("head");return gui.Observer.suspend(function(){o.appendChild(r)}),r.onload=function(){e.now()},e},_URL:t.URL||t.webkitURL},gui.EventSummary=function(t){this._construct(t)},gui.EventSummary.prototype={event:null,window:null,document:null,documentspirit:null,toString:function(){return"[object gui.EventSummary]"},_construct:function(t){var i=null,e=null,n=t.target,r=n.nodeType;gui.Type.isDefined(r)?(e=r===Node.DOCUMENT_NODE?n:n.ownerDocument,i=e.defaultView):(i=n,e=i.document),this.event=t,this.window=i,this.document=e,this.documentspirit=e.documentElement.spirit}},gui.Crawler=gui.Class.create(Object.prototype,{type:null,direction:null,global:!1,toString:function(){return"[object gui.Crawler]"},onconstruct:function(t){this.type=t||null},ascend:function(t,i){this.direction=gui.Crawler.ASCENDING;var e,n=t instanceof gui.Spirit?t.element:t;do if(n.nodeType===Node.DOCUMENT_NODE&&(this.global?(e=n.defaultView,e.gui.hosted?e.gui.xhost?(n=null,gui.Type.isFunction(i.transcend)&&i.transcend(e.parent,e.gui.xhost,e.gui.$contextid)):n=e.frameElement:n=null):n=null),n){var r=this._handleElement(n,i);switch(r){case gui.Crawler.STOP:n=null;break;default:n=n.parentNode}}while(n)},ascendGlobal:function(t,i){this.global=!0,this.ascend(t,i),this.global=!1},descend:function(t,i,e){this.direction=gui.Crawler.DESCENDING;var n=t instanceof gui.Spirit?t.element:t;n.nodeType===Node.DOCUMENT_NODE&&(n=n.documentElement),this._descend(n,i,e,!0)},descendGlobal:function(t,i,e){this.global=!0,this.descend(t,i,e),this.global=!1},_descend:function(t,i,e,n){var r,o,u=this._handleElement(t,i,e);switch(u){case gui.Crawler.CONTINUE:case gui.Crawler.SKIP_CHILDREN:if(u!==gui.Crawler.SKIP_CHILDREN&&(t.childElementCount?this._descend(t.firstElementChild,i,e,!1):this.global&&"iframe"===t.localName&&(o=t.spirit)&&o instanceof gui.IframeSpirit&&(r=t.ownerDocument.defaultView,gui.Type.isFunction(i.transcend)&&i.transcend(o.contentWindow,o.xguest,o.$instanceid))),!n){var s=t.nextElementSibling;null!==s&&this._descend(s,i,e,!1)}}},_handleElement:function(t,i,e){var n=gui.Crawler.CONTINUE,r=t.spirit;return r&&(n=r.oncrawler(this)),n||i&&(gui.Type.isFunction(i.handleElement)&&(n=i.handleElement(t,e)),n!==gui.Crawler.STOP&&r&&gui.Type.isFunction(i.handleSpirit)&&(n=this._handleSpirit(r,i))),n||(n=gui.Crawler.CONTINUE),n},_handleSpirit:function(t,i){return i.handleSpirit(t)}},{},{ASCENDING:"ascending",DESCENDING:"descending",CONTINUE:0,STOP:1,SKIP:2,SKIP_CHILDREN:4}),gui.Request=function(t,i){this._headers={Accept:"application/json"},t&&this.url(t,i)},gui.Request.prototype=function(i){return{url:i(function(t,i){this._url=i?new gui.URL(i,t).href:t}),sync:i(function(){this._async=!1}),async:i(function(){this._async=!0}),accept:i(function(t){this._headers.Accept=t}),acceptJSON:i(function(){this.accept("application/json")}),acceptXML:i(function(){this.accept("text/xml")}),acceptText:i(function(){this.accept("text/plain")}),format:i(function(t){this._format=t}),override:i(function(t){this._override=t||!0}),headers:i(function(t){if(!gui.Type.isObject(t))throw new TypeError("Object expected");gui.Object.each(t,function(t,i){this._headers[t]=String(i)},this)}),_async:!0,_url:null,_format:"application/json",_override:!1,_headers:null,_request:function(i,e,n){var r=this,o=new XMLHttpRequest,u=gui.URL.external(this._url,document);u&&t.XDomainRequest&&(o=new t.XDomainRequest),o.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE){var t=r._response(this.responseText);n(this.status,t,this.responseText)}},this._override&&o.overrideMimeType(this._headers.Accept),o.open(i.toUpperCase(),this._url,!0),u||gui.Object.each(this._headers,function(t,i){o.setRequestHeader(t,i,!1)}),o.send(e)},_response:function(t){var i=t;try{switch(this._headers.Accept){case"application/json":i=JSON.parse(t);break;case"text/xml":i=(new DOMParser).parseFromString(t,"text/xml")}}catch(e){gui.debug&&console.error(this._headers.Accept+" dysfunction at "+this._url)}return i}}}(gui.Combo.chained),["get","post","put","delete"].forEach(function(t){gui.Request.prototype[t]=function(i){if(gui.Type.isFunction(i))throw new Error("Deprecated: gui.Request returns a gui.Then");var e=new gui.Then;return i="get"===t?null:i,this._request(t,i,function(t,i,n){e.now(t,i,n)}),e}}),gui.Plugin=gui.Class.create(Object.prototype,{spirit:null,context:null,onconstruct:function(){},ondestruct:function(){},handleEvent:function(t){gui.Type.isFunction(this.onevent)&&this.onevent(t)},$destructed:!1,$onconstruct:function(t){this.spirit=t||null,this.context=t?t.window:null,this.onconstruct()},$ondestruct:function(){}},{lazy:!0,infuse:function(){throw new Error('Plugins must use the "extend" method and not "infuse".')}},{$prepare:function(t,i,e){Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:function(){var n=new e(this);return this.life.plugins[i]=!0,gui.Plugin.$assign(t,i,n),n}})},$assign:function(t,i,e){Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:function(){return e},set:function(){throw new Error('The property name "'+i+'" is reserved for the '+e.$classname+" and cannot be redefined.")}})}}),gui.Action=function(t,i){return gui.hosted&&addEventListener("message",function(t){t.source===parent&&gui.Action.$maybeDescendGlobal(t.data)}),gui.Class.create(Object.prototype,{target:null,type:null,data:null,direction:null,global:!1,isConsumed:!1,isCancelled:!1,consumer:null,instanceid:null,onconstruct:function(t){gui.Object.extend(this,t)},consume:function(t){this.isConsumed=!0,this.consumer=t},cancel:function(t){this.isCancelled=!0,this.consume(t)}},{},{DESCEND:"descend",ASCEND:"ascend",IActionHandler:{onaction:function(){},toString:function(){return"[interface ActionHandler]"}},add:t("node","array|string","object|function")(i(function(t,i,e){this._listen(!0,t,i,e,!1)})),remove:t("node","array|string","object|function")(i(function(t,i,e){this._listen(!1,t,i,e,!1)})),addGlobal:t("node","array|string","object|function")(i(function(t,i,e){this._listen(!0,t,i,e,!0)})),removeGlobal:t("node","array|string","object|function")(i(function(t,i,e){this._listen(!1,t,i,e,!0)})),dispatch:function(t,i,e){return this.ascend(t,i,e)},ascend:function(t,i,e){return this._dispatch(t,i,e,gui.Action.ASCEND,!1)},descend:function(t,i,e){return this._dispatch(t,i,e,gui.Action.DESCEND,!1)},dispatchGlobal:function(t,i,e){return this.ascendGlobal(t,i,e)},ascendGlobal:function(t,i,e){return this._dispatch(t,i,e,gui.Action.ASCEND,!0)},descendGlobal:function(t,i,e){return this._dispatch(t,i,e,gui.Action.DESCEND,!0)},stringify:function(t,i){var e="spiritual-action:";return e+function(){return t.target=null,t.data=function(t){if(gui.Type.isComplex(t))if(gui.Type.isFunction(t.stringify))t=t.stringify();else try{JSON.stringify(t)}catch(i){t=null}return t}(t.data),t.instanceid=i||null,JSON.stringify(t)}()},parse:function(t){var i="spiritual-action:";return t.startsWith(i)?new gui.Action(JSON.parse(t.split(i)[1])):null},$maybeDescendGlobal:function(t){var i,e,n,r=t;gui.Type.isString(r)&&r.startsWith("spiritual-action:")&&(i=gui.Action.parse(r),i.direction===gui.Action.DESCEND&&((n=this._globals[i.type])&&n.slice().forEach(function(t){t.onaction(i)}),(e=gui.get("html"))&&(e.action.$handleownaction=!0,e.action.descendGlobal(i.type,i.data))))},_globals:{},_locals:{},_listen:function(t,i,e,n,r){if(i.nodeType!==Node.DOCUMENT_NODE)throw new TypeError("Document node expected");var o=r?this._globals:this._locals,u=o[e],s=gui.Action.IActionHandler;gui.Interface.validate(s,n)&&gui.Array.make(e).forEach(function(){t?(u||(u=o[e]=[]),-1===u.indexOf(n)&&u.push(n)):u&&0===gui.Array.remove(u,n)&&delete o[e]})},_dispatch:function(t,i,e,n,r){var o=new gui.Action({target:t,type:i,data:e,direction:n||gui.Action.ASCEND,global:r||!1}),u=new gui.Crawler(gui.CRAWLER_ACTION);return u.global=o.global||!1,u[o.direction](t,{handleSpirit:function(t){var e=gui.Crawler.CONTINUE;return t.action.contains(i)&&(t.action.$onaction(o),o.isConsumed&&(e=gui.Crawler.STOP,o.consumer=t)),e},transcend:function(t,i,e){var n=gui.Action.stringify(o,e);t.postMessage(n,"*")}}),o}})}(gui.Arguments.confirmed,gui.Combo.chained),gui.Broadcast=function(i,e){return t.addEventListener("message",function(t){gui.Type.isString(t.data)&&t.data.startsWith("spiritual-broadcast:")&&gui.Broadcast.$maybeBroadcastGlobal(t.data)}),gui.Class.create(Object.prototype,{target:null,type:null,data:null,global:!1,$contextid:null,$contextids:null,$onconstruct:function(t){gui.Object.extend(this,t),this.$contextids=this.$contextids||[]}},{},{IBroadcastHandler:{onbroadcast:function(){},toString:function(){return"[interface BroadcastHandler]"}},$target:null,_globals:Object.create(null),_locals:Object.create(null),add:e(function(t,i,e){this._add(t,i,e||gui.$contextid)}),remove:e(function(t,i,e){this._remove(t,i,e||gui.$contextid)}),addGlobal:e(function(t,i){this._add(t,i)}),removeGlobal:e(function(t,i){this._remove(t,i)}),dispatch:function(t,i){return gui.Type.isString(t)?this._dispatch({type:t,data:i,global:!1}):(console.error('The "target" argument (the first argument) of gui.Broadcast.dispatch is deprecated'),void this.dispatch(arguments[1],arguments[2]))},dispatchGlobal:function(t,i){return gui.Type.isString(t)?this._dispatch({type:t,data:i,global:!0,$contextid:gui.$contextid}):(console.error('The "target" argument (the first argument) of gui.Broadcast.dispatchGlobal is deprecated'),this.dispatchGlobal(arguments[1],arguments[2]))},stringify:function(t){var i="spiritual-broadcast:";return i+function(){return t.target=null,t.data=function(t){if(gui.Type.isComplex(t))if(gui.Type.isFunction(t.stringify))t=t.stringify();else try{JSON.stringify(t)}catch(i){t=null}return t}(t.data),JSON.stringify(t)}()},parse:function(t){var i="spiritual-broadcast:";return t.startsWith(i)?JSON.parse(t.split(i)[1]):void 0},$maybeBroadcastGlobal:function(t){var i=gui.Broadcast.parse(t);-1===i.$contextids.indexOf(gui.$contextid)&&gui.Broadcast._dispatch(i)},_add:i("array|string","object|function","(string)")(function(t,i,e){gui.Broadcast.IBroadcastHandler;if(gui.Type.isArray(t))t.forEach(function(t){this._add(t,i,e)},this);else{var n;e?(n=this._locals[e],n||(n=this._locals[e]=Object.create(null))):n=this._globals,n[t]||(n[t]=[]);var r=n[t];-1===r.indexOf(i)&&r.push(i)}}),_remove:function(t,i,e){gui.Broadcast.IBroadcastHandler;if(gui.Type.isArray(t))t.forEach(function(t){this._remove(t,i,e)},this);else{var n,r=function(i,n){return e?i[e]?i[e][t]:void 0:n[t]}(this._locals,this._globals);r&&(n=r.indexOf(i),n>-1&&gui.Array.remove(r,n))}},_dispatch:function(t){var i=t.global?this._globals:this._locals[gui.$contextid];if(gui.hasModule("spirits@wunderbyte.com")&&(gui.spiritualized||t.type!==gui.BROADCAST_WILL_SPIRITUALIZE),this.$target&&(t.global||(t.target=this.$target),this.$target=null),t instanceof gui.Broadcast==!1&&(t=new gui.Broadcast(t)),i){var e=i[t.type];e&&e.slice().forEach(function(i){i.onbroadcast(t)})}return t.global&&this._propagate(t),t},_propagate:function(t){var i=function(){return t.$contextids.push(gui.$contextid),gui.Broadcast.stringify(t)}();this._propagateDown(i),this._propagateUp(i,t.type)},_propagateDown:function(t){var i=document.querySelectorAll("iframe");Array.forEach(i,function(i){i.contentWindow.postMessage(t,"*")})},_propagateUp:function(i){t!==top&&parent.postMessage(i,"*")}})}(gui.Arguments.confirmed,gui.Combo.chained),function(i){gui.Tick=function(t){this.type=t},gui.Tick.prototype={type:null,toString:function(){return"[object gui.Tick]"}},gui.Object.extend(gui.Tick,{toString:function(){return"[function gui.Tick]"},add:i("string|array","object|function","(string)")(function(t,i,e){return this._add(t,i,!1,e||gui.$contextid)}),remove:i("string|array","object|function","(string)")(function(t,i,e){return this._remove(t,i,e||gui.$contextid)}),one:i("string|array","object|function","(string)")(function(t,i,e){return this._add(t,i,!0,e||gui.$contextid)}),next:function(t,i){setImmediate(function(){t.call(i)})},nextFrame:function(t,i){return requestAnimationFrame(function(e){t.call(i,e)})},cancelFrame:function(i){t.cancelAnimationFrame(i)},time:i("function","(number)","(function|object)")(function(t,i,e){return setTimeout(function(){t.call(e)},i)}),cancelTime:function(t){clearTimeout(t)},start:i("string","(number)")(function(t,i){var e=this._intervals;if(!e[t]){var n=new gui.Tick(t);e[t]=setInterval(function(){this._doit(n)}.bind(this),i||0)}}),stop:i("string")(function(t){var i=this._intervals,e=i[t];e&&(clearInterval(e),delete i[t])}),dispatch:function(t,i,e){return this._dispatch(t,i,e||gui.$contextid)},_intervals:Object.create(null),_tempname:{types:Object.create(null),handlers:Object.create(null)},_add:function(t,i,e,n){if(gui.Type.isArray(t))t.forEach(function(t){this._add(t,i,e,n)},this);else{var r,o,u=this._tempname;r=u.handlers[t],r||(r=u.handlers[t]=[]),o=r.indexOf(i),0>o&&(o=r.push(i)-1),e&&(r._one=r._one||Object.create(null),r._one[o]=!0)}return this},_remove:function(t,i,e){if(gui.Type.isArray(t))t.forEach(function(t){this.remove(t,i,e)},this);else{var n=this._tempname,r=n.handlers[t];if(r){var o=r.indexOf(i);0===gui.Array.remove(r,o)&&delete n.handlers[t]}}return this},_dispatch:function(t,i){var e=this._tempname,n=e.types,r=new gui.Tick(t);if(i=i||0,!n[t]){n[t]=!0;var o=this,u=null;u=i?setTimeout(function(){delete n[t],o._doit(r)},i):setImmediate(function(){delete n[t],o._doit(r)})}return r},_doit:function(t){var i=this._tempname.handlers[t.type];i&&i.slice().forEach(function(i){i.ontick(t)})}})}(gui.Arguments.confirmed),gui.Client=function(){function i(t){var i=document.documentElement,e=t[0].toUpperCase()+t.substring(1);return!["","Webkit","Moz","O","ms"].every(function(n){return void 0===i.style[n?n+e:t]})}function e(){function e(){if(gui.CSSPlugin){var i=t,e=document,n=e.documentElement,r=e.body,o=null,u=r.appendChild(gui.CSSPlugin.style(e.createElement("div"),{position:"absolute",height:"10px",width:"10px",top:"100%"}));i.scrollBy(0,10),o=n.scrollTop?n:r,this.scrollRoot=o,gui.CSSPlugin.style(u,{position:"fixed",top:"10px"});var s=10===u.getBoundingClientRect().top;this.hasPositionFixed=s,r.removeChild(u),i.scrollBy(0,-10);var a=gui.CSSPlugin.style(document.createElement("p"),{width:"100%",height:"200px"}),c=gui.CSSPlugin.style(document.createElement("div"),{position:"absolute",top:"0",left:"0",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"});c.appendChild(a),n.appendChild(c);var l=a.offsetWidth;c.style.overflow="scroll";var h=a.offsetWidth;l===h&&(h=c.clientWidth),n.removeChild(c),this.scrollBarSize=l-h,this.isExplorer&&(this.scrollBarSize=17)}}this.isExplorer=n.contains("msie")||n.contains("trident"),this.isExplorer9=this.isExplorer&&n.contains("msie 9"),this.isOpera=n.contains("opera"),this.isWebKit=n.contains("webkit"),this.isChrome=this.isWebKit&&n.contains("chrome"),this.isSafari=this.isWebKit&&!this.isChrome&&n.contains("safari"),this.isGecko=!this.isWebKit&&!this.isOpera&&n.contains("gecko"),this.isChromeApp=t.chrome&&t.chrome.app&&t.chrome.app.runtime?!0:!1,this.agent=function(){var t="explorer";return this.isWebKit?t="webkit":this.isGecko?t="gecko":this.isOpera&&(t="opera"),t}.call(this),this.system=function(){var t=null;return["window mobile","windows","ipad","iphone","haiku","os x","linux"].every(function(i){return n.contains(i)&&(t=i.match(/ipad|iphone/)?"ios":i.replace(/ /g,"")),null===t}),t}(),this.hasTouch=void 0!==t.ontouchstart||this.isChrome,this.hasPointers=!1,this.hasBlob=t.Blob&&(t.URL||t.webkitURL),this.hasHistory=t.history&&t.history.pushState?!0:!1,this.isMobile=function(){var t=["android","webos","iphone","ipad","ipod","blackberry","windows phone"];return!t.every(function(t){return!n.contains(t)})}(),this.hasTransitions=i("transition"),this.hasTransforms=i("transform"),this.hasAnimations=i("animationName"),this.has3D=i("perspective"),this.hasFlex=i("flex"),Object.defineProperty(this,"hasFlexBox",{get:function(){console.error("Depracated API is deprecated: hasFlexBox >> hasFlex")}}),this.hasAnimationFrame=function(){var i=t;return i.requestAnimationFrame||i.webkitRequestAnimationFrame||i.mozRequestAnimationFrame||i.msRequestAnimationFrame||i.oRequestAnimationFrame?!0:!1}(),this.hasTemplates=function(t){return"content"in t?!0:!1}(document.createElement("template")),this.hasImports=function(t){return"import"in t?!0:!1}(document.createElement("link")),this.hasMutations=function(){return!["","WebKit","Moz","O","Ms"].every(function(i){return!gui.Type.isDefined(t[i+"MutationObserver"])})}(),this.STABLETIME=200,this.scrollRoot=null,this.scrollBarSize=0,this.hasPositionFixed=!1,this.onbroadcast=function(t){var i=gui.BROADCAST_WILL_SPIRITUALIZE;t.type===i&&(gui.Broadcast.removeGlobal(i,this),e.call(this))}}var n=navigator.userAgent.toLowerCase();return new e}(),function(){gui.Broadcast.addGlobal(gui.BROADCAST_WILL_SPIRITUALIZE,gui.Client)}(),gui.GreatSpirit={DENIAL:"Attempt to handle destructed object",toString:function(){return"[object gui.GreatSpirit]"},ontick:function(i){i.type===gui.$TICK_DESTRUCT&&t.gui&&this._nukemnow()},$meet:function(t){gui.unloading?this.$nuke(t):(this._spirits.push(t),gui.Tick.dispatch(gui.$TICK_DESTRUCT))},$nuke:function(t){var i=[],e=t.life.plugins;gui.Object.each(e,function(e,n){n?"life"!==e&&i.push(e):Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){},set:function(){}})}),e=i.map(function(i){return t[i]},this),gui.unloading||(this.$nukeplugins(e,!1),gui.Tick.next(function(){this.$nukeplugins(e,!0),this.$nukeelement(t),this.$nukeallofit(t)},this))},$nukeplugins:function(t,i){i?t.forEach(function(t){this.$nukeallofit(t)},this):t.map(function(t){return t.ondestruct(),t}).forEach(function(t){t.$ondestruct()})},$nukeelement:function(t){try{t.element.spirit=null}catch(i){}},$nukeallofit:function(t){var i=Object.prototype;if(!gui.unloading&&!t.$destructed){t.$destructed=!0;for(var e in t)if((t.hasOwnProperty(e)||gui.debug)&&void 0===i[e]&&"$destructed"!==e){var n=Object.getOwnPropertyDescriptor(t,e);(!n||n.configurable)&&(gui.debug?this._definePropertyItentified(t,e):Object.defineProperty(t,e,this.DENIED))}}},DENIED:{enumerable:!0,configurable:!0,get:function(){gui.GreatSpirit.DENY()},set:function(){gui.GreatSpirit.DENY()}},DENY:function(t){var i,e=new Error(gui.GreatSpirit.DENIAL+(t?": "+t:""));!gui.Client.isExplorer&&(i=e.stack)?(i=gui.Client.isWebKit?i.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n"):i.split("\n"),i.shift(),i.shift(),console.warn(e.message+"\n"+i)):console.warn(e.message)},_spirits:[],_definePropertyItentified:function(t,i){Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:function(){gui.GreatSpirit.DENY(t)},set:function(){gui.GreatSpirit.DENY(t)}})},_nukemnow:function(){var i,e=this._spirits.slice();if(t.gui){for(;i=e.shift();)this.$nuke(i);this._spirits=[]}}},gui.Tick.add(gui.$TICK_DESTRUCT,gui.GreatSpirit),gui.Document=function(){function i(t,i){gui.hosted&&gui.Action.ascendGlobal(document,t,i)}return gui.Class.create(Object.prototype,{onconstruct:function(){var i=this,e=function(t,e,n){e.split(" ").forEach(function(e){t.addEventListener(e,i,n)})};e(document,"DOMContentLoaded"),e(document,"click mousedown mouseup",!0),e(t,"load hashchange"),gui.hosted||e(t,"resize orientationchange"),"complete"===document.readyState&&(this._loaded||(this._ondom(),this._onload()))},handleEvent:function(t){switch(t.type){case"click":case"mousedown":case"mouseup":this._onmouseevent(t);break;case"orientationchange":this._onrotate();break;case"resize":this._onresize();break;case"DOMContentLoaded":this._ondom(),gui.hasModule("spirits@wunderbyte.com")||!function(){gui._oninit(),gui.$onready()}();break;case"load":this._onload();break;case"hashchange":this._onhashchange()}},_loaded:!1,_domloaded:!0,_timeout:-1,_ondom:function(){this._domloaded=!0,gui.spacenames(),this._metatags(gui.namespaces()),i(gui.ACTION_DOC_ONDOMCONTENT,location.href)},_onload:function(){this._loaded||(this._loaded=!0,gui.hosted&&i(gui.ACTION_DOC_ONLOAD,location.href))},_onunload:function(){this._domloaded||(this._domloaded=!0,gui.hosted&&i(gui.ACTION_DOC_UNLOAD,location.href))},_onhashchange:function(){gui.hosted&&i(gui.ACTION_DOC_ONHASH,location.hash)},_onmouseevent:function(t){gui.broadcastGlobal({click:gui.BROADCAST_MOUSECLICK,mousedown:gui.BROADCAST_MOUSEDOWN,mouseup:gui.BROADCAST_MOUSEUP}[t.type],gui.$contextid)},_onresize:function(){gui.hosted||(clearTimeout(this._timeout),this._timeout=setTimeout(function(){gui.broadcastGlobal(gui.BROADCAST_RESIZE_END)},gui.TIMEOUT_RESIZE_END))},_onrotate:function(){gui.hosted||(gui.orientation=t.innerWidth>t.innerHeight?1:0,gui.broadcastGlobal(gui.BROADCAST_ORIENTATIONCHANGE,gui.orientation))},_metatags:function(t){var i,e,n=document.querySelectorAll("meta[name][content]");Array.forEach(n,function(n){i=n.getAttribute("name"),t.forEach(function(t){i.startsWith(t+".")&&(e=gui.Object.lookup(i),gui.Type.isDefined(e)?gui.Object.assert(i,gui.Type.cast(n.getAttribute("content"))):console.error('No definition for "'+i+'"'))})})}})}(),function(){gui.document=new gui.Document}(),gui.Spirit=gui.Class.create(Object.prototype,{$instanceid:null,$contextid:null,$destructed:!1,element:null,document:null,window:null,toString:function(){return"[object gui.Spirit]"},onconstruct:function(){},onconfigure:function(){},onenter:function(){},onattach:function(){},onready:function(){},oninit:function(){},ondetach:function(){},onexit:function(){},ondestruct:function(){},onasync:function(){},oncrawler:function(){},$onconstruct:function(t,i,e,n){this.element=t,this.document=i,this.window=e,this.$contextid=n,gui.Spirit.$construct(this)},$ondestruct:function(){},$pluginplugins:function(){var t,i=this.constructor.$plugins;this.life=new gui.LifePlugin(this),this.config=new gui.ConfigPlugin(this),Object.keys(i).filter(function(t){return"life"!==t&&"config"!==t}).sort().forEach(function(e){t=i[e],(this.life.plugins[e]=!t.lazy)?gui.Plugin.$assign(this,e,new t(this)):gui.Plugin.$prepare(this,e,t)},this)},$debug:function(t){if(gui.debug){var i,e=this.element,n=gui.attributes[0];t?gui.attributes.every(function(t){return!e.hasAttribute(t)})&&(i="["+this.constructor.$classname+"]",e.setAttribute(n,i)):(i=e.getAttribute(n),i&&i.startsWith("[")&&e.removeAttribute(n))}}},{portals:!0,summon:function(t){return this.possess((t||document).createElement("div"))},possess:function(t){return gui.Guide.possess(t,this)},extend:function(){var t,i=[],e=gui.Class.breakdown(arguments);["name","protos","recurring","statics"].forEach(function(n){(t=e[n])&&i.push(t)},this);var n=gui.Class.extend.apply(this,i);n.$plugins=gui.Object.copy(this.$plugins);var r=gui.Class.breakdown(arguments);return gui.Object.each(n.$plugins,function(t,i){var e=r.protos[t];switch(gui.Type.of(e)){case"object":var o=i.extend(e);n.plugin(t,o,!0);break;case"undefined":break;default:throw new TypeError(n+": Bad definition for "+t+": "+e)}},this),n},plugin:function(t,i,e){var n=this.$plugins,r=this.prototype;!r.hasOwnProperty(t)||null===r.prefix||e?(!n[t]||e)&&(n[t]=i,r.prefix=null,gui.Class.children(this,function(n){n.plugin(t,i,e)})):console.error("Plugin naming crash in "+this+": "+t)},$plugins:Object.create(null)},{$construct:function(t){t.$pluginplugins(),t.$debug(!0),t.life.constructed=!0,t.onconstruct(),t.life.dispatch(gui.LIFE_CONSTRUCT)},$configure:function(t){t.config.configureall(),t.life.configured=!0,t.onconfigure(),t.life.dispatch(gui.LIFE_CONFIGURE)},$enter:function(t){t.window.gui.inside(t),t.life.entered=!0,t.onenter(),t.life.dispatch(gui.LIFE_ENTER)},$attach:function(t){t.window.gui.inside(t),t.life.attached=!0,t.onattach(),t.life.dispatch(gui.LIFE_ATTACH)},$ready:function(t){t.life.ready=!0,t.onready(),t.life.dispatch(gui.LIFE_READY)},$detach:function(t){t.window.gui.outside(t),t.life.detached=!0,t.life.visible=!1,t.life.dispatch(gui.LIFE_DETACH),t.life.dispatch(gui.LIFE_INVISIBLE),t.ondetach()},$exit:function(t){t.life.exited=!0,t.life.dispatch(gui.LIFE_EXIT),t.onexit()},$async:function(t){t.life.async=!0,t.onasync(),t.life.dispatch(gui.LIFE_ASYNC)},$destruct:function(t){t.$debug(!1),t.life.destructed=!0,t.life.dispatch(gui.LIFE_DESTRUCT),t.ondestruct()},$dispose:function(t){t.$ondestruct(),t.$destructed=!0,gui.destruct(t),gui.GreatSpirit.$meet(t)},$oninit:function(t){t.life.initialized=!0,t.life.dispatch("life-initialized"),t.oninit()}}),gui.Module=gui.Class.create(Object.prototype,{plugin:null,mixin:null,channel:null,oncontextinitialize:function(){},onbeforespiritualize:function(){},onafterspiritualize:function(){},oncontextload:function(){},oncontextunload:function(){},$onconstruct:function(t){var i=t.gui.Spirit;["channels","mixins","plugins"].forEach(function(t){this[t]&&console.error("Deprecated API is deprecated: "+t)},this),gui.Type.isObject(this.mixin)&&i.mixin(this.mixin),gui.Type.isObject(this.plugin)&&gui.Object.each(this.plugin,function(t,e){gui.Type.isDefined(e)?i.plugin(t,e):console.error("Undefined plugin for prefix: "+t)}),gui.Type.isArray(this.channel)&&gui.channel(this.channel),this.$setupcontext(t)},$setupcontext:function(t){var i=this,e=gui.BROADCAST_WILL_SPIRITUALIZE,n=gui.BROADCAST_DID_SPIRITUALIZE;this.oncontextinitialize&&this.oncontextinitialize(t),gui.Broadcast.addGlobal([e,n],{onbroadcast:function(r){if(r.data===t.gui.$contextid)switch(gui.Broadcast.removeGlobal(r.type,this),r.type){case e:gui.Type.isFunction(i.onbeforespiritualize)&&i.onbeforespiritualize(t);break;case n:gui.Type.isFunction(i.onafterspiritualize)&&i.onafterspiritualize(t)}}})}}),gui.Tracker=gui.Plugin.extend({onconstruct:function(){this._super.onconstruct(),this._trackedtypes=Object.create(null),this.spirit&&(this._sig=this.spirit.window.gui.$contextid)},ondestruct:function(){this._super.ondestruct(),gui.Object.each(this._trackedtypes,function(t,i){i.slice().forEach(function(i){this._cleanup(t,i)},this)},this)},toggle:function(){console.error("TODO: SpiritTracker#toggle")
},shift:function(t){var i=gui.Array.from(arguments).slice(1);return t?this.add.apply(this,i):this.remove.apply(this,i)},contains:function(t){return gui.Array.make(t).every(function(t){return this._trackedtypes[t]},this)},_global:!1,_trackedtypes:null,_sig:null,_globalize:function(t){this._global=!0;var i=t.call(this);return this._global=!1,i},_addchecks:function(t,i){var e=!1,n=this._trackedtypes[t];return n?e=!this._haschecks(n,i):(n=this._trackedtypes[t]=[],e=!0),e&&i&&n.push(i),e},_removechecks:function(t,i){var e=!1,n=this._trackedtypes[t];if(n){var r=this._checksindex(n,i);r>-1&&(e=!0,0===gui.Array.remove(n,r)&&delete this._trackedtypes[t])}return e},_containschecks:function(t,i){var e=!1,n=this._trackedtypes[t];return n&&(e=!i||this._haschecks(n,i)),e},_haschecks:function(t,i){var e=!i||!1;return e||t.every(function(t){return t.every(function(t,e){return t===i[e]})&&(e=!0),!e}),e},_hashandlers:function(){return Object.keys(this._trackedtypes).length>0},_checksindex:function(t,i){var e=-1;return t.every(function(t,n){return t.every(function(t,e){return t===i[e]})&&(e=n),-1===e}),e},_breakdown:function(t){return gui.Array.make(t)},_cleanup:function(t,i){this._removechecks(t,i)}}),gui.ActionPlugin=function(t,i){return gui.Tracker.extend({type:null,data:null,add:t("array|string","(object|function)")(i(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.Action.IActionHandler,i)&&gui.Array.make(t).forEach(function(t){this._addchecks(t,[i,this._global])},this)})),remove:t("array|string","(object|function)")(i(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.Action.IActionHandler,i)&&gui.Array.make(t).forEach(function(t){this._removechecks(t,[i,this._global])},this)})),addGlobal:function(t,i){return this._globalize(function(){return this.add(t,i)})},removeGlobal:function(t,i){return this._globalize(function(){return this.remove(t,i)})},dispatch:t("string","(*)")(function(t,i){return gui.Action.dispatch(this.spirit,t,i)}),ascend:t("string","(*)")(function(t,i){return gui.Action.ascend(this.spirit,t,i)}),descend:t("string","(*)")(function(t,i){return gui.Action.descend(this.spirit,t,i)}),dispatchGlobal:t("string","(*)")(function(t,i){return gui.Action.dispatchGlobal(this.spirit,t,i)}),ascendGlobal:t("string","(*)")(function(t,i){return gui.Action.ascendGlobal(this.spirit,t,i)}),descendGlobal:t("string","(*)")(function(t,i){return gui.Action.descendGlobal(this.spirit,t,i)}),_cleanup:function(t,i){var e=i[0],n=i[1];n?this.removeGlobal(t,e):this.remove(t,e)},$handleownaction:!1,$onaction:function(t){var i=this._trackedtypes[t.type];i&&i.forEach(function(i){var e=i[0],n=i[1]===t.global,r=e===this.spirit&&this.$handleownaction;n&&(e!==t.target||r)&&e.onaction(t)},this)}})}(gui.Arguments.confirmed,gui.Combo.chained),gui.BroadcastPlugin=function(t,i){return gui.Tracker.extend({add:i("string|array")(t(function(t,i){i=i?i:this.spirit;var e=this._global?null:this._sig;gui.Array.make(t).forEach(function(t){this._addchecks(t,[i,this._global])&&(this._global?gui.Broadcast.addGlobal(t,i):gui.Broadcast.add(t,i,e))},this)})),remove:i("string|array")(t(function(t,i){i=i?i:this.spirit;var e=this._global?null:this._sig;gui.Array.make(t).forEach(function(t){this._removechecks(t,[i,this._global])&&(this._global?gui.Broadcast.removeGlobal(t,i):gui.Broadcast.remove(t,i,e))},this)})),dispatch:i("string|array")(function(t,i){var e=null,n=this._global,r=n?null:this._sig;return this._global=!1,gui.Array.make(t).forEach(function(t){gui.Broadcast.$target=this.spirit,e=n?gui.Broadcast.dispatchGlobal(t,i):gui.Broadcast.dispatch(t,i,r)},this),e}),addGlobal:function(t,i){return this._globalize(function(){return this.add(t,i)})},removeGlobal:function(t,i){return this._globalize(function(){return this.remove(t,i)})},shiftGlobal:function(t,i,e){return this._globalize(function(){return this.shift(t,i,e)})},dispatchGlobal:function(t,i){return this._globalize(function(){return this.dispatch(t,i)})},_cleanup:function(t,i){var e=i[0],n=i[1];n?gui.Broadcast.removeGlobal(t,e):gui.Broadcast.remove(t,e,this._sig)}})}(gui.Combo.chained,gui.Arguments.confirmed),gui.TickPlugin=function(t){return gui.Tracker.extend({add:t(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.ITickHandler,i)&&gui.Array.make(t).forEach(function(t){this._addchecks(t,[i,this._global])&&this._add(t,i,!1)},this)}),remove:t(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.ITickHandler,i)&&gui.Array.make(t).forEach(function(t){this._removechecks(t,[i,this._global])&&this._remove(t,i)},this)}),one:t(function(t,i){this.add(t,i,!0)}),next:t(function(t,i){gui.Tick.next(t,i||this.spirit)}),nextFrame:function(t,i){return gui.Tick.nextFrame(t,i||this.spirit)},cancelFrame:t(function(t){gui.Tick.cancelFrame(t)}),time:function(t,i,e){return gui.Tick.time(t,i,e||this.spirit)},cancelTime:t(function(t){gui.Tick.cancelTime(t)}),start:t(function(t){gui.Tick.start(t)}),stop:t(function(t){gui.Tick.stop(t)}),dispatch:function(t,i){return this._dispatch(t,i||0)},_global:!1,_add:function(t,i,e){var n=this.spirit.$contextid;e?this._global?gui.Tick.oneGlobal(t,i):gui.Tick.one(t,i,n):this._global?gui.Tick.addGlobal(t,i):gui.Tick.add(t,i,n)},_remove:function(t,i){var e=this.spirit.$contextid;this._global?gui.Tick.removeGlobal(t,i):gui.Tick.remove(t,i,e)},_dispatch:function(t,i){var e,n=this.spirit.$contextid;return e=this._global?gui.Tick.dispatchGlobal(t,i):gui.Tick.dispatch(t,i,n)},_cleanup:function(t,i){var e=i[0],n=i[1];this._remove(t,[e])&&(n?gui.Tick.removeGlobal(t,e):gui.Tick.remove(t,e,this.$contextid))}})}(gui.Combo.chained),gui.ITickHandler={toString:function(){return"[object ITickHandler]"},ontick:function(){}},gui.Life=function(t,i){this.target=t,this.type=i},gui.Life.prototype={target:null,type:null,toString:function(){return"[object gui.Life]"}},gui.LifePlugin=gui.Tracker.extend({constructed:!1,configured:!1,entered:!1,attached:!1,detached:!0,ready:!1,async:!1,exited:!1,destructed:!1,visible:void 0,rendered:!1,plugins:null,onconstruct:function(){this._super.onconstruct(),this._handlers=Object.create(null),this.plugins=Object.create(null)},add:function(t,i){return i=i?i:this.spirit,gui.Array.make(t).forEach(function(t){this._addchecks(t,[i])&&(this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(i))},this),this.spirit},remove:function(t,i){return i=i?i:this.spirit,gui.Array.make(t).forEach(function(t){if(this._removechecks(t,[i])&&this._handlers[t]){var e=this._handlers[t].indexOf(t);gui.Array.remove(this._handlers[t],e),0===this._handlers[t].length&&delete this._handlers[t]}},this),this.spirit},dispatch:function(t){var i=this._handlers[t];if(i){var e=new gui.Life(this.spirit,t);switch(i.forEach(function(t){t.onlife(e)}),t){case gui.LIFE_CONSTRUCT:case gui.LIFE_CONFIGURE:case gui.LIFE_ENTER:case gui.LIFE_READY:case gui.LIFE_DETACH:case gui.LIFE_EXIT:case gui.LIFE_DESTRUCT:delete this._handlers[t]}}},_handlers:null,_cleanup:function(t,i){var e=i[0];this.remove(t,e)}}),gui.ConfigPlugin=gui.Plugin.extend({configureall:function(){var t=this.spirit.element.attributes;Array.forEach(t,function(t){this.configureone(t.name,t.value)},this)},onlife:function(){for(var t;t=this._onready.shift();)t()},configureone:function(t,i){var e,n=this.spirit.window.gui;n.attributes.every(function(n){return(e=t.startsWith(n+"."))&&this._evaluate(t,i,n),!e},this)},_onready:null,_evaluate:function(t,i,e){var n=this.spirit,r=!0,o=null,u=null;t=o=t.split(e+".")[1],t.indexOf(".")>-1&&(u=t.split("."),u.forEach(function(t,i){gui.Type.isDefined(n)?i<u.length-1?n=n[t]:o=t:r=!1})),r&&gui.Type.isDefined(n[o])?this._schedule(n,o,this._revaluate(i)):console.error('No definition for "'+t+'" in '+this.spirit.toString())},_schedule:function(t,i,e){gui.Type.isFunction(t[i])?this.spirit.life.ready?t[i](e):(this.spirit.life.add(gui.LIFE_READY,this),this._onready=this._onready||[],this._onready.push(function(){t[i](e)})):t[i]=e},_revaluate:function(i){return gui.Type.isString(i)&&(gui.hasModule("edb@wunderbyte.com")&&i.startsWith("edb.$get")?i=t.edb.$get(gui.KeyMaster.extractKey(i)[0]):(i=gui.Type.cast(i),gui.Type.isString(i)&&(i=this._jsonvaluate(i)))),i},_jsonvaluate:function(t){if([["%5B","%5D"],["%7B","%7D"]].some(function(i){return t.startsWith(i[0])&&t.endsWith(i[1])}))try{t=JSON.parse(decodeURIComponent(t))}catch(i){t=null,console.error(this+": Bad JSON: "+i.message)}return t}},{lazy:!1}),gui.Att=function(t,i){this.value=gui.Type.cast(i),this.name=this.type=t},gui.Att.prototype={name:null,type:null,value:null},gui.AttPlugin=function(t,i){return gui.Tracker.extend({get:function(t){return gui.AttPlugin.get(this.spirit.element,t)},set:i(function(t,i){this.$suspended||gui.AttPlugin.set(this.spirit.element,t,i)}),has:function(t){return gui.AttPlugin.has(this.spirit.element,t)},del:i(function(t){this.$suspended||gui.AttPlugin.del(this.spirit.element,t)}),all:function(){return gui.AttPlugin.all(this.spirit.element)},shift:t("boolean","string")(i(function(t,i,e){if(t){if(void 0===e)throw new TypeError('Missing value for "'+i+'"');this.set(i,e)}else this.del(i)})),getmap:function(){return gui.AttPlugin.getmap(this.spirit.element)},setmap:function(t){gui.AttPlugin.setmap(this.spirit.element,t)},add:t("array|string","(object|function)")(i(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.IAttHandler,i)&&gui.Array.make(t).forEach(function(t){this._addchecks(t,[i]),this._onadd(t)},this)})),remove:t("array|string","(object|function)")(i(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.IAttHandler,i)&&gui.Array.make(t).forEach(function(t){this._removechecks(t,[i])},this)})),$suspended:!1,$suspend:function(t){this.$suspended=!0;var i=t();return this.$suspended=!1,i},$onatt:function(t,i){var e,n,r,o,u=!gui.attributes.every(function(e){return(o=t.startsWith(e))&&this.spirit.config.configureone(t,i),!o},this);!u&&(e=this._trackedtypes[t])&&(n=new gui.Att(t,i),e.forEach(function(t){r=t[0],r.onatt(n)},this))},_onadd:function(t){if(this.has(t)){var i=this.get(t);t.startsWith(gui.ConfigPlugin.PREFIX)?this.spirit.config.configureone(t,i):this.$onatt(t,i)}}},{},{get:function(t,i){return gui.Type.cast(t.getAttribute(i))},set:i(function(t,i,e){var n=t.spirit,r=!1;this._ischecked(t,i)?(r=t.checked!==e,t.checked="false"===String(e)?!1:null!==e,r&&n.att.$onatt(i,e)):this._isvalue(t,i)?(r=t.value!==String(e),r&&(t.value=String(e),n.att.$onatt(i,e))):null===e?this.del(t,i):(e=String(e),t.getAttribute(i)!==e&&(n?(n.att.$suspend(function(){t.setAttribute(i,e)}),n.att.$onatt(i,e)):t.setAttribute(i,e)))}),_ischecked:function(t,i){return t.type&&void 0!==t.checked&&"checked"===i},_isvalue:function(t,i){return void 0!==t.value&&"value"===i},has:function(t,i){return t.hasAttribute(i)},del:i(function(t,i){var e=t.spirit;this._ischecked(t,i)?t.checked=!1:this._isvalue(t,i)?t.value="":e?(e.att.$suspend(function(){t.removeAttribute(i)}),e.config.configureone(i,null)||e.att.$onatt(i,null)):t.removeAttribute(i)}),all:function(t){return gui.Array.from(t.attributes)},getmap:function(t){var i=Object.create(null);return this.all(t).forEach(function(t){i[t.name]=gui.Type.cast(t.value)}),i},setmap:i(function(t,i){gui.Object.each(i,function(i,e){this.set(t,i,e)},this)})})}(gui.Arguments.confirmed,gui.Combo.chained),gui.IAttHandler={toString:function(){return"[object IAttHandler]"},onatt:function(){}},gui.BoxPlugin=gui.Plugin.extend({width:0,height:0,localX:0,localY:0,pageX:0,pageY:0,clientX:0,clientY:0,_scrollroot:function(){return function(t){return"html"===gui.Client.scrollRoot.localName?t.documentElement:t.body}(this.spirit.document)}}),Object.defineProperties(gui.BoxPlugin.prototype,{width:{get:function(){return this.spirit.element.offsetWidth}},height:{get:function(){return this.spirit.element.offsetHeight}},localX:{get:function(){return this.spirit.element.offsetLeft}},localY:{get:function(){return this.spirit.element.offsetTop}},pageX:{get:function(){return this.clientX+this._scrollroot().scrollLeft}},pageY:{get:function(){return this.clientY+this._scrollroot().scrollTop}},clientX:{get:function(){return this.spirit.element.getBoundingClientRect().left}},clientY:{get:function(){return this.spirit.element.getBoundingClientRect().top}}}),gui.CSSPlugin=function(t,i){return gui.Plugin.extend({add:i("string|array")(t(function(t){var i=this.spirit.element;gui.Array.make(t).forEach(function(t){gui.CSSPlugin.add(i,t)})})),remove:i("string|array")(t(function(t){var i=this.spirit.element;gui.Array.make(t).forEach(function(t){gui.CSSPlugin.remove(i,t)})})),toggle:i("string|array")(t(function(t){var i=this.spirit.element;gui.Array.make(t).forEach(function(t){gui.CSSPlugin.toggle(i,t)})})),shift:i("boolean","string|array")(t(function(t,i){var e=this.spirit.element;gui.Array.make(i).forEach(function(i){gui.CSSPlugin.shift(e,t,i)})})),contains:i("string")(function(t){return gui.CSSPlugin.contains(this.spirit.element,t)}),set:t(function(t,i){gui.CSSPlugin.set(this.spirit.element,t,i)}),style:t(function(t){gui.CSSPlugin.style(this.spirit.element,t)}),get:function(t){return gui.CSSPlugin.get(this.spirit.element,t)},compute:function(t){return gui.CSSPlugin.compute(this.spirit.element,t)},name:t(function(t){var i=this.spirit.element.className;return void 0!==t&&(this.spirit.element.className=t,i=this.spirit),i}),matches:function(t){return gui.CSSPlugin.matches(this.spirit.element,t)}},{},{add:t(function(t,i){if(gui.Type.isString(i))if(i.indexOf(" ")>-1&&(i=i.split(" ")),gui.Type.isArray(i))i.forEach(function(i){this.add(t,i)},this);else if(this._supports)t.classList.add(i);else{var e=t.className.split(" ");-1===e.indexOf(i)&&(e.push(i),t.className=e.join(" "))}}),remove:t(function(t,i){if(gui.Type.isString(i))if(i=i||"",i.indexOf(" ")>-1&&(i=i.split(" ")),gui.Type.isArray(i))i.forEach(function(i){this.remove(t,i)},this);else if(this._supports)t.classList.remove(i);else{var e=t.className.split(" "),n=e.indexOf(i);n>-1&&gui.Array.remove(e,n),t.className=e.join(" ")}}),toggle:t(function(t,i){gui.Type.isString(i)&&(this._supports?t.classList.toggle(i):this.contains(t,i)?this.remove(t,i):this.add(t,i))}),shift:t(function(t,i,e){gui.Type.isBoolean(i)?i?this.add(t,e):this.remove(t,e):console.error("Deprecated API is deprecated")}),contains:function(t,i){if(this._supports)return t.classList.contains(i);var e=t.className.split(" ");return e.indexOf(i)>-1},set:t(function(t,i,e){gui.Type.isNumber(e)&&(e=(this._shorthands[i]||"@").replace("@",e)),e=String(e),"float"===i?i="cssFloat":(e=this.jsvalue(e),i=this.jsproperty(i)),t.style[i]=e}),get:function(t,i){return i=this.jsproperty(i),this.jsvalue(t.style[i])},style:function(t,i){var e=t instanceof gui.Spirit?t.element:t;return gui.Object.each(i,function(t,i){this.set(e,t,i)},this),t},compute:function(t,i){var e=t instanceof gui.Spirit?t.element:t,n=e.ownerDocument,r=n.defaultView;return i=this._standardcase(this.jsproperty(i)),r.getComputedStyle(e,null).getPropertyValue(i)},matches:function(t,i){return t[this._matchmethod](i)},jsproperty:function(t){var i=this._vendors,e=t,n=document.documentElement;return t=String(t),t.startsWith("-beta-")?i.every(function(i){var r=this._camelcase(t.replace("-beta-",i));return void 0!==n.style[r]?(e=r,!1):!0},this):e=this._camelcase(e),e},jsvalue:function(t){var i=this._vendors,e=document.documentElement;if(t=String(t),t&&t.contains("-beta-")){var n=[];t.split(", ").forEach(function(t){(t=t.trim()).startsWith("-beta-")?i.every(function(i){var r=this._camelcase(t.replace("-beta-",i));return void 0!==e.style[r]?(n.push(t.replace("-beta-",i)),!1):!0},this):n.push(t)},this),t=n.join(",")}return t},cssproperty:function(t){return this._standardcase(this.jsproperty(t))},cssvalue:function(t){return this._standardcase(this.jsvalue(t))},_vendors:["","-webkit-","-moz-","-ms-","-o-"],_supports:void 0!==document.documentElement.classList,_camelcase:function(t){return t.replace(/-([a-z])/gi,function(t,i){return i.toUpperCase()})},_standardcase:function(t){return t.replace(/[A-Z]/g,function(i,e){return"-"+t.charAt(e).toLowerCase()})},_shorthands:{top:"@px",right:"@px",bottom:"@px",left:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",textIndent:"@px",margin:"@px",marginTop:"@px",marginRight:"@px",marginBottom:"@px",marginLeft:"@px",padding:"@px",paddingTop:"@px",paddingRight:"@px",paddingBottom:"@px",paddingLeft:"@px",fontWeight:"@",opacity:"@",zIndex:"@",position:"@",display:"@",visibility:"@"},_matchmethod:function(){var t=null,i=document.documentElement;return["mozMatchesSelector","webkitMatchesSelector","msMatchesSelector","oMatchesSelector","matchesSelector"].every(function(e){return gui.Type.isDefined(i[e])&&(t=e),null===t}),t}()})}(gui.Combo.chained,gui.Arguments.confirmed),function(){function t(t){Object.defineProperty(gui.CSSPlugin.prototype,t,{enumerable:!0,configurable:!0,get:function(){return this.spirit?parseInt(this.get(t),10):void 0},set:function(i){this.set(t,i)}})}var i=gui.CSSPlugin._shorthands;for(var e in i)i.hasOwnProperty(e)&&t(e)}(),gui.DOMPlugin=function(t){return gui.Plugin.extend({id:t(function(t){return t?void(this.spirit.element.id=t):this.spirit.element.id||null}),title:t(function(t){var i=this.spirit.element;return gui.Type.isDefined(t)?void(i.title=t?t:""):i.title}),html:t(function(t,i){return gui.DOMPlugin.html(this.spirit.element,t,i)}),outerHtml:t(function(t){return gui.DOMPlugin.outerHtml(this.spirit.element,t)}),text:t(function(t){return gui.DOMPlugin.text(this.spirit.element,t)}),empty:t(function(){this.html("")}),hide:t(function(){this.spirit.css.contains(gui.CLASS_HIDDEN)||(this.spirit.css.add(gui.CLASS_HIDDEN),gui.hasModule("layout@wunderbyte.com")&&this.spirit.visibility&&this.spirit.visibility.off())}),show:t(function(){this.spirit.css.contains(gui.CLASS_HIDDEN)&&(this.spirit.css.remove(gui.CLASS_HIDDEN),gui.hasModule("layout@wunderbyte.com")&&this.spirit.visibility&&this.spirit.visibility.on())}),tag:function(){return this.spirit.element.localName},embedded:function(){return gui.DOMPlugin.embedded(this.spirit.element)},remove:function(){var t=this.spirit.element.parentNode;t.removeChild(this.spirit.element)},clone:function(){return this.spirit.element.cloneNode(!0)},ordinal:function(){return gui.DOMPlugin.ordinal(this.spirit.element)},compare:function(t){return gui.DOMPlugin.compare(this.spirit.element,t)},parseToNode:function(t){return gui.DOMPlugin.parseToNode(t)},parseToNodes:function(t){return gui.DOMPlugin.parseToNodes(t)}},{},{html:function(t,i,e){return gui.Type.isString(i)?e?t.insertAdjacentHTML(e,i):void(gui.mode===gui.MODE_ROBOT?(gui.materializeSub(t),gui.suspend(function(){t.innerHTML=i}),gui.spiritualizeSub(t)):t.innerHTML=i):t.innerHTML},outerHtml:function(t,i){return gui.Type.isString(i)?void(gui.mode===gui.MODE_ROBOT?(gui.materialize(t),gui.suspend(function(){t.outerHTML=i}),gui.spiritualize(t)):t.outerHTML=i):t.outerHTML},text:function(t,i){var e=gui.Guide;return gui.Type.isString(i)?void(gui.mode===gui.MODE_ROBOT?(e.materializeSub(t),gui.suspend(function(){t.textContent=i})):t.textContent=i):t.textContent},ordinal:function(t){var i=0,e=t.parentNode;if(e)for(var n=e.firstElementChild;n&&n!==t;)n=n.nextElementSibling,i++;return i},compare:function(t,i){return t=t instanceof gui.Spirit?t.element:t,i=i instanceof gui.Spirit?i.element:i,t.compareDocumentPosition(i)},contains:function(t,i){var e=Node.DOCUMENT_POSITION_CONTAINS+Node.DOCUMENT_POSITION_PRECEDING;return this.compare(i,t)===e},follows:function(t,i){return this.compare(i,t)===Node.DOCUMENT_POSITION_FOLLOWING},precedes:function(t,i){return this.compare(i,t)===Node.DOCUMENT_POSITION_PRECEDING},embedded:function(t){return t=t instanceof gui.Spirit?t.element:t,this.contains(t.ownerDocument,t)},group:function(t){function i(t,i){return i.some(function(i){return gui.DOMPlugin.contains(i,t)})}for(var e,n=[];e=t.pop();)i(e,t)||n.push(e);return n},q:function(t,i,e){var n=null;return this._qualify(t,i)(function(t,i){if(e)n=this.qall(t,i,e)[0]||null;else try{n=t.querySelector(i)}catch(r){throw console.error("Dysfunctional selector: "+i),r}return n})},qall:function(t,i,e){var n=[];return this._qualify(t,i)(function(t,i){return n=gui.Array.from(t.querySelectorAll(i)),e&&(n=n.filter(function(t){return t.spirit&&t.spirit instanceof e}).map(function(t){return t.spirit})),n})},qdoc:function(t,i){return this.q(document,t,i)},qdocall:function(t,i){return this.qall(document,t,i)},_qualify:function(t,i){var e,n=!0,r=this._thiskeyword;return t.nodeType===Node.ELEMENT_NODE&&r.test(i)&&(n=t.id,e=t.id=t.id||gui.KeyMaster.generateKey(),i=i.replace(r,"#"+e),t=t.ownerDocument),function(e){var r=e.call(gui.DOMPlugin,t,i);return n||(t.id=""),r}},_thiskeyword:/^this|,this/g})}(gui.Combo.chained,gui.Guide,gui.Observer),gui.Object.bindall(gui.DOMPlugin),gui.DOMPlugin.mixin(gui.Object.map({q:function(t,i){return gui.DOMPlugin.q(this.spirit.element,t,i)},qall:function(t,i){return gui.DOMPlugin.qall(this.spirit.element,t,i)},qdoc:function(t,i){return gui.DOMPlugin.qdoc(t,i)},qdocall:function(t,i){return gui.DOMPlugin.qdocall(t,i)}},function(t,i){return function(){var e=arguments[0],n=arguments[1];if(gui.Type.isString(e)){if(1===arguments.length||gui.Type.isFunction(n))return i.apply(this,arguments);throw n=gui.Type.of(n),new TypeError("Unknown spirit for query: "+t+"("+e+","+n+")")}throw new TypeError("Bad selector for query: "+t+"("+e+")")}})),gui.DOMPlugin.mixin(gui.Object.map({next:function(t){var i=null,e=null,n=this.spirit.element;if(t){for(;null!==(n=n.nextElementSibling);)if(e=n.spirit,null!==e&&e instanceof t){i=e;break}}else i=n.nextElementSibling;return i},previous:function(t){var i=null,e=null,n=this.spirit.element;if(t){for(;null!==(n=n.previousElementSibling);)if(e=n.spirit,null!==e&&e instanceof t){i=e;break}}else i=n.previousElementSibling;return i},first:function(t){var i=null,e=null,n=this.spirit.element.firstElementChild;if(t)for(;null===i&&null!==n;)e=n.spirit,null!==e&&e instanceof t&&(i=e),n=n.nextElementSibling;else i=n;return i},last:function(t){var i=null,e=null,n=this.spirit.element.lastElementChild;if(t)for(;null===i&&null!==n;)e=n.spirit,null!==e&&e instanceof t&&(i=e),n=n.previoustElementSibling;else i=n;return i},parent:function(t){var i=this.spirit.element.parentNode;if(t){var e=i.spirit;i=e&&e instanceof t?e:null}return i},child:function(t){var i=this.spirit.element.firstElementChild;return t&&(i=this.children(t)[0]||null),i},children:function(t){var i=gui.Array.from(this.spirit.element.children);return t&&(i=i.filter(function(i){return i.spirit&&i.spirit instanceof t}).map(function(t){return t.spirit})),i},ancestor:function(t){var i=this.parent();return t&&(i=null,(new gui.Crawler).ascend(this.spirit.element,{handleSpirit:function(e){return e instanceof t?(i=e,gui.Crawler.STOP):void 0}})),i},ancestors:function(t){var i=[],e=new gui.Crawler;return t?e.ascend(this.element,{handleSpirit:function(e){e instanceof t&&i.push(e)}}):e.ascend(this.element,{handleElement:function(t){i.push(t)}}),i},descendant:function(t){var i=this.child(),e=this.spirit.element;return t&&(new gui.Crawler).descend(e,{handleSpirit:function(n){return n instanceof t&&n.element!==e?(i=n,gui.Crawler.STOP):void 0}}),i},descendants:function(t){var i=[],e=this.spirit.element;return(new gui.Crawler).descend(e,{handleElement:function(n){t||n===e||i.push(n)},handleSpirit:function(n){t&&n instanceof t&&n.element!==e&&i.push(n)}}),i},following:function(t){for(var i,e=[],n=this.spirit.element;n=n.nextElementSibling;)t&&(i=n.spirit)?i instanceof t&&e.push(i):e.push(n);return e},preceding:function(t){for(var i,e=[],n=this.spirit.element;n=n.previousElementSibling;)t&&(i=n.spirit)?i instanceof t&&e.push(i):e.push(n);return e}},function(t,i){return function(e){if(!gui.Type.isDefined(e)||gui.Type.isFunction(e))return i.apply(this,arguments);throw new TypeError("Unknown spirit for query: "+t+"("+gui.Type.of(e)+")")}})),function(){function t(t){gui.mode!==gui.MODE_ROBOT&&gui.spiritualize(t)}gui.DOMPlugin.mixin({appendTo:function(i){var e=this.spirit.element;return gui.Type.isSpirit(i)?i.dom.append(e):gui.Type.isElement(i)&&(i.appendChild(e),t(i)),this},parseToNode:function(t,i){return gui.HTMLParser.parseToNode(t,i)},parseToNodes:function(t,i){return gui.HTMLParser.parseToNodes(t,i)}})}(),function(){function t(t){gui.mode!==gui.MODE_ROBOT&&gui.spiritualize(t)}gui.DOMPlugin.mixin(gui.Object.map({append:function(i){var e=i,n=this.spirit.element;e.forEach(function(i){n.appendChild(i),t(i)})},prepend:function(i){var e=i,n=this.spirit.element,r=n.firstChild;e.reverse().forEach(function(i){n.insertBefore(i,r),t(i)})},before:function(i){var e=i,n=this.spirit.element,r=n.parentNode;e.reverse().forEach(function(i){r.insertBefore(i,n),t(i)})},after:function(i){var e=i,n=this.spirit.element,r=n.parentNode;e.forEach(function(i){r.insertBefore(i,n.nextSibling),t(i)})},replace:function(t){this.after(t),this.remove()}},function(t,i){return function(t){var e=Array.map(gui.Array.make(t),function(t){return t&&t instanceof gui.Spirit?t.element:t}).filter(function(t){return t&&gui.Type.isNumber(t.nodeType)});return e.length&&i.call(this,e),t}}))}(),gui.EventPlugin=function(i){return gui.Tracker.extend({add:i(function(t,i,e,n){if(i=i?i:this.spirit.element,i=i instanceof gui.Spirit?i.element:i,!i.nodeType&&!gui.Type.isWindow(i))throw new TypeError("Invalid target: "+i+" ("+this.spirit.$classname+")");if(e=e?e:this.spirit,n=n?n:!1,gui.Interface.validate(gui.IEventHandler,e)){var r=[i,e,n];gui.Array.make(t).forEach(function(t){this._addchecks(t,r)&&this._addEventListener(!0,i,t,e,n)},this)}}),remove:i(function(t,i,e,n){if(i=i?i:this.spirit.element,i=i instanceof gui.Spirit?i.element:i,!i.nodeType&&!gui.Type.isWindow(i))throw new TypeError("Invalid target: "+i+" ("+this.spirit.$classname+")");if(e=e?e:this.spirit,n=n?n:!1,gui.Interface.validate(gui.IEventHandler,e)){var r=[i,e,n];gui.Array.make(t).forEach(function(t){this._removechecks(t,r)&&this._addEventListener(!1,i,t,e,n)},this)}}),toggle:i(function(t,i,e,n){i=i?i:this.spirit.element,e=e?e:this.spirit,n=n?n:!1,i instanceof gui.Spirit&&(i=i.element);var r=[i,e,n];gui.Array.make(t).forEach(function(t){this._contains(t,r)?this.add(t,i,e,n):this.remove(t,i,e,n)},this)}),dispatch:function(i,e){var n=this.spirit.element,r=null;return t.CustomEvent&&!gui.Client.isExplorer?r=new CustomEvent(i,e):(e=e||{bubbles:!1,cancelable:!1,detail:void 0},r=document.createEvent("HTMLEvents"),r.initEvent(i,e.bubbles,e.cancelable)),r.eventName=i,n.dispatchEvent?n.dispatchEvent(r):n[i]?n[i]():n["on"+i]?n["on"+i]():void 0},_addEventListener:function(t,i,e,n,r){var o=t?"addEventListener":"removeEventListener";i[o](e,n,r)},_cleanup:function(t,i){var e=i[0],n=i[1],r=i[2];this.remove(t,e,n,r)},_breakdown:function(t){return this._super._breakdown(t).map(function(t){return"transitionend"===t?this._transitionend():t},this)},_transitionend:function(){var t,i=this.spirit.document.createElement("fakeelement"),e={transition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in e)if(void 0!==i.style[t])return e[t]}})}(gui.Combo.chained),gui.IEventHandler={toString:function(){return"[object IEventHandler]"},handleEvent:function(){},onevent:function(){}},gui.SpritePlugin=gui.Plugin.extend({x:{getter:function(){return this._pos.x},setter:function(t){this._pos.x=t,this._apply()}},y:{getter:function(){return this._pos.y},setter:function(t){this._pos.y=t,this._apply()}},z:{getter:function(){return this._pos.z},setter:function(t){this._pos.z=t,this._apply()}},onconstruct:function(){this._super.onconstruct(),this._pos=new gui.Position},reset:function(){this.spirit.css.set("-beta-transform","")},_pos:null,_apply:function(){var t=this._pos,i=[t.x,t.y,t.z].map(Math.round);this.spirit.css.set("-beta-transform","translate3d("+i.join("px,")+"px)")}}),gui.DocumentSpirit=gui.Spirit.extend({onready:function(){this._super.onready(),(this.waiting=gui.hosted)&&this.action.addGlobal(gui.$ACTION_XFRAME_VISIBILITY),this.action.dispatchGlobal(gui.ACTION_DOC_ONSPIRITUALIZED)},onaction:function(t){switch(this._super.onaction(t),this.action.$handleownaction=!1,t.type){case gui.$ACTION_XFRAME_VISIBILITY:this._waiting=!1,gui.hasModule("layout@wunderbyte.com")&&(t.data===!0?this.visibility.on():this.visibility.off()),t.consume()}},oncrawler:function(t){var i=this._super.oncrawler(t);if(i===gui.Crawler.CONTINUE)switch(t.type){case gui.CRAWLER_VISIBLE:case gui.CRAWLER_INVISIBLE:this._waiting&&(i=gui.Crawler.STOP)}return i},onvisible:function(){this.css.remove(gui.CLASS_INVISIBLE),this._super.onvisible()},oninvisible:function(){this.css.add(gui.CLASS_INVISIBLE),this._super.oninvisible()},_loaded:!1,_waiting:!1,_timeout:null}),gui.IframeSpirit=gui.Spirit.extend({spiritualized:!1,fit:!1,xguest:null,contentWindow:{getter:function(){return this.element.contentWindow}},contentDocument:{getter:function(){return this.element.contentDocument}},contentLocation:null,onconstruct:function(){this._super.onconstruct(),this.event.add("message",this.window),this._postbox=[]},onenter:function(){this._super.onenter(),this.event.add("load"),this.action.addGlobal([gui.ACTION_DOC_ONDOMCONTENT,gui.ACTION_DOC_ONLOAD,gui.ACTION_DOC_ONHASH,gui.ACTION_DOC_ONSPIRITUALIZED,gui.ACTION_DOC_UNLOAD]),this.fit&&(this.css.height=0);var t=this.element.src;t&&t!==gui.IframeSpirit.SRC_DEFAULT&&(t.startsWith("blob:")||this._setupsrc(t))},onaction:function(t){this._super.onaction(t),this.action.$handleownaction=!1;var i;switch(t.type){case gui.ACTION_DOC_ONDOMCONTENT:this.contentLocation=new gui.URL(document,t.data),this.life.dispatch(gui.LIFE_IFRAME_DOMCONTENT),this.action.remove(t.type),t.consume();break;case gui.ACTION_DOC_ONLOAD:this.contentLocation=new gui.URL(document,t.data),this.life.dispatch(gui.LIFE_IFRAME_ONLOAD),this.action.remove(t.type),t.consume();break;case gui.ACTION_DOC_ONHASH:i=this.contentLocation.href.split("#")[0],this.contentLocation=new gui.URL(document,i+t.data),this.life.dispatch(gui.LIFE_IFRAME_ONHASH),t.consume();break;case gui.ACTION_DOC_ONSPIRITUALIZED:this._onspiritualized(),this.life.dispatch(gui.LIFE_IFRAME_SPIRITUALIZED),this.action.remove(t.type),t.consume();break;case gui.ACTION_DOC_UNLOAD:this._onunload(),this.life.dispatch(gui.LIFE_IFRAME_UNLOAD),this.action.add([gui.ACTION_DOC_ONCONSTRUCT,gui.ACTION_DOC_ONDOMCONTENT,gui.ACTION_DOC_ONLOAD,gui.ACTION_DOC_ONSPIRITUALIZED]),t.consume()}},onevent:function(t){switch(this._super.onevent(t),t.type){case"message":this._onmessage(t.data,t.origin,t.source);break;case"load":}},onvisible:function(){this._super.onvisible(),this.spiritualized&&this._visibility()},oninvisible:function(){this._super.oninvisible(),this.spiritualized&&this._visibility()},src:function(t){return t&&(this._setupsrc(t),this.element.src=t),this.element.src},url:function(t,i){return i&&this._setupsrc(i),t&&(this.element.src=t),this.contentLocation.href},postMessage:function(t){this.spiritualized?this.contentWindow.postMessage(t,"*"):this._postbox.push(t)},_setupsrc:function(t){var i=document;this.contentLocation=new gui.URL(i,t),this.xguest=function(e){if(e)return"*";if(gui.URL.external(t,i)){var n=new gui.URL(i,t);return n.protocol+"//"+n.host}return null}(this._sandboxed())},_onspiritualized:function(){for(this.spiritualized=!0;this._postbox.length;)this.postMessage(this._postbox.shift());this._visibility()},_onfit:function(t){this.fit&&(this.css.height=t,this.action.dispatchGlobal(gui.ACTION_DOC_FIT))},_onunload:function(){this.spiritualized=!1,this.fit&&(this.css.height=0)},_onmessage:function(t,i,e){if(e===this.contentWindow&&t.startsWith("spiritual-action:")){var n=gui.Action.parse(t);n.direction===gui.Action.ASCEND&&(this.action.$handleownaction=!0,this.action.ascendGlobal(n.type,n.data))}},_sandboxed:function(){var t=this.element.sandbox;return t&&t.length},_visibility:function(){gui.hasModule("layout@wunderbyte.com")&&gui.Type.isDefined(this.life.visible)&&this.action.descendGlobal(gui.$ACTION_XFRAME_VISIBILITY,this.life.visible)}},{summon:function(t,i){var e=t.createElement("iframe"),n=this.possess(e);if(n.css.add("gui-iframe"),i){if(gui.URL.external(i,t)){var r=new gui.URL(t,i);
n.xguest=r.protocol+"//"+r.host}}else i=this.SRC_DEFAULT;return e.src=i,n}},{SRC_DEFAULT:"javascript:void(false);"}),gui.StyleSheetSpirit=gui.Spirit.extend({onenter:function(){this._super.onenter(),this._rules&&(this.addRules(this._rules),this._rules=null)},disable:function(){this.element.disabled=!0},enable:function(){this.element.disabled=!1},addRules:function(t){var i=this.element.sheet,e=i.cssRules.length;gui.Object.each(t,function(t,n){i.insertRule(t+this._ruleout(n),e++)},this)},_rules:null,_ruleout:function(t){var i="",e=gui.CSSPlugin;return gui.Object.each(t,function(t,n){i+=e.cssproperty(t)+":"+e.cssvalue(n)+";"}),"{"+i+"}"}},{summon:function(t,i,e,n){var r=i?this._createlink(t,i):this._createstyle(t),o=this.possess(r);return e&&(i?r.addEventListener("load",function(){o.addRules(e)},!1):o._rules=e),n&&o.disable(),o},_createlink:function(t,i){var e=t.createElement("link");return e.className="gui-stylesheet",e.rel="stylesheet",e.href=i,e},_createstyle:function(t){var i=t.createElement("style");return i.className="gui-stylesheet",i.appendChild(t.createTextNode("")),i}}),gui.module("spirits@wunderbyte.com",{channel:[["html",gui.DocumentSpirit],[".gui-styles",gui.StyleSheetSpirit],[".gui-iframe",gui.IframeSpirit],[".gui-spirit",gui.Spirit]],plugin:{action:gui.ActionPlugin,broadcast:gui.BroadcastPlugin,tick:gui.TickPlugin,att:gui.AttPlugin,config:gui.ConfigPlugin,box:gui.BoxPlugin,css:gui.CSSPlugin,dom:gui.DOMPlugin,event:gui.EventPlugin,life:gui.LifePlugin,sprite:gui.SpritePlugin},mixin:{onaction:function(){},onbroadcast:function(){},ontick:function(){},onatt:function(){},onevent:function(){},onlife:function(){},handleEvent:function(t){"webkitTransitionEnd"===t.type&&(t={type:"transitionend",target:t.target,propertyName:t.propertyName,elapsedTime:t.elapsedTime,pseudoElement:t.pseudoElement}),this.onevent(t)},$ondestruct:gui.Combo.before(function(){this.handleEvent=function(){}})(gui.Spirit.prototype.$ondestruct)}}),gui.Observer={observes:!1,observe:function(){if(!gui.Client.hasMutations)throw new Error("MutationObserver no such thing");if(!this._observer){var t=this._mutationobserver();this._observer=new t(function(t){t.forEach(function(t){gui.Observer._handleMutation(t)})})}this._connect(!0),this.observes=!0},suspend:function(t,i){var e;return this.observes&&1===++this._suspend&&this._connect(!1),gui.Type.isFunction(t)&&(e=t.call(i)),this.observes&&this.resume(),e},resume:function(){this.observes&&0===--this._suspend&&this._connect(!0)},_suspend:0,_observer:null,_mutationobserver:function(){return t.MutationObserver||t.WebKitMutationObserver||t.MozMutationObserver},_connect:function(t){var i=this._observer;i&&(t?i.observe(document,{childList:!0,subtree:!0}):i.disconnect())},_handleMutation:function(t){Array.forEach(t.removedNodes,function(t){t.nodeType===Node.ELEMENT_NODE&&gui.materialize(t)},this),Array.forEach(t.addedNodes,function(t){t.nodeType===Node.ELEMENT_NODE&&gui.spiritualize(t)},this)}},gui.Guide={toString:function(){return"[object gui.Guide]"},setup:function(){gui.Broadcast.addGlobal(gui.BROADCAST_KICKSTART,this);var i=gui.Client.isExplorer?"loading":document.readyState;switch(i){case"loading":document.addEventListener("DOMContentLoaded",this,!1),t.addEventListener("load",this,!1);break;case"interactive":this._ondom(),t.addEventListener("load",this,!1);break;case"complete":this._ondom()}},handleEvent:function(t){switch(t.currentTarget.removeEventListener(t.type,this,!1),t.type){case"DOMContentLoaded":this._ondom();break;case"load":}},onbroadcast:function(i){var e=i.data,n=null,r=this._windows[e];switch(i.type){case gui.BROADCAST_KICKSTART:gui.Broadcast.removeGlobal(i.type,this),this._step1(t,document);break;case gui.BROADCAST_LOADING_CHANNELS:r||(r=this._windows[e]=[],r.$loading=0),r.push(i.target),r.$loading++;break;case gui.BROADCAST_CHANNELS_LOADED:if(0===--r.$loading){for(;n=r.shift();)n.channel();this._step2(i.target.document)}}},detach:function(t){this._maybedetach(t)},possess:function(t,i){var e=t.ownerDocument,n=e.defaultView,r=n.gui.$contextid;if(t.spirit)throw new Error("Cannot repossess element with spirit "+t.spirit+" (exorcise first)");if(gui.debug&&!gui.Type.isSpiritConstructor(i))throw new Error("Not a spirit constructor ("+gui.Type.of(i)+")");return t.spirit=new i(t,e,n,r),t.spirit},exorcise:function(t){t.life.destructed||(gui.Spirit.$destruct(t),gui.Spirit.$dispose(t))},suspend:function(t,i){this._suspended=!0;var e=t.call(i);return this._suspended=!1,e},$spiritualize:function(t){t=t instanceof gui.Spirit?t.element:t,this._maybespiritualize(t,!1,!1)},$spiritualizeSub:function(t){this._maybespiritualize(t,!0,!1)},$spiritualizeOne:function(t){this._maybespiritualize(t,!1,!0)},$materialize:function(t){this._maybematerialize(t,!1,!1)},$materializeSub:function(t){this._maybematerialize(t,!0,!1)},$materializeOne:function(t){this._maybematerialize(t,!1,!0)},$shutdown:function(){gui.Broadcast.dispatch(gui.BROADCAST_WILL_UNLOAD),gui.Broadcast.dispatch(gui.BROADCAST_UNLOAD),this.$materialize(document)},_windows:Object.create(null),_suspended:!1,_handles:function(t){return t&&!this._suspended&&gui.DOMPlugin.embedded(t)&&t.nodeType===Node.ELEMENT_NODE},_ondom:function(){if(gui.autostart){var i=document.querySelector('meta[name="gui.autostart"]');i&&gui.Type.cast(i.getAttribute("content"))===!1||this._step1(t,document)}},_step1:function(t,i){gui.Broadcast.removeGlobal(gui.BROADCAST_KICKSTART,this),gui.start().then(function(){this._step2(t,i)},this)},_step2:function(t,i){var e=t.gui.$contextid;gui.DOMChanger.setup(t),gui.broadcastGlobal(gui.BROADCAST_WILL_SPIRITUALIZE,e),this._step3(t,i),gui.broadcastGlobal(gui.BROADCAST_DID_SPIRITUALIZE,e)},_step3:function(t,i){var e=i.documentElement;gui.spiritualizeOne(e),gui.mode!==gui.MODE_HUMAN&&(gui.DOMChanger.change(t),gui.Client.isWebKit&&gui.Observer.observe(t),gui.debugmutations&&console.warn("Deprecated API is deprecated: gui.debugmutations"),gui.spiritualizeSub(e),gui.$onready())},_metatags:function(){},_collect:function(t,i,e){var n=[];return new gui.Crawler(e).descend(t,{handleSpirit:function(e){i&&e.element===t||e.life.destructed||n.push(e)}}),n},_maybespiritualize:function(t,i,e){t=t instanceof gui.Spirit?t.element:t,t=t.nodeType===Node.DOCUMENT_NODE?t.documentElement:t,this._handles(t)&&this._spiritualize(t,i,e)},_spiritualize:function(t,i,e){i=!1;var n="gui-spiritualizing";if(!t.hasAttribute(n)){var r,o=[];t.setAttribute(n,"true"),new gui.Crawler(gui.CRAWLER_SPIRITUALIZE).descend(t,{handleElement:function(u){if(u!==t&&u.hasAttribute(n))return e?gui.Crawler.STOP:gui.Crawler.SKIP_CHILDREN;if(i&&u===t||(r=u.spirit,r||(r=gui.Guide._evaluate(u)),r&&(r.life.attached||o.push(r))),e)return gui.Crawler.STOP;if(!u.childElementCount)return gui.Crawler.SKIP_CHILDREN;switch(u.localName){case"pre":case"code":return gui.Crawler.SKIP_CHILDREN}return gui.Crawler.CONTINUE}}),t.removeAttribute(n),this._sequence(o)}},_sequence:function(){function t(t){return t.life.configured||gui.Spirit.$configure(t),t}function i(t){return t.life.entered||gui.Spirit.$enter(t),t}function e(t){return gui.Spirit.$attach(t),t}function n(t){t.life.ready||gui.Spirit.$ready(t)}return function(r){r.map(t).map(i).map(e).reverse().forEach(n)}}(),_maybematerialize:function(t,i,e,n){t=t instanceof gui.Spirit?t.element:t,t=t.nodeType===Node.DOCUMENT_NODE?t.documentElement:t,(n||this._handles(t))&&(t.setAttribute("gui-matarializing","true"),this._materialize(t,i,e),t.removeAttribute("gui-matarializing"))},_materialize:function(t,i){this._collect(t,i,gui.CRAWLER_MATERIALIZE).reverse().filter(function(t){return t.life.attached&&!t.life.destructed?(gui.Spirit.$destruct(t),!0):!1}).forEach(function(t){gui.Spirit.$dispose(t)})},_maybedetach:function(t){t=t instanceof gui.Spirit?t.element:t,this._handles(t)&&this._collect(t,!1,gui.CRAWLER_DETACH).forEach(function(t){gui.Spirit.$detach(t)})},_evaluate:function(t){if(!t.spirit){var i=t.ownerDocument,e=i.defaultView,n=e.gui.evaluate(t);n&&this.possess(t,n)}return t.spirit},_visibility:function(t){gui.hasModule("layout@wunderbyte.com")&&gui.DOMPlugin.group(t).forEach(function(t){gui.VisibilityPlugin.$init(t)},this)},$goasync:function(t){if(t.forEach(function(t){gui.Spirit.$async(t)}),gui.hosted){var i=gui.get("html");if(void 0===i.life.visible)return}this._visibility(t)}},function(){gui.Guide.setup()}(),gui.DOMChanger={setup:function(t){var i=t.Element.prototype;if(gui.Type.isDefined(i.spirit))throw new Error("Spiritual loaded twice?");i.spirit=null},change:function(t){this.upgrade(t,gui.DOMCombos)},upgrade:function(t,i){this._change(t,i)},_change:function(t,i){this._canchange(Element.prototype,t,i)||t.HTMLElement&&this._canchange(HTMLElement.prototype,t)||this._changeoldgecko(t,i)},_changeoldgecko:function(i,e){var n=[];this._tags().forEach(function(i){var r=document.createElement(i),o=r.constructor.prototype;o!==Object.prototype&&-1===n.indexOf(o)&&(this._dochange(o,t,e),n.push(o))},this)},_tags:function(){return"a abbr address area article aside audio b base bdi bdo blockquote body br button canvas caption cite code col colgroup command datalist dd del details device dfn div dl dt em fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins kbd keygen label legend li link main map menu meta meter nav noscript ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strong style submark summary sup table tbody td textarea tfoot th thead time title tr track ul unknown var video wbr".split(" ")},_canchange:function(t,i,e){var n=!1,r="it appears to work",o=t.hasChildNodes;t.hasChildNodes=function(){return r};var u=i.document.documentElement;return u.hasChildNodes()===r&&(t.hasChildNodes=o,this._dochange(t,i,e),n=!0),n},_dochange:function(t,i,e){var n=i.document.documentElement;gui.Object.each(e,function(i,e){this._docombo(t,i,e,n)},this)},_docombo:function(t,i,e,n){this._ismethod(i)?this._domethod(t,i,e):gui.Client.isGecko?this._dogecko(t,i,e,n):gui.Client.isExplorer&&this._doie(t,i,e)},_ismethod:function(t){var i=!1;switch(t){case"appendChild":case"removeChild":case"insertBefore":case"replaceChild":case"setAttribute":case"removeAttribute":case"insertAdjecantHTML":i=!0}return i},_domethod:function(t,i,e){var n=t[i];t[i]=e(function(){return n.apply(this,arguments)})},_doie:function(t,i,e){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(t,i,{get:function(){return n.get.call(this)},set:e(function(){n.apply(this,arguments)})})},_dogecko:function(t,i,e,n){var r=n.__lookupGetter__(i),o=n.__lookupSetter__(i);r&&(t.__defineGetter__(i,function(){return r.apply(this,arguments)}),t.__defineSetter__(i,e(function(){o.apply(this,arguments)})))}},gui.DOMCombos=function(){var t=gui.Combo,i=t.before,e=t.after,n=t.around,r=t.provided,o=r(function(){return gui.DOMPlugin.embedded(this)}),u=r(function(){return!gui.Type.isNull(this.spirit)}),s=e(function(t){gui.spiritualize(t)}),a=e(function(t){gui.spiritualize(t)}),c=i(function(t,i){gui.materialize(i)}),l=i(function(t){gui.Guide.detach(t)}),h=i(function(t,i){this.spirit.att.set(t,i)}),f=i(function(t){this.spirit.att.del(t)}),d=n(function(t){return gui.Observer.observes?gui.Observer.suspend(function(){return t()}):t()}),g=i(function(){gui.materializeSub(this)}),p=e(function(){gui.spiritualizeSub(this)}),m=null,_=i(function(){m=this.parentNode,gui.materialize(this)}),y=e(function(){gui.spiritualize(m)}),b=e(function(t){console.log(t)}),v=r(function(){var t=this.ownerDocument.defaultView;return t?t.gui.mode!==gui.MODE_HUMAN:!1}),E=r(function(){var t=this.ownerDocument.defaultView;return t?t.gui.mode!==gui.MODE_FUNNY:!1}),O=function(t){return t};return{appendChild:function(t){return v(E(o(s(d(t)),O(t)),O(t)),O(t))},insertBefore:function(t){return v(E(o(s(d(t)),O(t)),O(t)),O(t))},replaceChild:function(t){return v(o(c(E(a(d(t)),O(d(t)))),O(t)),O(t))},insertAdjecantHTML:function(t){return v(o(E(b(d(t)),O(d(t)))),O(t)),O(t)},removeChild:function(t){return v(o(l(d(t)),O(t)),O(t))},setAttribute:function(t){return v(o(u(h(t),O(t)),O(t)),O(t))},removeAttribute:function(t){return v(o(u(f(t),O(t)),O(t)),O(t))},innerHTML:function(t){return v(o(g(p(d(t))),O(t)),O(t))},outerHTML:function(t){return v(o(_(y(d(t))),O(t)),O(t))},textContent:function(t){return v(o(g(d(t)),O(t)),O(t))}}}(),gui.Tween=function(){return gui.Class.create(Object.prototype,{type:null,duration:200,timing:"none",data:null,value:0,init:!0,done:!1,onconstruct:function(t,i,e){this.type=t,this.data=void 0!==e?e:null,i&&(void 0!==i.duration&&(this.duration=i.duration),void 0!==i.timing&&(this.timing=i.timing))}},{},{dispatch:function(i,e,n){function r(){var t=1,i=u.now(),e=i-s;if(e<o.duration&&(t=e/o.duration,"none"!==o.timing))switch(t=90*t*Math.PI/180,o.timing){case"ease-in":t=1-Math.cos(t);break;case"ease-out":t=Math.sin(t)}1===t?(o.value=1,o.done=!0):(o.value=t,requestAnimationFrame(r),t>0&&(o.init=!1)),gui.Broadcast.dispatch(gui.BROADCAST_TWEEN,o)}var o=new gui.Tween(i,e,n),u=t.performance||Date,s=u.now();return r(s),o}})}(gui.Arguments.confirmed,gui.Combo.chained),gui.TweenPlugin=function(t,i){return gui.Tracker.extend({add:t(i("string")(function(t){gui.Array.make(t).forEach(function(t){this._addchecks(t)&&gui.Broadcast.add(gui.BROADCAST_TWEEN,this)},this)})),remove:t(i("string")(function(t){gui.Array.make(t).forEach(function(t){this._removechecks(t)&&gui.Broadcast.remove(gui.BROADCAST_TWEEN,this)},this)})),dispatch:i("string")(function(t,i,e){var n=null;return gui.Array.make(t).forEach(function(t){n=gui.Tween.dispatch(t,i,e)},this),n}),addDispatch:function(t,i,e){return this.add(t).dispatch(t,i,e)},onbroadcast:function(t){switch(t.type){case gui.BROADCAST_TWEEN:var i=t.data;this._containschecks(i.type)&&(this.spirit.life.destructed||this.spirit.ontween(i))}},ondestruct:function(){gui.Broadcast.remove(gui.BROADCAST_TWEEN,this),this._super.ondestruct()}})}(gui.Combo.chained,gui.Arguments.confirmed),gui.TransitionPlugin=gui.Plugin.extend({onevent:function(t){t.type===this._endevent&&t.target===this.spirit.element&&this._transitionend(t)},property:function(t){return t&&this.spirit.css.set("-beta-transition-property",t),this._init()},duration:function(t){return t&&(t=gui.Type.isNumber(t)?this._convert(t):t,this.spirit.css.set("-beta-transition-duration",t)),this._init()},timing:function(t){return t&&this.spirit.css.set("-beta-transition-timing-function",t),this._init()},easeIn:function(){return this.timing("ease-in")},easeOut:function(){return this.timing("ease-out")},easeInOut:function(){return this.timing("ease-in-out")},cubicBezier:function(t,i,e,n){return this.timing("cubic-bezier("+t+","+i+","+e+","+n+")")},none:function(){return this.property("none")},reset:function(){this.property(""),this.timing("")},run:function(t){var i=Object.create(null);this._count=0,gui.Object.each(t,function(t,e){gui.Type.isFunction(this[t])?this[t](e):i[t]=e},this);var e="none"===this.spirit.css.compute("-beta-transition-property"),n=this._then=new gui.Then,r=this.spirit;return(this._count=Object.keys(i).length)&&setImmediate(function(){r.css.style(i),e&&n&&setImmediate(function(){n.now(null)})}),n},_default:1e3,_endevent:null,_count:0,_init:function(){if(null===this._endevent){var t={webkit:"webkitTransitionEnd",explorer:"transitionend",gecko:"transitionend",opera:"oTransitionEnd"};this._endevent=t[gui.Client.agent]||"transitionend",this.spirit.event.add(this._endevent,this.spirit.element,this)}return this},_transitionend:function(t){var i=new gui.Transition(t.propertyName,t.elapsedTime);this._ontransition(i),this.spirit.ontransition(i)},_ontransition:function(){0===--this._count&&this._now()},_now:function(){var t=this._then;t&&t.now(null)},_convert:function(t){return t=t?t:this._default,t/1e3+"s"}}),gui.Transition=function(t,i){this.duration=Math.round(i/1e3),this.type=t},gui.Transition.prototype={type:null,duration:0},gui.VisibilityPlugin=function(t){return gui.Plugin.extend({on:t(function(){gui.VisibilityPlugin.on(this.spirit)}),off:t(function(){gui.VisibilityPlugin.off(this.spirit)})},{},{on:function(t){var i=gui.CLASS_INVISIBLE;(void 0===t.life.visible||t.css.contains(i))&&(t.css.remove(i),this._go(t,!0))},off:function(t){var i=gui.CLASS_INVISIBLE;switch(t.life.visible){case!0:case void 0:t.css.add(i),this._go(t,!1)}},$init:function(t){this._go(t,!this._invisible(t))},_invisible:function(t){return t.css.contains(gui.CLASS_INVISIBLE)||t.css.matches("."+gui.CLASS_INVISIBLE+" *")},_go:function(t,i){var e=i?gui.CRAWLER_VISIBLE:gui.CRAWLER_INVISIBLE;new gui.Crawler(e).descendGlobal(t,{handleSpirit:function(e){var n=void 0===e.life.visible;return e!==t&&e.css.contains(gui.CLASS_INVISIBLE)?gui.Crawler.SKIP_CHILDREN:void(i?(!e.life.visible||n)&&(e.life.visible=!0,e.life.dispatch(gui.LIFE_VISIBLE),e.onvisible()):(e.life.visible||n)&&(e.life.visible=!1,e.life.dispatch(gui.LIFE_INVISIBLE),e.oninvisible()))}})}})}(gui.Combo.chained),gui.module("layout@wunderbyte.com",{plugin:{tween:gui.TweenPlugin,transition:gui.TransitionPlugin,visibility:gui.VisibilityPlugin},mixin:{ontween:function(){},ontransition:function(){},onvisible:function(){},oninvisible:function(){}}}),gui.FlexPlugin=gui.Plugin.extend({reflex:function(){gui.FlexPlugin.reflex(this.spirit.element)},unflex:function(){gui.FlexPlugin.unflex(this.spirit.element)},enable:function(){gui.FlexPlugin.enable(this.spirit.element)},disable:function(){gui.FlexPlugin.disable(this.spirit.element)}},{},{reflex:function(t){this._emulated(t)&&this._crawl(t,"flex")},unflex:function(t,i){(this._emulated(t)||i)&&this._crawl(t,"unflex")},enable:function(t){this._crawl(t,"enable"),this._emulated(t)&&this.reflex(t)},disable:function(t){this._emulated(t)&&this.unflex(t),this._crawl(t,"disable")},_emulated:function(t){var i=t.ownerDocument,e=i.defaultView;return e.gui.flexmode===gui.FLEXMODE_EMULATED},_crawl:function(t,i){var e="enable"===i;if(this._shouldflex(t,e)){var n=this._getflexboxes(t,e);n.forEach(function(t){t[i]()})}},_shouldflex:function(t,i){return t.nodeType===Node.ELEMENT_NODE&&this._isflex(t,i)||this._hasflex(t,i)},_isflex:function(t,i){return["ts-flexrow","ts-flexcol"].some(function(e){return e+=i?"-disabled":"",gui.CSSPlugin.contains(t,e)})},_hasflex:function(t,i){return["ts-flexrow","ts-flexcol"].some(function(e){return e+=i?"-disabled":"",t.querySelector("."+e)})},_getflexboxes:function(t,i){var e,n=[];return new gui.Crawler("flexcrawler").descend(t,{handleElement:function(t){try{e=gui.CSSPlugin.compute(t,"display")}catch(r){return gui.Crawler.STOP}return"none"===e?gui.Crawler.SKIP_CHILDREN:void(gui.FlexPlugin._isflex(t,i)&&n.push(new gui.FlexBox(t)))}}),n}}),gui.FlexBox=function(t){this._onconstruct(t)},gui.FlexBox.prototype={toString:function(){return"[object gui.FlexBox]"},flex:function(){this._flexself(),this._flexchildren(),this._flexcorrect()},unflex:function(){this._element.removeAttribute("style"),this._children.forEach(function(t){t.unflex()})},disable:function(){this._enable(!1)},enable:function(){this._enable(!0)},_element:null,_children:null,_flexcol:!1,_flexlax:!1,_onconstruct:function(t){this._element=t,this._flexcol=this._hasclass("ts-flexcol"),this._flexlax=this._hasclass("ts-flexlax"),this._children=this._collectchildren(t)},_collectchildren:function(t){return Array.filter(t.children,function(t){return this._shouldflex(t)},this).map(function(t){return new gui.FlexChild(t)})},_flexself:function(){var t=this._element;this._flexcol&&this._flexlax&&(this._relaxflex(t),gui.Tick.next(function(){this._relaxflex(t)},this))},_relaxflex:function(t){var i=t.style,e=i.height,n=t.parentNode,r=n.offsetHeight;i.height="auto",t.offsetHeight<r&&(i.height=e||"100%")},_flexchildren:function(){var t=this._childflexes(),i=this._computefactor(t);if(t.length){var e=100/t.reduce(function(t,i){return t+i});this._children.forEach(function(n,r){if(t[r]>0){var o=t[r]*e*i;n.setoffset(o,this._flexcol)}},this)}},_flexcorrect:function(){this._flexcol||this._children.forEach(function(t,i){i>0&&t.flexcorrect()})},_childflexes:function(){return this._children.map(function(t){return t.getflex()},this)},_computefactor:function(t){var i,e,n=1;return t.indexOf(0)>-1&&(i=e=this._getoffset(),this._children.forEach(function(i,n){e-=t[n]?0:i.getoffset(this._flexcol)},this),n=e/i),n},_getoffset:function(){var t=this._element;return this._flexcol?t.offsetHeight:t.offsetWidth},_enable:function(t){var i,e,n=this._element,r=gui.CSSPlugin;["ts-flexrow","ts-flexcol"].forEach(function(o){i=t?o+"-disabled":o,e=t?o:o+"-disabled",r.contains(n,i)&&r.remove(n,i).add(n,e)})},_shouldflex:function(t){return"none"!==gui.CSSPlugin.compute(t,"display")},_hasclass:function(t){return gui.CSSPlugin.contains(this._element,t)}},gui.FlexChild=function(t){this._element=t},gui.FlexChild.prototype={toString:function(){return"[object gui.FlexChild]"},getflex:function(){var t=0;return this._element.className.split(" ").forEach(function(i){gui.FlexChild._FLEXNAME.test(i)&&(t=gui.FlexChild._FLEXRATE.exec(i)||1)}),gui.Type.cast(t)},getoffset:function(t){var i=this._element;return t?i.offsetHeight:i.offsetWidth},setoffset:function(t,i){var e=i?"height":"width";this._element.style[e]=t+"%"},unflex:function(){this._element.removeAttribute("style")},flexcorrect:function(){var t=this._element;t.previousSibling.nodeType===Node.TEXT_NODE&&gui.CSSPlugin.add(t,gui.FlexChild._FLEXCORRECT)},_element:null,_enable:function(t){var i,e,n=this._element,r=gui.CSSPlugin;this._element.className.split(" ").forEach(function(o){i=t?o+"-disabled":o,e=t?o:o+"-disabled",gui.FlexChild._FLEXNAME.test(o)&&r.contains(n,i)&&r.remove(n,i).add(n,e)})}},gui.FlexChild._FLEXCORRECT="_ts-flexcorrect",gui.FlexChild._FLEXNAME=/^ts-flex\d*$/,gui.FlexChild._FLEXRATE=/\d+/,gui.FlexCSS={injected:!0,maxflex:10,toString:function(){return"[object gui.FlexCSS]"},load:function(t,i){if(this.injected){var e=this._getsheets(t.gui.$contextid);if(e&&e.mode&&e[e.mode].disable(),e&&e[i])e[i].enable();else{var n=t.document,r=this[i],o=e[i]=gui.StyleSheetSpirit.summon(n,null,r);n.querySelector("head").appendChild(o.element)}e.mode=i,t.gui.flexloaded=!0}},unload:function(t){delete this._sheets[t.gui.$contextid]},_sheets:Object.create(null),_getsheets:function(t){var i=this._sheets;return i[t]||(i[t]={emulated:null,"native":null,mode:null}),i[t]}},gui.FlexCSS.emulated={".ts-flexrow, .ts-flexcol":{display:"block"},".ts-flexcol":{height:"100%"},".ts-flexrow":{"white-space":"nowrap"},".ts-flexrow > *":{display:"inline-block","vertical-align":"top","white-space":"normal",height:"100%"},".ts-flexrow > ._ts-flexcorrect":{margin:"0 0 0 -4px !important"},".ts-flexcol > *":{display:"block"},".ts-flexlax > .ts-flexrow":{display:"table"},".ts-flexlax > .ts-flexrow > *":{display:"table-cell"}},gui.FlexCSS["native"]=function(){function t(t){i[".ts-flexrow > .ts-flex"+t+", .ts-flexcol > .ts-flex"+t]={"-beta-flex-grow":t||1}}for(var i={".ts-flexrow, .ts-flexcol":{display:"-beta-flex","-beta-flex-wrap":"nowrap"},".ts-flexcol":{"-beta-flex-direction":"column","min-height":"auto",height:"100%"},".ts-flexcol .ts-flexcol, .ts-flexrow .ts-flexcol":{height:"auto"},".ts-flexrow":{"-beta-flex-direction":"row","min-width":"auto",width:"100%"},".ts-flexcol .ts-flexrow, .ts-flexrow .ts-flexrow":{width:"auto"},".ts-flexrow:not(.ts-flexlax) > *, .ts-flexcol:not(.ts-flexlax) > *":{"-beta-flex-basis":1}},e=-1,n=gui.FlexCSS.maxflex;++e<=n;)t(e||"");return i}(),gui.FlexMode=function(i){return{flexloaded:i({writable:!0,value:!1}),flexmode:i({get:function(){var t=gui.Client.hasFlex&&!gui.Client.isExplorer,i=t?gui.FLEXMODE_NATIVE:gui.FLEXMODE_EMULATED;return this._flexmode===gui.FLEXMODE_OPTIMIZED?i:this._flexmode},set:function(i){this._flexmode=i;var e=gui.Client.hasFlex?gui.FLEXMODE_NATIVE:gui.FLEXMODE_EMULATED,n=i===gui.FLEXMODE_OPTIMIZED?e:i;if(gui.FlexCSS.load(t,n),document.documentElement.spirit)switch(n){case gui.FLEXMODE_EMULATED:this.reflex();break;case gui.FLEXMODE_NATIVE:this.unflex()}}}),reflex:i({value:function(t){this.flexmode===this.FLEXMODE_EMULATED&&gui.FlexPlugin.reflex(t||document.body)}}),unflex:i({value:function(t){gui.FlexPlugin.unflex(t||document.body,!0)}})}}(gui.Property.nonenumerable),gui.FLEXMODE_NATIVE="native",gui.FLEXMODE_EMULATED="emulated",gui.FLEXMODE_OPTIMIZED="optimized",gui.module("flex@wunderbyte.com",{plugin:{flex:gui.FlexPlugin},oncontextinitialize:function(){gui._flexmode=gui.FLEXMODE_OPTIMIZED,Object.defineProperties(gui,gui.FlexMode)},onbeforespiritualize:function(){gui.flexloaded||gui.FlexCSS.load(t,gui.flexmode),this._edbsetup(t)},onafterspiritualize:function(){var t=document.documentElement.spirit;if(gui.flexmode===gui.FLEXMODE_EMULATED)try{gui.CSSPlugin.compute(t,"display"),gui.reflex()}catch(i){}gui.Broadcast.addGlobal(gui.BROADCAST_RESIZE_END,{onbroadcast:function(){gui.flexmode===gui.FLEXMODE_EMULATED&&gui.reflex()}})},oncontextunload:function(){gui.FlexCSS.unload(t)},_edbsetup:function(){if(gui.hasModule("edbml@wunderbyte.com")){var t=edbml.ScriptPlugin.prototype;gui.Function.decorateAfter(t,"write",function(){this.spirit.window.gui.flexmode===gui.FLEXMODE_EMULATED&&this.spirit.flex.reflex()})}}}),function(t){function i(t){var i,e;t=t instanceof gui.Spirit?t.element:t,i=t.ownerDocument,e=i.defaultView,e.gui.flexmode===gui.FLEXMODE_EMULATED&&(t=t===i.documentElement?t:t.parentNode,gui.Tick.next(function(){try{gui.FlexPlugin.reflex(t)}catch(i){}}))}["_spiritualize","_materialize"].forEach(function(e){gui.Function.decorateAfter(t,e,i)})}(gui.Guide),gui.Key=function(t,i,e){this.down=t,this.type=i,this.global=e},gui.Key.prototype={down:!1,type:null,global:!1},function(){gui.Object.each({shiftDown:!1,ctrlDown:!1,altDown:!1,metaDown:!1,accelDown:!1,accessDown:!1},function(t,i){gui.Key[t]=i})}(),function(){gui.Key.$key=gui.Object.extend({38:"Up",40:"Down",37:"Left",39:"Right",18:"Alt",17:"Control",16:"Shift",32:"Space",27:"Esc",13:"Enter"},Object.create(null))}(),function(){gui.Object.each(gui.Key.$key,function(t,i){gui.Key[i.toUpperCase()]=i})}(),gui.KeyPlugin=function(t,i){return gui.Tracker.extend({add:t("array|string","(object|function)")(i(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.IKeyHandler,i)&&gui.Array.make(t).forEach(function(t){this._addchecks(String(t),[i,this._global])&&this._setupbroadcast(!0)},this)})),remove:t("array|string","(object|function)")(i(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.IKeyHandler,i)&&gui.Array.make(t).forEach(function(t){this._removechecks(String(t),[i,this._global])&&(this._hashandlers()||this._setupbroadcast(!1))},this)})),addGlobal:function(t,i){return this._globalize(function(){return this.add(t,i)})},removeGlobal:function(t,i){return this._globalize(function(){return this.remove(t,i)})},onbroadcast:function(t){var i,e,n;if(t.type===gui.BROADCAST_KEYEVENT){var r=t.data.down,o=t.data.type;(i=this._trackedtypes[o])&&i.forEach(function(i){e=i[0],n=i[1],n===t.global&&e.onkey(new gui.Key(r,o,n))})}},_setupbroadcast:function(t){var i,e=this.context.gui.$contextid,n=gui.BROADCAST_KEYEVENT;this._global?(i=t?"addGlobal":"removeGlobal",gui.Broadcast[i](n,this)):(i=t?"add":"remove",gui.Broadcast[i](n,this,e))},_cleanup:function(t,i){var e=i[0],n=i[1];n?this.removeGlobal(t,e):this.remove(t,e)}})}(gui.Arguments.confirmed,gui.Combo.chained),gui.IKeyHandler={toString:function(){return"[object IKeyHandler]"},onkey:function(){}},gui.KeySpirit=gui.Spirit.extend({onready:function(){this._super.onready(),this._map=Object.create(null),this._setup()},onkey:function(t){this._super.onkey(t),console.log(t.type);var i=this._map;i[t.type]=t.down,Object.keys(i).every(function(t){return i[t]===!0})&&console.log("fis!")},_map:null,_setup:function(){var t=this.att.get("key");t&&t.split(" ").forEach(function(t){t=t.trim(),this.key.addGlobal(t),this._map[t]=!1},this)}}),gui.KeysModule=gui.module("keys@wunderbyte.com",{channel:[[".gui-key",gui.KeySpirit]],plugin:{key:gui.KeyPlugin},mixin:{onkey:function(){}},oncontextinitialize:function(t){this._keymap=Object.create(null),["keydown","keypress","keyup"].forEach(function(i){t.document.addEventListener(i,this,!1)},this)},handleEvent:function(t){this._modifiers(t),this._oldschool(t)},_keymap:null,_snapshot:null,_newschool:function(){},_oldschool:function(t){var i=t.keyCode,e=this._keymap[i],n=(gui.BROADCAST_KEYEVENT,t.currentTarget.defaultView.gui.$contextid);switch(t.type){case"keydown":void 0===e&&(this._keycode=i,this._keymap[i]=null,this._keymap[i]=String.fromCharCode(t.which).toLowerCase(),gui.Tick.next(function(){e=this._keymap[i],this._broadcast(!0,null,e,i,n),this._keycode=null},this));break;case"keypress":this._keycode&&(e=this._keychar(t.keyCode,t.charCode,t.which),this._keymap[this._keycode]=e);break;case"keyup":void 0!==e&&(this._broadcast(!1,null,e,i,n),delete this._keymap[i])}},_broadcast:function(t,i,e,n,r){var o,u,s;o=gui.Key.$key[n]||e,o=" "===o?gui.Key.SPACE:o,u=gui.BROADCAST_KEYEVENT,s={down:t,type:o};var a=JSON.stringify(s);a!==this._snapshot&&(gui.Broadcast.dispatch(u,s,r),gui.Broadcast.dispatchGlobal(u,s),this._snapshot=a)},_modifiers:function(t){gui.Key.ctrlDown=t.ctrlKey,gui.Key.shiftDown=t.shiftKey,gui.Key.altDown=t.altKey,gui.Key.metaDown=t.metaKey},_keychar:function(t,i,e){return null===e||void 0===e?String.fromCharCode(t):0!==e&&i?String.fromCharCode(e):null}}),gui.BROADCAST_KEYEVENT="gui-broadcast-keyevent"}(self);